(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[40032,47365],{57761:(e,t,i)=>{"use strict";i.d(t,{OptionsDialogController:()=>o});var s=i(111393);let r;class o extends s.DialogRenderer{constructor(){super(...arguments),this._dialog=null,this._subscribe=e=>{this._setVisibility(e)}}show(e){this._load(e).then((e=>e.show()))}hide(){var e;null===(e=this._dialog)||void 0===e||e.hide()}static getInstance(){return r||(r=new o),r}_load(e){return Promise.all([i.e(67681),i.e(1893),i.e(42381),i.e(38697),i.e(43630),i.e(86282),i.e(47821),i.e(20442),i.e(89589),i.e(8191),i.e(72456),i.e(42629),i.e(47416),i.e(19860),i.e(30416),i.e(96918),i.e(35399),i.e(21997),i.e(30855),i.e(77614),i.e(92167),i.e(75471),i.e(90385),i.e(59255),i.e(51004),i.e(27112),i.e(62526),i.e(52375),i.e(64198)]).then(i.bind(i,890922)).then((t=>{var i,s;return null===(i=this._dialog)||void 0===i||i.hide(),null===(s=this._dialog)||void 0===s||s.visible().unsubscribe(this._subscribe),this._dialog=new t.OptionsDialogRenderer(e),this._dialog.visible().subscribe(this._subscribe),this._dialog}))}}},254526:(e,t,i)=>{"use strict";i.d(t,{SYMBOL_TYPE_BLACK_LIST:()=>s});const s=new Set(["spread","economic"])},250378:(e,t,i)=>{"use strict";i.d(t,{BadRequestErrorResponse:()=>r});var s=i(867023);class r extends s.ErrorResponse{constructor(e){super(e),this.name="BadRequestError",e.error?this.message=e.error:this.message="unknown error"}}},867023:(e,t,i)=>{"use strict";i.d(t,{ErrorResponse:()=>s});class s{constructor(e){this._status=e.status,this._statusText=e.statusText||""}getInfo(){return{name:this.name,status:this._status,statusText:this._statusText,message:this.message}}}},729030:(e,t,i)=>{"use strict";i.d(t,{getSymbolData:()=>a});var s=i(120780),r=i(438874),o=i(250378),l=i(685503),n=i(159954);function a(e,t,i,a=!0){const u=i.join(","),h=(0,r.getSymbolDataUrl)(t,u,a),d={signal:e,method:"GET",credentials:"include",headers:{Accept:"application/json"}};return(0,s.fetch)(h,d,{logOnErrorStatus:!1}).then((e=>{if(400===e.status){const{status:t,statusText:i}=e;return e.json().then((e=>{const s=e.errmsg;throw new o.BadRequestErrorResponse({status:t,statusText:i,error:s})}))}if(404===e.status){const{status:t,statusText:i}=e;return e.json().then((s=>{if("symbol_not_exists"===s.code){const e=s.errmsg;throw new n.SymbolDoesNotExistErrorResponse({status:t,statusText:i,error:e})}throw new l.HttpErrorResponse(e)}))}if(e.ok)return e.json().then((e=>e));throw new l.HttpErrorResponse(e)}))}},685503:(e,t,i)=>{"use strict";i.d(t,{HttpErrorResponse:()=>r});var s=i(867023);class r extends s.ErrorResponse{constructor(e){super(e),this.name="HttpErrorResponse",this._status>=200&&this._status<300?this.message=`Http failure during parsing for ${e.url||"(unknown url)"}`:this.message=`Http failure response for ${e.url||"(unknown url)"}: ${e.status} ${e.statusText}`}}},159954:(e,t,i)=>{"use strict";i.d(t,{SymbolDoesNotExistErrorResponse:()=>r});var s=i(867023);class r extends s.ErrorResponse{constructor(e){super(e),this.name="SymbolDoesNotExistError",
this.message=e.error||"symbol does not exist"}}},438874:(e,t,i)=>{"use strict";function s(){return window.SCREENER_HOST||"https://scanner.tradingview.com"}function r(e,t){const i=s();return t?`${i}/${t}/`:1===e.length?`${i}/${e[0]}/`:`${i}/global/`}function o(e,t,i){return`${s()}/symbol?symbol=${e}&fields=${t}${i?"&no_404=true":""}`}i.d(t,{getBackendUrl:()=>r,getSymbolDataUrl:()=>o})},163482:(e,t,i)=>{"use strict";i.d(t,{TECHNICALS_QS_FIELDS:()=>s,TECHNICALS_SCREENER_COLUMNS:()=>a,requiredMAColumns:()=>l,requiredOscColumns:()=>o,requiredPivotsColumns:()=>n,requiredRecommendColumns:()=>r});const s=["type","listed_exchange","pricescale","typespecs","pro_name","short_name"],r=["Recommend.Other","Recommend.All","Recommend.MA"],o=["RSI","Stoch.K","CCI20","ADX","AO","Mom","MACD.macd","Stoch.RSI.K","W.R","BBPower","UO"],l=["EMA10","SMA10","EMA20","SMA20","EMA30","SMA30","EMA50","SMA50","EMA100","SMA100","EMA200","SMA200","Ichimoku.BLine","VWMA","HullMA9"],n=["Pivot.M.Classic.S3","Pivot.M.Classic.S2","Pivot.M.Classic.S1","Pivot.M.Classic.Middle","Pivot.M.Classic.R1","Pivot.M.Classic.R2","Pivot.M.Classic.R3","Pivot.M.Fibonacci.S3","Pivot.M.Fibonacci.S2","Pivot.M.Fibonacci.S1","Pivot.M.Fibonacci.Middle","Pivot.M.Fibonacci.R1","Pivot.M.Fibonacci.R2","Pivot.M.Fibonacci.R3","Pivot.M.Camarilla.S3","Pivot.M.Camarilla.S2","Pivot.M.Camarilla.S1","Pivot.M.Camarilla.Middle","Pivot.M.Camarilla.R1","Pivot.M.Camarilla.R2","Pivot.M.Camarilla.R3","Pivot.M.Woodie.S3","Pivot.M.Woodie.S2","Pivot.M.Woodie.S1","Pivot.M.Woodie.Middle","Pivot.M.Woodie.R1","Pivot.M.Woodie.R2","Pivot.M.Woodie.R3","Pivot.M.Demark.S1","Pivot.M.Demark.Middle","Pivot.M.Demark.R1"],a=[...r,...o,...l,...n]},719885:(e,t,i)=>{"use strict";i.d(t,{TechnicalsDialogController:()=>h});var s=i(583912),r=i(111393),o=i(680632),l=i(729030),n=i(254526),a=i(163482);let u;class h extends r.DialogRenderer{constructor(){super(...arguments),this._dialog=null,this._subscribe=e=>{this._setVisibility(e)}}async show(e){const t=(null==e?void 0:e.symbol)?e.symbol:s.linking.proSymbol.value();if(null==e?void 0:e.snapshot){const{snapshot:i}=e,s=await this._loadModule();this._getDialog(s,{...e,symbol:t,...i,exchange:i.listed_exchange}).show()}else{const s=async()=>{const{snapshoter:e}=await i.e(51030).then(i.bind(i,795394));return e().getSnapshot(t,new Set(a.TECHNICALS_QS_FIELDS))},[r,o]=await Promise.all([this._loadModule(),s()]);if("error"===o.status)return void this._getDialog(r,{...e,symbol:t}).show();this._getDialog(r,{...e,symbol:t,...o.values,exchange:o.values.listed_exchange}).show()}}async canBeShown(e){const t=e||s.linking.proSymbol.value();if(!t)return!1;const r=new Set([...a.TECHNICALS_QS_FIELDS,"description"]),u=await(async()=>{const{snapshoter:e}=await i.e(51030).then(i.bind(i,795394));return e().getSnapshot(t,r)})();if("error"===u.status)return!1;const{values:{type:h,listed_exchange:d,description:c}}=u;if(!n.SYMBOL_TYPE_BLACK_LIST.has(h))try{const e=(0,o.getTickerSymbol)(t,h),i=await(0,l.getSymbolData)(null,e,["Recommend.All"]);return Boolean(i&&0!==Object.keys(i).length&&c&&d&&h)
}catch(e){return!1}return!1}hide(){var e;null===(e=this._dialog)||void 0===e||e.hide()}static getInstance(){return u||(u=new h),u}_getDialog(e,t){var i,s;return null===(i=this._dialog)||void 0===i||i.hide(),null===(s=this._dialog)||void 0===s||s.visible().unsubscribe(this._subscribe),this._dialog=new e.TechnicalsDialogRenderer(t),this._dialog.visible().subscribe(this._subscribe),this._dialog}_loadModule(){return Promise.all([i.e(37729),i.e(67681),i.e(1893),i.e(42381),i.e(7436),i.e(43630),i.e(86282),i.e(47821),i.e(11301),i.e(89589),i.e(8191),i.e(42629),i.e(47416),i.e(12742),i.e(19860),i.e(30416),i.e(96918),i.e(35399),i.e(21997),i.e(68941),i.e(25045),i.e(77614),i.e(92167),i.e(41218),i.e(86421),i.e(84665),i.e(75647),i.e(76911),i.e(19161),i.e(90385),i.e(52375),i.e(73248),i.e(71138)]).then(i.bind(i,449736))}}},528474:(e,t,i)=>{"use strict";i.d(t,{blendColors:()=>r});var s=i(724377);const r=(e,t)=>(0,s.rgbaToString)((0,s.blendRgba)((0,s.parseRgba)(e),(0,s.parseRgba)(t)))},589026:(e,t,i)=>{"use strict";i.d(t,{BondYieldCurveDialogController:()=>o});var s=i(111393);let r;class o extends s.DialogRenderer{constructor(){super(...arguments),this._dialog=null,this._subscribe=e=>{this._setVisibility(e)}}show(e){this._load(e).then((e=>e.show()))}hide(){var e;null===(e=this._dialog)||void 0===e||e.hide()}static getInstance(){return r||(r=new o),r}_load(e){return Promise.all([i.e(50580),i.e(67681),i.e(1893),i.e(42381),i.e(38697),i.e(43630),i.e(86282),i.e(47821),i.e(20442),i.e(89589),i.e(8191),i.e(2113),i.e(42629),i.e(47416),i.e(19860),i.e(30416),i.e(96918),i.e(35399),i.e(21997),i.e(77614),i.e(92167),i.e(74326),i.e(90385),i.e(59255),i.e(62526),i.e(52375),i.e(15678)]).then(i.bind(i,320643)).then((t=>{var i,s;return null===(i=this._dialog)||void 0===i||i.hide(),null===(s=this._dialog)||void 0===s||s.visible().unsubscribe(this._subscribe),this._dialog=new t.BondYieldCurveDialogRenderer(e),this._dialog.visible().subscribe(this._subscribe),this._dialog}))}}},273058:(e,t,i)=>{"use strict";i.d(t,{EtfAnalysisDialogController:()=>o});var s=i(111393);let r;class o extends s.DialogRenderer{constructor(){super(...arguments),this._dialog=null,this._subscribe=e=>{this._setVisibility(e)}}show(e){this._load(e).then((e=>e.show()))}hide(){var e;null===(e=this._dialog)||void 0===e||e.hide()}static getInstance(){return r||(r=new o),r}_load(e){return Promise.all([i.e(68716),i.e(19515),i.e(7290),i.e(16715),i.e(67681),i.e(1893),i.e(42381),i.e(38697),i.e(43630),i.e(86282),i.e(47821),i.e(20442),i.e(89589),i.e(8191),i.e(42629),i.e(47416),i.e(12742),i.e(18251),i.e(39232),i.e(42670),i.e(19860),i.e(30416),i.e(96918),i.e(35399),i.e(21997),i.e(37794),i.e(6434),i.e(77614),i.e(57927),i.e(34583),i.e(92167),i.e(21557),i.e(79630),i.e(45199),i.e(38688),i.e(51535),i.e(45402),i.e(95572),i.e(86437),i.e(94850),i.e(94571),i.e(33410),i.e(90385),i.e(14176),i.e(52375),i.e(29508),i.e(50097),i.e(66788),i.e(58534)]).then(i.bind(i,586605)).then((t=>{var i,s;return null===(i=this._dialog)||void 0===i||i.hide(),
null===(s=this._dialog)||void 0===s||s.visible().unsubscribe(this._subscribe),this._dialog=new t.EtfAnalysisDialogRenderer(e),this._dialog.visible().subscribe(this._subscribe),this._dialog}))}}},232650:(e,t,i)=>{"use strict";i.d(t,{openFinancialsWebview:()=>d});var s=i(195269),r=i(675128),o=i(671040),l=i(6613)
;const n=new Set(["number_of_employees","web_site_url","founded","ceo","market_cap_basic","dividends_yield","price_earnings_ttm","earnings_per_share_basic_ttm","currency_code","fundamental_currency_code","float_shares_outstanding","total_shares_outstanding","total_revenue_fy_h","total_revenue_fq_h","total_revenue_fh_h","net_income_fy_h","net_income_fq_h","net_income_fh_h","total_assets_fy_h","total_assets_fq_h","total_assets_fh_h","total_liabilities_fy_h","total_liabilities_fq_h","total_liabilities_fh_h","cash_f_operating_activities_fy_h","cash_f_operating_activities_fq_h","cash_f_operating_activities_fh_h","cash_f_investing_activities_fy_h","cash_f_investing_activities_fq_h","cash_f_investing_activities_fh_h","cash_f_financing_activities_fy_h","cash_f_financing_activities_fq_h","cash_f_financing_activities_fh_h","fiscal_period_fy_h","fiscal_period_fq_h","fiscal_period_fh_h","interest_income_fy_h","interest_income_fq_h","interest_income_fh_h","non_interest_income_fy_h","non_interest_income_fq_h","non_interest_income_fh_h","earnings_release_date_fq_h","earnings_release_date_fy_h","earnings_release_date_fh_h","earnings_release_next_date_fq","earnings_release_next_date_fy","earnings_release_next_date_fh","earnings_release_next_time","earnings_release_next_date","is_next_earnings_release_date_estimated","earnings_per_share_forecast_next_fq","earnings_per_share_forecast_next_fy","earnings_per_share_forecast_next_fh","earnings_per_share_forecast_fq_h","earnings_per_share_forecast_fy_h","earnings_per_share_forecast_fh_h","earnings_per_share_fq_h","earnings_per_share_fy_h","earnings_per_share_fh_h","earnings_fiscal_period_fq_h","earnings_fiscal_period_fy_h","earnings_fiscal_period_fh_h","next_earnings_fiscal_period_fq","next_earnings_fiscal_period_fy","next_earnings_fiscal_period_fh","revenue_fq_h","revenue_fy_h","revenue_fh_h","revenue_forecast_fq_h","revenue_forecast_fy_h","revenue_forecast_fh_h","revenue_forecast_next_fq","revenue_forecast_next_fy","revenue_forecast_next_fh","fundamental_currency_code","dividend_payout_ratio_ttm","dividends_yield_current","dividend_ex_date_upcoming","dividend_amount_upcoming","dividend_amount_recent","dividend_ex_date_recent","dividend_amount_h","total_revenue_fy","gross_profit_fy","ebitda_fy","ebit_fy","net_income_fy","fiscal_period_fy","fiscal_period_fy_h","fiscal_period_fq_h","fiscal_period_fh_h","total_debt_fy_h","total_debt_fq_h","total_debt_fh_h","free_cash_flow_fy_h","free_cash_flow_fq_h","free_cash_flow_fh_h","cash_n_equivalents_fy_h","cash_n_equivalents_fq_h","cash_n_equivalents_fh_h","loans_net_fy_h","loans_net_fq_h","loans_net_fh_h","total_deposits_fy_h","total_deposits_fq_h","total_deposits_fh_h","loan_loss_allowances_fy_h","loan_loss_allowances_fq_h","loan_loss_allowances_fh_h","insurance_reserves_fy_h","insurance_reserves_fq_h","insurance_reserves_fh_h","policy_claims_fy_h","policy_claims_fq_h","policy_claims_fh_h","premiums_earned_fy_h","premiums_earned_fq_h","premiums_earned_fh_h","common_equity_tier1_ratio_fy_h","common_equity_tier1_ratio_fq_h","common_equity_tier1_ratio_fh_h","tier1_capital_ratio_fy_h","tier1_capital_ratio_fq_h","tier1_capital_ratio_fh_h","total_capital_ratio_fy_h","total_capital_ratio_fq_h","total_capital_ratio_fh_h","fiscal_period_fy_h","fiscal_period_fq_h","fiscal_period_fh_h","reserve_to_total_capital_fy_h","reserve_to_total_capital_fq_h","reserve_to_total_capital_fh_h","unearned_premium_to_total_capital_fy_h","unearned_premium_to_total_capital_fq_h","unearned_premium_to_total_capital_fh_h","fundamental_currency_code","total_current_assets_fy","total_current_assets_fq","total_current_assets_fh","total_current_liabilities_fy","total_current_liabilities_fq","total_current_liabilities_fh","total_non_current_assets_fy","total_non_current_assets_fq","total_non_current_assets_fh","total_non_current_liabilities_fy","total_non_current_liabilities_fq","total_non_current_liabilities_fh","fiscal_period_fy","fiscal_period_fq","fiscal_period_fh","fundamental_currency_code","price_earnings_fq_h","price_earnings_fy_h","price_earnings_fh_h","price_sales_fq_h","price_sales_fy_h","price_sales_fh_h","fiscal_period_fy_h","fiscal_period_fq_h","fiscal_period_fh_h","market_cap_basic","diluted_net_income_ttm","total_revenue_ttm","price_earnings_current","price_sales_current","fundamental_currency_code","revenue_seg_by_business_h","revenue_seg_by_region_h","fiscal_period_fy","interest_income_fy","interest_income_fq","interest_income_fh","non_interest_income_fy","non_interest_income_fq","non_interest_income_fh","interest_expense_fy","interest_expense_fq","interest_expense_fh","loan_loss_provision_fy","loan_loss_provision_fq","loan_loss_provision_fh","non_interest_expense_fy","non_interest_expense_fq","non_interest_expense_fh","non_oper_income_fy","non_oper_income_fq","non_oper_income_fh","unusual_expense_inc_fy","unusual_expense_inc_fq","unusual_expense_inc_fh","pretax_income_fy","pretax_income_fq","pretax_income_fh","total_revenue_fy","total_revenue_fq","total_revenue_fh","gross_profit_fy","gross_profit_fq","gross_profit_fh","net_income_fy","net_income_fq","net_income_fh","cost_of_goods_fy","cost_of_goods_fq","cost_of_goods_fh","operating_expenses_fy","operating_expenses_fq","operating_expenses_fh","oper_income_fy","oper_income_fq","oper_income_fh","total_non_oper_income_fy","total_non_oper_income_fq","total_non_oper_income_fh","income_tax_fy","income_tax_fq","income_tax_fh","after_tax_other_income_fy","after_tax_other_income_fq","after_tax_other_income_fh","fiscal_period_fy","fiscal_period_fq","fiscal_period_fh","equity_in_earnings_fy","equity_in_earnings_fq","equity_in_earnings_fh","minority_interest_exp_fy","minority_interest_exp_fq","minority_interest_exp_fh","discontinued_operations_fy","discontinued_operations_fq","discontinued_operations_fh","fundamental_currency_code","fund_view_mode"]),a=(0,
r.lazyValue)((()=>new o.QuoteSessionSnapshoter({name:"financials-webview-quotes",fields:[...n]})));let u;class h extends s.WebviewControllerBase{open(e){const t=this._createOpenRequest(s.WebviewPageName.Financials,e);a().getSnapshot(t.symbol(),n);t.execute().ChartQuoteSnapshotProvider={getQuoteSnapshot(){var e;const i=l.QUOTE_FIELDS_CACHE.get(t.symbol());return null!==(e=null==i?void 0:i.values)&&void 0!==e?e:{}}}}static getInstance(){return u||(u=new h),u}}function d(e){h.getInstance().open(e)}},497763:(e,t,i)=>{"use strict";i.d(t,{SERIES_COLORS:()=>r,getColorByIndex:()=>l,getItemByIndex:()=>o});var s=i(790188);const r=[s.colorsPalette["color-tv-blue-a200"],s.colorsPalette["color-sky-blue-300"],s.colorsPalette["color-banana-yellow-900"],s.colorsPalette["color-deep-blue-a100"],s.colorsPalette["color-banana-yellow-700"],s.colorsPalette["color-tv-blue-300"],s.colorsPalette["color-grapes-purple-a100"],s.colorsPalette["color-tv-blue-400"],s.colorsPalette["color-minty-green-300"],s.colorsPalette["color-berry-pink-300"],s.colorsPalette["color-tv-blue-a100"],s.colorsPalette["color-tan-orange-a200"],s.colorsPalette["color-iguana-green-400"],s.colorsPalette["color-ripe-red-400"],s.colorsPalette["color-sky-blue-300"],s.colorsPalette["color-banana-yellow-600"],s.colorsPalette["color-berry-pink-a200"],s.colorsPalette["color-tv-blue-200"],s.colorsPalette["color-banana-yellow-900"]];function o(e,t){const i=e[t%e.length];return i||e[0]}function l(e,t=r){return o(t,e)}},436901:(e,t,i)=>{"use strict";i.d(t,{DEFAULT_MAX_DATA_ARRAY_LENGTH:()=>s,FULL_MAX_DATA_ARRAY_LENGTH:()=>r});const s=5,r=7},610203:(e,t,i)=>{"use strict";i.d(t,{PeriodId:()=>s,convertFrequencyToPeriod:()=>_,generateTooltipValues:()=>w,getChartSeriesArray:()=>C,getDataFromQuotes:()=>g,getFinancialsDataFromQuotes:()=>R,getFinancialsSets:()=>v,getFormattedPeriodsEnds:()=>D,getHistoricPeriodsDataFromQuotes:()=>P,getPerformanceSet:()=>y,getPeriodData:()=>f,getPeriodDataFromFinancials:()=>T,getPeriodsDataFromQuotes:()=>I,getTooltipValuesGeneratorWithOptions:()=>x,isQuoteValuesNull:()=>L,pastPerformanceColors:()=>c});var s,r=i(650151),o=i(444372),l=i(157954),n=i(497763),a=i(530254),u=i(904310),h=i(436901),d=i(790188);!function(e){e.Year="FY",e.Quarter="FQ",e.HalfYear="FH"}(s||(s={}));const c=[d.colorsPalette["color-tv-blue-a200"],d.colorsPalette["color-sky-blue-300"]];function _(e){return e&&2===e?s.HalfYear:s.Quarter}function p(e){if(e)return["banking"===e?{title:o.t(null,void 0,i(1017)),fields:["interest_income","non_interest_income"]}:"total_revenue","net_income"]}function y(e,t){return{id:"income statements",title:o.t(null,void 0,i(663089)),chartType:"compare",marginTitle:o.t(null,void 0,i(861008)),fields:p(e),currency:t}}function v(e,t){return[{id:"income statements",title:o.t(null,void 0,i(506823)),chartType:"compare",marginTitle:o.t(null,void 0,i(861008)),fields:p(e),currency:t},{id:"balance sheet",title:o.t(null,void 0,i(730737)),chartType:"compare",marginTitle:o.t(null,void 0,i(981922)),fields:["total_assets","total_liabilities"],currency:t},{id:"cash flow",
title:o.t(null,void 0,i(822755)),chartType:"lines",fields:["cash_f_operating_activities","cash_f_investing_activities","cash_f_financing_activities"],currency:t}]}function m(e){return e.hasOwnProperty("title")}function S(e){return m(e)?e.title:(0,r.ensureDefined)({total_revenue:o.t(null,void 0,i(259285)),net_income:o.t(null,void 0,i(485672)),total_assets:o.t(null,void 0,i(697554)),total_liabilities:o.t(null,void 0,i(475385)),cash_f_operating_activities:o.t(null,void 0,i(404621)),cash_f_investing_activities:o.t(null,void 0,i(418959)),cash_f_financing_activities:o.t(null,void 0,i(517831))}[e])}function b(e,t,i,s=h.DEFAULT_MAX_DATA_ARRAY_LENGTH){if(!m(e))return g(e,t,i,s);const r=e.fields.map((e=>g(e,t,i,s))),o=[];for(let e=0;e<r[0].length;e++){const t=r.map((t=>t[e]));o.push(t.every((e=>null===e))?null:t.reduce(((e,t)=>e+(t||0)),0))}return o}function g(e,t,i,s=h.DEFAULT_MAX_DATA_ARRAY_LENGTH){const r=i[t];if(!r)return[];return r[e].slice(0,s).reverse()}function f(e,t,i=h.DEFAULT_MAX_DATA_ARRAY_LENGTH){const s=e[t];if(s)return s.slice(0,i).reverse()}function C(e,t,i,s=0,o){if(!e.fields)return[];switch(e.chartType){case"compare":const l=e.fields.map(((l,a)=>({type:"bar",name:S((0,r.ensureDefined)(l)),valueType:"numbers",values:b((0,r.ensureDefined)(l),t,(0,r.ensureDefined)(i)),defaultColor:(0,n.getColorByIndex)(a+s,o),showInLegend:!0,buildTooltip:x({unit:e.currency})}))),a=l[0].values.map(((e,t)=>{const i=l[1].values[t];return null===e||null===i?null:0===e?0:i/e*100}));return l.push({type:"line",name:(0,r.ensureDefined)(e.marginTitle),valueType:"percents",values:a,defaultColor:(0,n.getColorByIndex)(e.fields.length+s),showInLegend:!0,buildTooltip:w}),l;case"lines":return e.fields.map(((o,l)=>({type:"line",name:S((0,r.ensureDefined)(o)),valueType:"numbers",values:b((0,r.ensureDefined)(o),t,(0,r.ensureDefined)(i)),defaultColor:(0,n.getColorByIndex)(l+s),showInLegend:!0,buildTooltip:x({unit:e.currency})})));default:return[]}}function w(e,t,i,s){var o,l;const n=e.values[i];if(null===n)return null;const h=(0,a.format)(n,e.valueType);return[{title:null===(o=null==s?void 0:s.capitalizeFirstLetter)||void 0===o||o?(0,u.capitalizeFirstLetter)(e.name.toLowerCase()):e.name,color:null!==(l=null==s?void 0:s.color)&&void 0!==l?l:(0,r.ensureDefined)(e.defaultColor),value:h,unit:null==s?void 0:s.unit,endSlot:null==s?void 0:s.endSlot}]}function x(e){return(t,i,s)=>w(t,0,s,e)}function P(e){const{fiscal_period_fy_h:t,fiscal_period_fq_h:i,fiscal_period_fh_h:r}=e;if(t||i||r)return{[s.Year]:t,[s.Quarter]:i,[s.HalfYear]:r}}function I(e){const{fiscal_period_fy:t,fiscal_period_fq:i,fiscal_period_fh:r}=e;if(t||i||r)return{[s.Year]:t,[s.Quarter]:i,[s.HalfYear]:r}}function T(e){var t,i,r;if(!e)return;const o=null===(t=e[s.Year])||void 0===t?void 0:t.fiscal_period,l=null===(i=e[s.Quarter])||void 0===i?void 0:i.fiscal_period,n=null===(r=e[s.HalfYear])||void 0===r?void 0:r.fiscal_period;return o||l||n?{[s.Year]:o,[s.Quarter]:l,[s.HalfYear]:n}:void 0}function D(e,t,i){if(!e)return[];const r=function(e){
const{fiscal_period_end_fy_h:t,fiscal_period_end_fq_h:i,fiscal_period_end_fh_h:r}=e;if(t||i||r)return{[s.Year]:t,[s.Quarter]:i,[s.HalfYear]:r}}(e);if(!r)return;const o=new l.DateFormatter("MMM yyyy"),n=r[t];return n?n.slice(0,i).reverse().map((e=>{if(!e)return"";const t=new Date(1e3*e);return o.formatLocal(t)})):[]}function R(e){const{total_revenue_fy_h:t,total_revenue_fq_h:i,total_revenue_fh_h:r,net_income_fy_h:o,net_income_fq_h:l,net_income_fh_h:n,total_assets_fy_h:a,total_assets_fq_h:u,total_assets_fh_h:h,total_liabilities_fy_h:d,total_liabilities_fq_h:c,total_liabilities_fh_h:_,cash_f_operating_activities_fy_h:p,cash_f_operating_activities_fq_h:y,cash_f_operating_activities_fh_h:v,cash_f_investing_activities_fy_h:m,cash_f_investing_activities_fq_h:S,cash_f_investing_activities_fh_h:b,cash_f_financing_activities_fy_h:g,cash_f_financing_activities_fq_h:f,cash_f_financing_activities_fh_h:C,fiscal_period_fy_h:w,fiscal_period_fq_h:x,fiscal_period_fh_h:I,interest_income_fy_h:T,interest_income_fq_h:D,interest_income_fh_h:R,non_interest_income_fy_h:k,non_interest_income_fq_h:V,non_interest_income_fh_h:M,fund_view_mode:A}=e,B=P(e);if(B){const{[s.Year]:e,[s.Quarter]:P,[s.HalfYear]:N}=B,E=!e||"industrial"===A&&L(t),F=!P||"industrial"===A&&L(i),H=!N;return{[s.Year]:E?void 0:{total_revenue:t,net_income:o,total_assets:a,total_liabilities:d,cash_f_operating_activities:p,cash_f_investing_activities:m,cash_f_financing_activities:g,fiscal_period:w,interest_income:T,non_interest_income:k},[s.Quarter]:F?void 0:{total_revenue:i,net_income:l,total_assets:u,total_liabilities:c,cash_f_operating_activities:y,cash_f_investing_activities:S,cash_f_financing_activities:f,fiscal_period:x,interest_income:D,non_interest_income:V},[s.HalfYear]:H?void 0:{total_revenue:r,net_income:n,total_assets:h,total_liabilities:_,cash_f_operating_activities:v,cash_f_investing_activities:b,cash_f_financing_activities:C,fiscal_period:I,interest_income:R,non_interest_income:M}}}}function L(e){return!e||e.every((e=>null===e))}},713931:(e,t,i)=>{"use strict";i.d(t,{hideDetailsDialogs:()=>u});var s=i(57761),r=i(719885),o=i(988534),l=i(316478),n=i(273058),a=i(589026);function u(e){"forecast"!==e&&function(){const e=l.ForecastDialogController.getInstance();e.visible()&&e.hide()}(),"technicals"!==e&&function(){const e=r.TechnicalsDialogController.getInstance();e.visible()&&e.hide()}(),"financials"!==e&&function(){const e=o.FinancialsDialogController.getInstance();e.visible()&&e.hide()}(),"options"!==e&&function(){const e=s.OptionsDialogController.getInstance();e.visible()&&e.hide()}(),"etf-analysis"!==e&&function(){const e=n.EtfAnalysisDialogController.getInstance();e.visible()&&e.hide()}(),"bond-yield-curve"!==e&&function(){const e=a.BondYieldCurveDialogController.getInstance();e.visible()&&e.hide()}()}},988534:(e,t,i)=>{"use strict";i.d(t,{FinancialsDialogController:()=>o});var s=i(111393);let r;class o extends s.DialogRenderer{constructor(){super(...arguments),this._dialog=null,this._subscribe=e=>{this._setVisibility(e)}}show(e){this._load(e).then((e=>e.show()))}
hide(){var e;null===(e=this._dialog)||void 0===e||e.hide()}static getInstance(){return r||(r=new o),r}_load(e){return Promise.all([i.e(68716),i.e(77027),i.e(67681),i.e(1893),i.e(42381),i.e(7436),i.e(38697),i.e(43630),i.e(86282),i.e(47821),i.e(11301),i.e(29218),i.e(20442),i.e(89589),i.e(64820),i.e(8191),i.e(81271),i.e(90624),i.e(10456),i.e(72456),i.e(42629),i.e(47416),i.e(12742),i.e(18251),i.e(86494),i.e(14009),i.e(39232),i.e(92203),i.e(19860),i.e(47762),i.e(42922),i.e(30416),i.e(96918),i.e(89455),i.e(35399),i.e(22003),i.e(6867),i.e(21997),i.e(37794),i.e(68941),i.e(75518),i.e(25045),i.e(95543),i.e(74469),i.e(6434),i.e(39499),i.e(77614),i.e(57927),i.e(34583),i.e(92167),i.e(21557),i.e(79630),i.e(51535),i.e(45402),i.e(8486),i.e(30612),i.e(95572),i.e(70819),i.e(71926),i.e(85624),i.e(20609),i.e(51194),i.e(94571),i.e(27965),i.e(90385),i.e(14176),i.e(83630),i.e(52375),i.e(29508),i.e(50097),i.e(3843),i.e(10787),i.e(66788),i.e(24878)]).then(i.bind(i,738323)).then((t=>{var i,s;return null===(i=this._dialog)||void 0===i||i.hide(),null===(s=this._dialog)||void 0===s||s.visible().unsubscribe(this._subscribe),this._dialog=new t.FinancialsDialogRenderer(e),this._dialog.visible().subscribe(this._subscribe),this._dialog}))}}},700134:(e,t,i)=>{"use strict";i.d(t,{showFinancialsDialog:()=>o});var s=i(988534),r=i(713931);function o(e){s.FinancialsDialogController.getInstance().show({...e,onOpen:()=>{(0,r.hideDetailsDialogs)("financials")}})}},316478:(e,t,i)=>{"use strict";i.d(t,{ForecastDialogController:()=>l});var s=i(111393),r=i(583912);let o;class l extends s.DialogRenderer{constructor(){super(...arguments),this._dialog=null,this._subscribe=e=>{this._setVisibility(e)}}show(e){this._load(e).then((e=>e.show()))}hide(){var e;null===(e=this._dialog)||void 0===e||e.hide()}async canBeShown(e){const t=e||r.linking.proSymbol.value(),s=new Set(["recommendation_mark","pro_name"]),o=await(async()=>{const{snapshoter:e}=await i.e(62495).then(i.bind(i,960669));return e().getSnapshot(t,s)})();return!("error"===o.status||!o.values.recommendation_mark)}static getInstance(){return o||(o=new l),o}_load(e){return Promise.all([i.e(68716),i.e(92659),i.e(67681),i.e(1893),i.e(42381),i.e(7436),i.e(43630),i.e(86282),i.e(47821),i.e(11301),i.e(20442),i.e(89589),i.e(8191),i.e(42629),i.e(47416),i.e(12742),i.e(39232),i.e(19860),i.e(96187),i.e(30416),i.e(96918),i.e(35399),i.e(21997),i.e(37794),i.e(68941),i.e(25045),i.e(6434),i.e(77614),i.e(57927),i.e(34583),i.e(92167),i.e(41218),i.e(51535),i.e(45402),i.e(1616),i.e(95572),i.e(84665),i.e(21914),i.e(76911),i.e(20609),i.e(11656),i.e(90385),i.e(14176),i.e(52375),i.e(29508),i.e(50097),i.e(10787),i.e(73248),i.e(85080)]).then(i.bind(i,450602)).then((t=>{var i,s;return null===(i=this._dialog)||void 0===i||i.hide(),null===(s=this._dialog)||void 0===s||s.visible().unsubscribe(this._subscribe),this._dialog=new t.ForecastDialogRenderer(e),this._dialog.visible().subscribe(this._subscribe),this._dialog}))}}},713050:e=>{e.exports={wrap:"wrap-tm3FiOQl",content:"content-tm3FiOQl",contentWithTab:"contentWithTab-tm3FiOQl",
group:"group-tm3FiOQl",subtitle:"subtitle-tm3FiOQl",text:"text-tm3FiOQl",tabsWrapper:"tabsWrapper-tm3FiOQl",tabsContentWrapper:"tabsContentWrapper-tm3FiOQl",groupIcon:"groupIcon-tm3FiOQl",beforeMarketOpen:"beforeMarketOpen-tm3FiOQl",afterMarketClose:"afterMarketClose-tm3FiOQl",groupTitle:"groupTitle-tm3FiOQl",groupRow:"groupRow-tm3FiOQl",groupCell:"groupCell-tm3FiOQl",mob:"mob-tm3FiOQl",mini:"mini-tm3FiOQl",generalContent:"generalContent-tm3FiOQl"}},717496:(e,t,i)=>{"use strict";function s(e){return"FX_IDC:"+e.substring(e.indexOf(":")+1)}i.d(t,{addForexPrefix:()=>s})},680632:(e,t,i)=>{"use strict";i.d(t,{getTickerSymbol:()=>r});var s=i(717496);function r(e,t){return"forex"===t?(0,s.addForexPrefix)(e):e}},111393:(e,t,i)=>{"use strict";i.d(t,{DialogRenderer:()=>r});var s=i(401580);class r{constructor(){this._container=document.createElement("div"),this._visibility=new s.WatchedValue(!1)}visible(){return this._visibility.readonly()}_setVisibility(e){this._visibility.setValue(e)}}},226663:(e,t,i)=>{"use strict";i.d(t,{LollipopGroupIcons:()=>s,LollipopTooltipContentRow:()=>u});var s,r=i(50959),o=i(497754),l=i.n(o),n=i(79205),a=i(713050);function u(e){const{name:t,value:i,style:s,valueStyle:o,onValueClick:u,valueRightIcon:h,className:d}=e;return r.createElement("div",{className:l()(a.groupRow,d),style:s},t&&r.createElement("div",{className:a.groupCell},r.createElement("span",{className:a.text},t)),r.createElement("div",{className:a.groupCell},r.createElement("span",{className:a.text,style:o,onClick:u},i),h&&r.createElement(n.Icon,{icon:h.iconContent,className:l()(a.groupIcon,h.iconClass,"apply-common-tooltip"),title:h.tooltipText})))}!function(e){e[e.BeforeMarketOpen=a.beforeMarketOpen]="BeforeMarketOpen",e[e.AfterMarketClose=a.afterMarketClose]="AfterMarketClose"}(s||(s={}))},195269:(e,t,i)=>{"use strict";i.d(t,{WebviewControllerBase:()=>o,WebviewPageName:()=>s});var s,r=i(583912);!function(e){e.Financials="financials",e.Forecast="forecast",e.Details="details",e.Technicals="technicals",e.EtfAnalysis="etf-analysis"}(s||(s={}));class o{_createOpenRequest(e,t=new URLSearchParams){var i;const s=null!==(i=t.get("symbol"))&&void 0!==i?i:r.linking.symbol.value();return t.set("symbol",s),{execute(){const i=new URL(`webview/${e}/`,location.origin);return i.search=t.toString(),window.open(i,"_blank")},symbol:()=>s}}}},548587:(e,t,i)=>{"use strict";i.d(t,{barFunctionByStyle:()=>r});var s=i(544421);function r(e,t){switch(e){case 12:return(0,s.barFunction)("low","low","close");case 2:case 18:case 14:case 15:case 3:case 10:case 13:return(0,s.barFunction)(null!=t?t:"close");default:return(0,s.barFunction)("close","open")}}},65455:(e,t,i)=>{"use strict";function s(e,t,i=0){t.setValue(e.value());const s={};return e.subscribe(s,(e=>{t.setValue(e.value())})),1===i&&t.subscribe(s,(t=>{e.setValue(t.value())})),()=>{e.unsubscribeAll(s),1===i&&t.unsubscribeAll(s)}}i.d(t,{bindProperties:()=>s})},790524:(e,t,i)=>{"use strict";i.d(t,{isLineToolState:()=>l,isMainSeriesState:()=>r,isStudyLineToolState:()=>n,isStudyState:()=>o});var s=i(616117)
;function r(e){return"MainSeries"===e.type}function o(e){return Boolean(e.type)&&e.type.toLowerCase().startsWith("study")}function l(e){return Boolean(e.type)&&(0,s.isLineToolName)(e.type)}function n(e){return Boolean(e.type)&&(0,s.isStudyLineToolName)(e.type)}},177126:(e,t,i)=>{"use strict";i.d(t,{getDataVendorString:()=>r});var s=i(244842);function r(e){return null==e||s.enabled("bovespa_widget")?null:"QUANDL"===e.exchange?"Quandl.com":["BMFBOVESPA","BME","NAG","TSE","TFX","NZX","BCBA","TWSE","TASE","EURONEXT","TOCOM","BMV","SIX","SGX","GPW","SWB","BCS","WB","SZSE","BELEX","BAHRAIN","EGX","TADAWUL","BVL","LUXSE","DFM","BVC","NSENG","IDX","HSI","QSE","OSE"].includes(e.exchange)?"ICE Data Services":null}},682103:(e,t,i)=>{"use strict";function s(e,t){const i=Math.floor(t/1e4)%1e4,s=Math.floor(t/100)%100-1,r=t%100;return e.format(new Date(Date.UTC(i,s,r)))}i.d(t,{formatYYYYMMDD:()=>s})},531094:(e,t,i)=>{"use strict";i.d(t,{getVolumeUnit:()=>r});var s=i(444372);function r(e){switch(e.volume_type){case"base":return e.base_currency||void 0;case"quote":return e.currency||void 0;case"tick":return s.t(null,void 0,i(130973))}}},995874:(e,t,i)=>{"use strict";function s(e,t){const i=Math.abs(Math.round(1e3*e)/1e3).toFixed(3).split("."),s=i[0];let r=i[1];return t||"0"!==r[r.length-1]||(r=r.slice(0,-1)),`${e<0?"âˆ’":""}${s}.${r}`}i.d(t,{roundToThirdDigit:()=>s})},334652:(e,t,i)=>{"use strict";i.d(t,{alwaysShowLastPriceAndLastDayChange:()=>s,lastDayChangeAvailable:()=>r});i(244842);const s=!1,r=!0},986837:(e,t,i)=>{"use strict";i.d(t,{LollipopPaneView:()=>c});var s=i(650151),r=i(86441),o=i(389137),l=i(142119),n=i(294162),a=i(758363),u=i(382778),h=i(315801),d=i(431912);class c{constructor(e,t,i){this._invalidated=!1,this._renderer=new l.CompositeRenderer,this._textWidthCache=new n.TextWidthCache,this._stylesCache=null,this._lollipops={},this._lollipopsCounter=0,this._lastClickedId=null,this.onPaneBgChange=()=>{this._recreateStyles(this._model)},this._lastClickedId=null,this._model=e,this._source=t,this._clickHandler=i,this._recreateStyles(e),e.backgroundColor().subscribe(this.onPaneBgChange),e.mainSeries().onSymbolIntervalChanged().subscribe(this,this._onSymbolOrIntervalChanged)}destroy(){this._model.backgroundColor().unsubscribe(this.onPaneBgChange),this._model.mainSeries().onSymbolIntervalChanged().unsubscribeAll(this)}processClickOutside(e,t){var i;if(null===this._lastClickedId||!t)return void this.clearLastClicked();let o=null;if((0,d.isTouchMouseEvent)(t))o=new r.Point(t.clientX,t.clientY);else if(function(e){return void 0!==e.touches}(t)){if(1!==t.touches.length)return;{const e=(0,s.ensureNotNull)(t.target).getBoundingClientRect(),i=t.touches[0];o=new r.Point(i.clientX-e.left,i.clientY-e.top)}}else o=new r.Point(t.offsetX,t.offsetY);const l=this._renderer.hitTest(o,e);null!==l&&(null===(i=l.data())||void 0===i?void 0:i.activeItem)===(0,s.ensureDefined)(this._lollipops[this._lastClickedId]).itemIndex||this.clearLastClicked()}clearLastClicked(){const e=null!==this._lastClickedId&&this._lollipops[this._lastClickedId]||null
;null!==e&&(e.active=!1),this._lastClickedId=null}getLastClickedLollipopId(){return this._lastClickedId}update(){this._invalidated=!0}afterUpdate(e,t,i,s){}getStyle(e,t){let i=t;if(e.stack&&(i+="_stack:"+e.stack),"active"===i)return this._activeStyle;if("hovered"===i)return this._hoveredStyle;if("default"===i)return this._defaultStyle;if(this._stylesCache||(this._stylesCache={}),!this._stylesCache[i]){const s=(0,o.clone)("active"===t?this._activeStyle:"hovered"===t?this._hoveredStyle:this._defaultStyle);e.stack&&(s.lollipop.incHeight=25*e.stack),this._stylesCache[i]=s}return this._stylesCache[i]}hasTooltip(e){return!0}_getY(){let e=0;const t=this._model.panes();for(let i=t.length;i--;){const s=t[i];s.containsMainSeries()&&(e+=s.height())}return e}_showBarLine(e){return this.hasTooltip(e)&&(e.hovered||e.active)}_createRenderers(e){const{mediaSize:t}=e;this._renderer.clear();for(const i in this._lollipops)if(this._lollipops.hasOwnProperty(i)){const o=(0,s.ensureDefined)(this._lollipops[i]);if(o.visible){const i=this._getLollipopStatus(o),s=this.getStyle(o,i),l={id:o.id,centerPoint:new r.Point(o.basePoint.x,o.basePoint.y-s.lollipop.bottom-s.lollipop.height/2-(s.lollipop.incHeight||0)),style:s,status:i},n={activeItem:o.itemIndex,hideCrosshairLinesOnHover:!0,clickHandler:this._lollipopMouseClickHandler.bind(this,e,l,t),tapHandler:this._lollipopMouseClickHandler.bind(this,e,l,t)};if(this._renderer.append(this._createRendererForLollipop(l,n)),this._showBarLine(o)){const{strokeStyle:e,lineStyle:t,lineWidth:i}=s.barLine,r={color:e,linestyle:t,linewidth:i,x:o.basePoint.x,top:0,bottom:o.basePoint.y-s.lollipop.bottom-s.lollipop.height},l=new a.VerticalLineRenderer;l.setData(r),this._renderer.insert(l,0)}}}}_recreateStyles(e){this._stylesCache=null}_createRendererForLollipop(e,t){return new u.LollipopRenderer(e,new h.HitTestResult(h.HitTarget.Custom,t),this._textWidthCache)}_onSymbolOrIntervalChanged(){this._lollipops={},this._lollipopsCounter=0,this._renderer.clear(),this.clearLastClicked()}_lollipopMouseClickHandler(e,t,i,o){o.preventDefault();const l=t.id;if(this._lastClickedId=this._lastClickedId===l?null:l,null===this._lastClickedId)return;const n={target:o.target,targetSize:i,point:new r.Point(t.centerPoint.x,t.centerPoint.y-t.style.lollipop.height/2-8),marginTop:15};this._clickHandler(e,n,(()=>{const e=(0,s.ensureDefined)(this._lollipops[l]);return this._createTooltipContent(e)}))}_getLollipopStatus(e){return e.active?"active":e.hovered?"hovered":"default"}}},382778:(e,t,i)=>{"use strict";i.d(t,{LollipopRenderer:()=>u});var s=i(934026),r=i(86441),o=i(458963),l=i(787123),n=i(199471),a=i(9640);class u{constructor(e,t,i){this._data=e,this._hittest=t,this._textWidthCache=i}draw(e,t){const{horizontalPixelRatio:i,verticalPixelRatio:s}=t,o=this._data.centerPoint,l=Math.round(o.x*i),n=Math.round(o.y*s),a=Math.max(1,Math.floor(i))%2/2,u=Math.max(1,Math.floor(s))%2/2,h=new r.Point(l+a,n-u);this._drawLollipop(e,h,t),this._drawLabel(e,h,t)}hitTest(e){const t=(0,
a.interactionTolerance)().esd,i=this._data.centerPoint.y-this._data.style.lollipop.height/2-t,o=this._data.centerPoint.x-this._data.style.lollipop.width/2-t,l=(0,r.box)(new r.Point(o,i),new r.Point(o+this._data.style.lollipop.width+2*t,i+this._data.style.lollipop.height+2*t));return(0,s.pointInBox)(e,l)?this._hittest:null}_drawLollipop(e,t,i){const s=this._data.style,{horizontalPixelRatio:r}=i,o=this._fillRadius(r);s.lollipop.fillCircle&&s.lollipop.backgroundColor&&this._drawFilledCircle(e,t,o,s.lollipop.backgroundColor);const l=Math.round(s.lollipop.lineWidth*r),n=o-Math.round(1*r+l/2);this._drawBorderLine(e,t,l,n),s.lollipop.fillCircle&&s.lollipop.fillStyle&&this._drawFilledCircle(e,t,n,s.lollipop.fillStyle)}_drawLabel(e,t,i){const s=this._data.style.lollipop.text,r=s.label;if(""===r)return;const{horizontalPixelRatio:o,verticalPixelRatio:l}=i;e.textAlign="center",e.textBaseline="middle",e.fillStyle=s.strokeStyle,e.font=s.font;const a=this._textWidthCache.yMidCorrection(e,r);e.translate(t.x,t.y+((s.deltaY||0)+a)*l),(0,n.drawScaled)(e,o,l,(()=>{e.fillText(r,0,0)}))}_fillRadius(e){const t=this._data.style,i=Math.max(1,Math.floor(e));let s=Math.round(t.lollipop.width*e);return s%2!=i%2&&(s+=1),s/2}_drawBorderLine(e,t,i,s){const r=this._data.style;e.strokeStyle=r.lollipop.strokeStyle,e.lineWidth=i,(0,l.setLineStyle)(e,o.LINESTYLE_SOLID),(0,l.createCircle)(e,t.x,t.y,s),e.stroke()}_drawFilledCircle(e,t,i,s){e.fillStyle=s,(0,l.createCircle)(e,t.x,t.y,i),e.fill()}}},356747:(e,t,i)=>{"use strict";i.r(t),i.d(t,{QuotesProvider:()=>l});var s=i(876332),r=i(707957),o=i(541558);class l{constructor(e="full",t){var i;this._quotes=null,this._quoteSessionSymbol=null,this._quoteSessionClientId="",this._pausedQuoteSessionSymbol=null,this._quotesUpdate=new r.Delegate,this._quoteSymbolChanged=new r.Delegate,this._multiplexerType=e,this._hibernated=t,null===(i=this._hibernated)||void 0===i||i.subscribe((e=>{e?this.pause():this.resume()}))}setQuotesSessionSymbol(e){this._quoteSessionSymbol!==e&&(this._pausedQuoteSessionSymbol=null,this._quoteSessionClientId||(this._quoteSessionClientId="series-"+(0,o.guid)()),this._unsubscribeQuoteSession(),this._quoteSessionSymbol=e,this._quoteSymbolChanged.fire(),e&&this._subscribeQuoteSession(e))}symbol(){return this._quoteSessionSymbol}quotesUpdate(){return this._quotesUpdate}quoteSymbolChanged(){return this._quoteSymbolChanged}quotes(){return this._quotes}async quotesSnapshot(e){return(0,s.getQuoteSessionInstance)("simple").snapshot(e)}isPaused(){return null!==this._pausedQuoteSessionSymbol}pause(){null===this._pausedQuoteSessionSymbol&&(this._pausedQuoteSessionSymbol=this._quoteSessionSymbol,this._unsubscribeQuoteSession())}resume(){null!==this._pausedQuoteSessionSymbol&&(this._subscribeQuoteSession(this._pausedQuoteSessionSymbol),this._pausedQuoteSessionSymbol=null)}destroy(){var e;this._unsubscribeQuoteSession(),null===(e=this._hibernated)||void 0===e||e.release()}_onUpdate(e,t){this._quotes=e&&e.values||null,t&&t.values&&this._quotesUpdate.fire(e,t)}_subscribeQuoteSession(e){
this._quoteSessionSymbol=e,(0,s.getQuoteSessionInstance)(this._multiplexerType).subscribe(this._quoteSessionClientId,this._quoteSessionSymbol,this._onUpdate.bind(this))}_unsubscribeQuoteSession(){this._quoteSessionSymbol&&((0,s.getQuoteSessionInstance)(this._multiplexerType).unsubscribe(this._quoteSessionClientId,this._quoteSessionSymbol),this._quoteSessionSymbol=null,this._quotes=null)}}},711757:(e,t,i)=>{"use strict";i.d(t,{SeriesBarColorer:()=>p});var s=i(790188),r=i(650151),o=i(488530),l=i(534741),n=i(938471);const a=(0,s.getHexColorByName)("color-minty-green-500"),u=(0,s.getHexColorByName)("color-ripe-red-500");function h(e){return{barColor:e.upColor.value(),barBorderColor:e.borderUpColor?e.borderUpColor.value():e.borderColor.value()}}function d(e){return{barColor:e.downColor.value(),barBorderColor:e.borderDownColor?e.borderDownColor.value():e.borderColor.value()}}function c(e,t){return e.borderUpColorProjection&&e.borderUpColor?{barColor:t?e.upColorProjection.value():e.upColor.value(),barBorderColor:t?e.borderUpColorProjection.value():e.borderUpColor.value()}:{barColor:t?e.upColorProjection.value():e.upColor.value()}}function _(e,t){return e.borderDownColorProjection&&e.borderDownColor?{barColor:t?e.downColorProjection.value():e.downColor.value(),barBorderColor:t?e.borderDownColorProjection.value():e.borderDownColor.value()}:{barColor:t?e.downColorProjection.value():e.downColor.value()}}class p extends n.AbstractBarColorer{constructor(e){super(),this._series=e}applyBarStyle(e,t,i,s){const r=i;r.barColor=void 0,r.barBorderColor=void 0,r.barWickColor=void 0,r.isBarHollow=void 0,r.isBarUp=void 0,r.upColor=void 0,r.downColor=void 0,r.isTwoColorBar=void 0,r.isMergedBar=void 0;const o=this._series.properties();switch(o.childs().style.value()){case 2:case 18:case 14:case 15:this._applyLineStyle(i,o);break;case 3:this._applyAreaStyle(i,o);break;case 16:this._applyHLCAreaStyle(e,t,i,s,o);break;case 0:this._applyBarStyle(e,i,s,o);break;case 17:case 1:case 19:this._applyCandleStyle(e,i,s,o);break;case 9:this._applyHollowCandleStyle(e,i,s,o);break;case 8:this._applyHAStyle(e,t,i,s,o);break;case 10:this._applyBaseLineStyle(e,t,i,s,o);break;case 12:this._applyHiLoStyle(t,i,o);break;case 13:this._applyColumnStyle(e,i,s,o);break;case 4:this._applyRenkoStyle(e,t,i,s,o);break;case 7:this._applyPBStyle(e,t,i,s,o);break;case 5:this._applyKagiStyle(e,t,i,s,o);break;case 6:this._applyPnfStyle(e,t,i,s,o);break;case 11:this._applyRangeStyle(e,t,i,s,o)}return i}static upColor(e,t){const i=e.childs(),s=i.style.value();switch(s){case 18:return{barColor:i.tpoStyle.childs().color.value()};case 2:return{barColor:i.lineStyle.childs().color.value()};case 14:return{barColor:i.lineWithMarkersStyle.childs().color.value()};case 15:return{barColor:i.steplineStyle.childs().color.value()};case 3:return{barColor:i.areaStyle.childs().linecolor.value()};case 16:return{barColor:i.hlcAreaStyle.childs().closeLineColor.value(),barBorderColor:a};case 0:return{barColor:i.barStyle.childs().upColor.value()};case 17:return h(i.volFootprintStyle.childs())
;case 19:return h(i.volCandlesStyle.childs());case 1:return h(i.candleStyle.childs());case 9:return h(i.hollowCandleStyle.childs());case 8:return h(i.haStyle.childs());case 10:return{barColor:i.baselineStyle.childs().topLineColor.value()};case 12:return{barColor:i.hiloStyle.childs().color.value(),barBorderColor:e.childs().hiloStyle.childs().borderColor.value()};case 13:return{barColor:i.columnStyle.childs().upColor.value()};case 4:return c(i.renkoStyle.childs(),t);case 7:return c(i.pbStyle.childs(),t);case 5:return c(i.kagiStyle.childs(),t);case 6:return c(i.pnfStyle.childs(),t);case 11:0;const s=i.rangeStyle.childs(),r=s.barStyle.value()===o.RangeBarStyle.Bars;return{barColor:t?s.upColorProjection.value():r?s.upColor.value():s.candlesUpColor.value(),barBorderColor:t?s.upColorProjection.value():r?s.upColor.value():s.candlesBorderUpColor.value()}}(0,r.ensureNever)(s)}static downColor(e,t){const i=e.childs(),s=i.style.value();switch(s){case 2:return{barColor:i.lineStyle.childs().color.value()};case 18:return{barColor:i.tpoStyle.childs().color.value()};case 14:return{barColor:i.lineWithMarkersStyle.childs().color.value()};case 15:return{barColor:i.steplineStyle.childs().color.value()};case 3:return{barColor:i.areaStyle.childs().linecolor.value()};case 16:return{barColor:i.hlcAreaStyle.childs().closeLineColor.value(),barBorderColor:u};case 0:return{barColor:i.barStyle.childs().downColor.value()};case 17:return d(i.volFootprintStyle.childs());case 1:return d(i.candleStyle.childs());case 19:return d(i.volCandlesStyle.childs());case 9:return d(i.hollowCandleStyle.childs());case 8:return d(i.haStyle.childs());case 10:return{barColor:i.baselineStyle.childs().bottomLineColor.value()};case 12:return{barColor:i.hiloStyle.childs().color.value(),barBorderColor:e.childs().hiloStyle.childs().borderColor.value()};case 13:return{barColor:i.columnStyle.childs().downColor.value()};case 4:return _(i.renkoStyle.childs(),t);case 7:return _(i.pbStyle.childs(),t);case 5:return _(i.kagiStyle.childs(),t);case 6:return _(i.pnfStyle.childs(),t);case 11:0;const s=i.rangeStyle.childs(),r=s.barStyle.value()===o.RangeBarStyle.Bars;return{barColor:t?s.downColorProjection.value():r?s.downColor.value():s.candlesDownColor.value(),barBorderColor:t?s.downColorProjection.value():r?s.downColor.value():s.candlesBorderDownColor.value()}}(0,r.ensureNever)(s)}_applyLineStyle(e,t){e.barColor=p.upColor(t).barColor}_applyAreaStyle(e,t){e.barColor=p.upColor(t).barColor}_applyHLCAreaStyle(e,t,i,s,r){var o;const l=this._isUp(e,!1,s,(null===(o=this._series.data().first())||void 0===o?void 0:o.index)!==e)?p.upColor(r,t):p.downColor(r,t);i.barColor=l.barColor,i.barBorderColor=l.barBorderColor}_applyBarStyle(e,t,i,s){const r=this._isUp(e,!1,i,s.childs().barStyle.childs().barColorsOnPrevClose.value())?p.upColor(s):p.downColor(s);t.barColor=r.barColor,t.barBorderColor=r.barBorderColor}_applyCandleStyle(e,t,i,s){var r
;const o=s.childs(),l=1===o.style.value()?o.candleStyle.childs():19===o.style.value()?o.volCandlesStyle.childs():o.volFootprintStyle.childs(),n=this._isUp(e,!1,i,l.barColorsOnPrevClose.value()&&(null===(r=this._series.data().first())||void 0===r?void 0:r.index)!==e),a=n?p.upColor(s):p.downColor(s);t.barColor=a.barColor,t.barBorderColor=a.barBorderColor,t.barWickColor=n?l.wickUpColor?l.wickUpColor.value():l.wickColor.value():l.wickDownColor?l.wickDownColor.value():l.wickColor.value()}_applyHollowCandleStyle(e,t,i,s){var r;const o=s.childs().hollowCandleStyle.childs(),l=this._isUp(e,!1,i,(null===(r=this._series.data().first())||void 0===r?void 0:r.index)!==e),n=l?p.upColor(s):p.downColor(s);t.barColor=n.barColor,t.barBorderColor=n.barBorderColor,t.barWickColor=l?o.wickUpColor?o.wickUpColor.value():o.wickColor.value():o.wickDownColor?o.wickDownColor.value():o.wickColor.value();const a=this._findBar(e,!1,i);t.isBarHollow=a[1]<=a[4]}_applyHAStyle(e,t,i,s,r){const o=r.childs().haStyle.childs(),l=this._isUp(e,t,s,o.barColorsOnPrevClose.value()),n=l?p.upColor(r):p.downColor(r);i.barColor=n.barColor,i.barBorderColor=n.barBorderColor,i.barWickColor=l?o.wickUpColor.value():o.wickDownColor.value()}_applyBaseLineStyle(e,t,i,s,o){const l=this._findBar(e,t,s),n=o.childs().baselineStyle.childs(),a=this._series.priceScale(),u=Math.round(a.height()*(Math.abs(100-n.baseLevelPercentage.value())/100)),h=(0,r.ensureNotNull)(this._series.firstValue()),d=a.coordinateToPrice(u,h);l[4]>d?i.barColor=p.upColor(o,t).barColor:i.barColor=p.downColor(o,t).barColor}_applyHiLoStyle(e,t,i){const s=p.upColor(i,e);t.barColor=s.barColor,t.barBorderColor=s.barBorderColor}_applyColumnStyle(e,t,i,s){const r=s.childs().columnStyle.childs(),o=this._isUp(e,!1,i,r.barColorsOnPrevClose.value())?p.upColor(s):p.downColor(s);t.color=o.barColor,t.barColor=t.color}_applyRenkoStyle(e,t,i,s,r){const o=r.childs().renkoStyle.childs(),l=this._isUp(e,t,s,!1),n=l?p.upColor(r,t):p.downColor(r,t);i.barColor=n.barColor,i.barBorderColor=n.barBorderColor,i.barWickColor=l?o.wickUpColor.value():o.wickDownColor.value(),i.isBarUp=l}_applyPBStyle(e,t,i,s,r){const o=this._isUp(e,t,s,!1),l=o?p.upColor(r,t):p.downColor(r,t);i.barColor=l.barColor,i.barBorderColor=l.barBorderColor,i.isBarUp=o}_applyKagiStyle(e,t,i,s,r){let o;i.upColor=p.upColor(r,t).barColor,i.downColor=p.downColor(r,t).barColor;const l=this._findBar(e,t,s);l[3]<l[6]&&l[6]<l[2]?(o=l[1]<=l[4],i.isTwoColorBar=!0):(o=l[1]<=l[4]?l[1]===l[6]:l[1]!==l[6],i.isTwoColorBar=!1),i.barColor=o?i.upColor:i.downColor,i.isBarUp=l[1]<=l[4]}_applyPnfStyle(e,t,i,s,r){const o=this._findBar(e,t,s)[6],l=o>0,n=p.upColor(r,t),a=p.downColor(r,t);i.isBarUp=l,i.isMergedBar=2===Math.abs(o),i.upColor=n.barColor,i.downColor=a.barColor,i.barColor=l?n.barColor:a.barColor}_applyRangeStyle(e,t,i,s,r){
const l=r.childs().rangeStyle.childs(),n=l.barStyle.value()===o.RangeBarStyle.Bars,a=this._isUp(e,!1,s,!1),u=a?p.upColor(r,t):p.downColor(r,t),h=a?t?l.upColorProjection.value():n?void 0:l.candlesWickUpColor.value():t?l.downColorProjection.value():n?void 0:l.candlesWickDownColor.value();i.barColor=u.barColor,i.barBorderColor=u.barBorderColor,i.wickColor=h,i.barWickColor=h}_findBar(e,t,i){return i?i.value:this._getSeriesBars(t).valueAt(e)||[]}_findPrevBar(e,t,i){if(i&&i.previousValue)return i.previousValue;const s=this._series.bars().search(e-1,l.PlotRowSearchMode.NearestLeft,4);return null!==s?s.value:[]}_getSeriesBars(e){return e?this._series.nsBars():this._series.bars()}_isUp(e,t,i,s){const r=this._findBar(e,t,i);if(s){return this._findPrevBar(e,t,i)[4]<=r[4]}return r[1]<=r[4]}}},904891:(e,t,i)=>{"use strict";i.d(t,{SeriesAreaPaneView:()=>a});var s=i(246733),r=i(413225),o=i(142119),l=i(230058),n=i(143389);class a extends n.SeriesSingleLinePaneView{renderer(){this._invalidated&&(this._updateImpl(),this._invalidated=!1);const e=this._source.priceScale();if(!e)return null;const t=this._source.properties().childs().areaStyle.childs(),i=t.transparency.value(),n={simpleMode:!1,barSpacing:this._model.timeScale().barSpacing(),items:this._items,lineColor:t.linecolor.value(),lineStyle:t.linestyle.value(),lineWidth:t.linewidth.value(),isSeries:!0,withMarkers:!1,bottom:e.height(),color1:(0,s.generateColor)(t.color1.value(),i),color2:(0,s.generateColor)(t.color2.value(),i),skipHoles:!0},a=new o.CompositeRenderer;return a.append(new r.PaneRendererArea(n)),this._model.selection().isSelected(this._source)&&this._isMarkersEnabled&&this._selectionData&&a.append(new l.SelectionRenderer(this._selectionData)),a}}},825278:(e,t,i)=>{"use strict";i.d(t,{SeriesBarsPaneView:()=>n});var s=i(142119),r=i(230058),o=i(891512),l=i(969419);class n extends o.SeriesBarCandlesPaneView{renderer(){this._invalidated&&(this._updateImpl(null),this._invalidated=!1);const e=this._source.properties().childs(),t={bars:this._bars,dontDrawOpen:e.barStyle.childs().dontDrawOpen.value(),thinBars:11===e.style.value()?e.rangeStyle.childs().thinBars.value():e.barStyle.childs().thinBars.value()},i=new s.CompositeRenderer;return i.append(new l.PaneRendererBars(t)),this._model.selection().isSelected(this._source)&&this._isMarkersEnabled&&this._selectionData&&i.append(new r.SelectionRenderer(this._selectionData)),i}_createItem(e,t,i){const s={center:NaN,open:NaN,high:NaN,low:NaN,close:NaN,color:i.barColor,left:NaN,right:NaN,timePointIndex:e};return(0,o.baseBarCandlesUpdater)(t,s)?s:null}}},255799:(e,t,i)=>{"use strict";i.d(t,{SeriesBaselinePaneView:()=>y});var s=i(246733),r=i(142119),o=i(86441),l=i(5531),n=i(204652),a=i(9640),u=i(674981),h=i(710455),d=i(315801);class c extends h.MediaCoordinatesPaneRenderer{constructor(){super(...arguments),this._data=null}setData(e){this._data=e}hitTest(e){if(null===this._data)return null;const{items:t,topLineWidth:i,bottomLineWidth:s}=this._data,r=(0,a.interactionTolerance)().series+(i+s)/4,l=(0,
u.lowerbound)(t,e,((e,t)=>e.center<=t.x)),h=Math.max(1,l-1),c=Math.min(t.length-1,l+1);for(let i=h;i<=c;++i){const s=t[i-1],l=t[i],{distance:a}=(0,n.distanceToSegment)((0,o.point)(s.center,s.y),(0,o.point)(l.center,l.y),(0,o.point)(e.x,e.y));if(a<=r)return new d.HitTestResult(d.HitTarget.Regular)}return null}_drawImpl(e){if(null===this._data)return;const{items:t,baseLevelCoordinate:i,bottom:s,bottomFillColor1:r,bottomFillColor2:n,topFillColor1:u,topFillColor2:h,topLineColor:d,bottomLineColor:c,topLineWidth:_,bottomLineWidth:p}=this._data;if(!function(e){if(0===e.length)return!1;const t=e.findIndex((e=>(0,a.coordinateIsValid)(e.y)));if(-1===t)return!1;let i=e.length-1;for(;i>t&&!(0,a.coordinateIsValid)(e[i].y);)i--;return!(t>i)}(t))return;const y=e.context,{topItems:v,bottomItems:m}=function(e,t){const i=[],s=[];let r=null;for(let n=0;n<e.length;n++){let u=e[n];const h=e[n+1]||{};if((0,a.coordinateIsValid)(u.y))u.y<=t&&i.push(u),u.y>=t&&s.push(u),r=u;else{if(null===r)continue;u=r}if((0,a.coordinateIsValid)(h.y)&&(u.y>t&&h.y<t||u.y<t&&h.y>t))if(Math.abs(u.center-h.center)<1){const e={center:u.center,y:t};i.push(e),s.push(e)}else{const e=(0,l.intersectLineSegments)((0,o.point)(u.center,u.y),(0,o.point)(h.center,h.y),(0,o.point)(u.center,t),(0,o.point)(h.center,t));if(null!==e){const t={center:u.center+(h.center-u.center)*e,y:u.y+(h.y-u.y)*e};i.push(t),s.push(t)}}}return{topItems:i,bottomItems:s}}(t,i);y.lineCap="round",y.lineJoin="round",0!==v.length&&(y.beginPath(),y.moveTo(v[0].center,i),this._makeLine(y,v,!0,0),y.closePath(),y.fillStyle=this._makeLinearGradient(y,u,h,i-s,i),y.fill(),y.beginPath(),this._makeLine(y,v,!1,0),y.lineWidth=_,y.strokeStyle=d,y.stroke()),0!==m.length&&(y.beginPath(),y.moveTo(m[0].center,i),this._makeLine(y,m,!0,1),y.closePath(),y.fillStyle=this._makeLinearGradient(y,r,n,i,i+s),y.fill(),y.beginPath(),this._makeLine(y,m,!1,1),y.lineWidth=p,y.strokeStyle=c,y.stroke())}_makeLine(e,t,i,s){if(null===this._data)return;const r=t.findIndex((e=>(0,a.coordinateIsValid)(e.y)));if(-1===r)return;const{barSpacing:o,baseLevelCoordinate:l}=this._data,n=.25*o;let u;const h=t.length;for(let o=r;o<h;o++){const h=t[o],d=t[o+1]||{};if((0,a.coordinateIsValid)(h.y)){if(0===s){if(u&&u.y>=l&&h.y>=l){e.moveTo(h.center,h.y);continue}}else if(u&&u.y<=l&&h.y<=l){e.moveTo(h.center,h.y);continue}if(u&&(0,a.coordinateIsValid)(u.y))e.lineTo(h.center,h.y),i&&!(0,a.coordinateIsValid)(d.y)&&e.lineTo(h.center,l);else if(d&&(0,a.coordinateIsValid)(d.y))i?(o!==r&&e.lineTo(h.center,l),e.lineTo(h.center,h.y)):e.moveTo(h.center,h.y);else if(i){if(0===o)continue;o!==r&&e.lineTo(h.center-n,l),e.lineTo(h.center-n,h.y),e.lineTo(h.center+n,h.y),e.lineTo(h.center+n,l)}else e.moveTo(h.center-n,h.y),e.lineTo(h.center+n,h.y);u=h}}}_makeLinearGradient(e,t,i,s,r){const o=e.createLinearGradient(0,s,0,r);return o.addColorStop(0,t),o.addColorStop(1,i),o}}var _=i(230058),p=i(143389);class y extends p.SeriesSingleLinePaneView{constructor(){super(...arguments),this._renderer=new c,this._topFillColor1="",this._topFillColor2="",
this._bottomFillColor1="",this._bottomFillColor2="",this._topLineColor="",this._bottomLineColor="",this._topLineWidth=0,this._bottomLineWidth=0,this._barSpacing=0,this._bottom=0,this._baseLevelCoordinate=0}renderer(){this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._renderer.setData({items:this._items,topFillColor1:this._topFillColor1,topFillColor2:this._topFillColor2,bottomFillColor1:this._bottomFillColor1,bottomFillColor2:this._bottomFillColor2,topLineColor:this._topLineColor,bottomLineColor:this._bottomLineColor,topLineWidth:this._topLineWidth,bottomLineWidth:this._bottomLineWidth,barSpacing:this._barSpacing,baseLevelCoordinate:this._baseLevelCoordinate,bottom:this._bottom});const e=new r.CompositeRenderer;return e.append(this._renderer),this._model.selection().isSelected(this._source)&&this._isMarkersEnabled&&this._selectionData&&e.append(new _.SelectionRenderer(this._selectionData)),e}_updateImpl(){super._updateImpl();const e=this._source.priceScale();if(!e)return;const t=this._source.properties().childs().baselineStyle.childs(),i=t.transparency.value();this._topFillColor1=(0,s.generateColor)(t.topFillColor1.value(),i),this._topFillColor2=(0,s.generateColor)(t.topFillColor2.value(),i),this._bottomFillColor1=(0,s.generateColor)(t.bottomFillColor1.value(),i),this._bottomFillColor2=(0,s.generateColor)(t.bottomFillColor2.value(),i),this._topLineColor=t.topLineColor.value(),this._bottomLineColor=t.bottomLineColor.value(),this._topLineWidth=t.topLineWidth.value(),this._bottomLineWidth=t.bottomLineWidth.value(),this._barSpacing=this._model.timeScale().barSpacing(),this._bottom=e.height(),this._baseLevelCoordinate=Math.round(this._bottom*(Math.abs(100-t.baseLevelPercentage.value())/100))}}},147664:(e,t,i)=>{"use strict";i.d(t,{SeriesWaterlinePaneView:()=>n});var s=i(955831),r=i(147354),o=i(315801),l=i(458963);class n extends s.HorizontalLinePaneView{constructor(e){super(),this._getters=e;const t={cursorType:r.PaneCursorType.VerticalResize,activeItem:0,areaName:o.AreaName.SourceItemMove};this._lineRenderer.setHitTest(new o.HitTestResult(o.HitTarget.MovePoint,t)),this._lineRendererData.visible=!0,this._lineRendererData.linestyle=l.LINESTYLE_SPARSE_DOTTED}_updateImpl(){const{baseLevelPercentage:e,paneHeight:t,color:i}=this._getters,s=Math.abs(100-e());this._lineRendererData.y=Math.round(t()*(s/100)),this._lineRendererData.color=i()}}},245242:(e,t,i)=>{"use strict";i.d(t,{SeriesCandlesPaneView:()=>a});var s=i(142119),r=i(9640),o=i(230058),l=i(891512),n=i(956725);class a extends l.SeriesBarCandlesPaneView{constructor(e,t,i=1){super(e,t),this._scaleCoeff=1,this._scaleCoeff=i}renderer(){this._invalidated&&(this._updateImpl(null),this._invalidated=!1);const e=this._source.priceScale();if(!e)return null;const t=this._source.properties().childs(),i=1===t.style.value()?t.candleStyle.childs():19===t.style.value()?t.volCandlesStyle.childs():t.volFootprintStyle.childs(),l=this._model.timeScale().barSpacing(),a={bars:this._bars,barSpacing:l,bodyVisible:i.drawBody.value(),borderVisible:i.drawBorder.value(),
borderColor:i.borderColor.value(),wickColor:i.wickColor.value(),barWidth:(0,r.optimalBarWidth)(l),wickVisible:i.drawWick.value(),isPriceScaleInverted:e.isInverted(),scaleCoeff:this._scaleCoeff},u=new s.CompositeRenderer;return u.append(new n.PaneRendererCandles(a)),this._model.selection().isSelected(this._source)&&this._isMarkersEnabled&&this._selectionData&&u.append(new o.SelectionRenderer(this._selectionData)),u}_createItem(e,t,i){const s={center:NaN,open:NaN,high:NaN,low:NaN,close:NaN,left:NaN,right:NaN,timePointIndex:e,color:i.barColor,borderColor:i.barBorderColor,wickColor:i.barWickColor,hollow:i.isBarHollow};return(0,l.baseBarCandlesUpdater)(t,s)?s:null}}},72731:(e,t,i)=>{"use strict";i.d(t,{SeriesColumnsPaneView:()=>_});var s=i(650151),r=i(86441),o=i(244842),l=i(203308),n=i(315801),a=i(142119),u=i(534741),h=i(63316),d=i(230058),c=i(793907);class _{constructor(e,t){this._items=[],this._invalidated=!0,this._isMarkersEnabled=(0,o.enabled)("source_selection_markers"),this._selectionData=null,this._histogramBase=0,this._source=e,this._model=t,this._selectionIndexer=new h.SelectionIndexes(t.timeScale())}update(){this._invalidated=!0}renderer(){this._invalidated&&(this._updateImpl(),this._invalidated=!1);const e={barSpacing:this._model.timeScale().barSpacing(),items:this._items,lineColor:"",histogramBase:this._histogramBase},t=new a.CompositeRenderer;return t.append(new c.PaneRendererColumns(e)),this._model.selection().isSelected(this._source)&&this._isMarkersEnabled&&this._selectionData&&t.append(new d.SelectionRenderer(this._selectionData)),t}_updateImpl(){this._items=[];const e=this._model.timeScale(),t=this._source.priceScale();if(e.isEmpty()||!t||t.isEmpty())return;const i=e.visibleBarsStrictRange();if(null===i)return;if(0===this._source.bars().size())return;const o=this._source.nearestIndex(i.firstBar(),u.PlotRowSearchMode.NearestRight),a=this._source.nearestIndex(i.lastBar(),u.PlotRowSearchMode.NearestLeft);if(void 0===o||void 0===a)return;const h=this._source.bars().range(o,a),d=this._source.barColorer(),c={},_=this._source.barFunction(),p=h.reduce(((e,t,s)=>{const r=_(s);if(!(0,l.default)(r))return e;c.value=s;let o=this._source.precomputedBarStyle(s);return void 0===o&&(o=d.barStyle(t,!1,c),this._source.setPrecomputedBarStyle(s,o)),this._items.push({timePointIndex:t,left:NaN,center:NaN,right:NaN,y:r,style:o}),c.previousValue=s,i.contains(t)&&null!=e?e:r}),null);if(null!==p)if(t.pointsArrayToCoordinates(this._items,p),e.fillBarBorders(this._items),this._histogramBase=t.isInverted()?0:t.height(),this._model.selection().isSelected(this._source)){const i=this._selectionIndexer.indexes();this._selectionData={points:[],bgColors:[],visible:!0,barSpacing:e.barSpacing(),hittestResult:n.HitTarget.Regular};const o=(0,s.ensureNotNull)(this._model.paneForSource(this._source)).height();this._selectionData.hittestResult=n.HitTarget.Regular;for(let s=0;s<i.length;s++){const l=i[s],n=this._source.bars().valueAt(l);if(null===n)continue;const a=_(n),u=e.indexToCoordinate(l),h=t.priceToCoordinate(a,p)
;this._selectionData.points.push(new r.Point(u,h)),this._selectionData.bgColors.push(this._model.backgroundColorAtYPercentFromTop(h/o))}}else this._selectionIndexer.clear()}}},262550:(e,t,i)=>{"use strict";i.d(t,{SeriesHiLoPaneView:()=>v});var s=i(448874),r=i(511131),o=i(674981),l=i(9640),n=i(315801),a=i(710455);class u extends a.MediaCoordinatesPaneRenderer{constructor(){super(...arguments),this._data=null,this._barWidth=null}setData(e){this._data=e,this._barWidth=Math.max(1,Math.round((0,l.optimalHiLoWidth)(e.barSpacing)))}hitTest(e){if(null===this._data||null===this._barWidth)return null;const t=this._data.bars,i=.5*this._data.barSpacing;if(0===t.length)return null;if(e.x<t[0].center-i)return null;if(e.x>t[t.length-1].center+i)return null;const s=t[(0,o.lowerbound)(t,e.x-i,((e,t)=>e.center<t))];if(e.x<s.center-i||e.x>s.center+i)return null;const r=(0,l.interactionTolerance)().series+this._barWidth/2,a=Math.min(s.high,s.low),u=Math.max(s.high,s.low),h=this._data.fontSize;return a-r-h<=e.y&&e.y<=a+r||u-r<=e.y&&e.y<=u+r+h?new n.HitTestResult(n.HitTarget.Regular):null}_drawImpl(e){if(null===this._data||null===this._barWidth)return;const{font:t,fontSize:i,labelColor:s,bars:o,inverted:l,labelsPadding:n}=this._data,a=e.context;a.textAlign="center",a.fillStyle=s,a.font=(0,r.makeFont)(i,t);for(let e=0;e<o.length;++e){const t=o[e],i=Math.round(Math.min(t.high,t.low)),s=Math.round(Math.max(t.high,t.low)),r=Math.round(t.center);a.textBaseline="alphabetic",a.fillText(l?t.lowLabel:t.highLabel,r,i-n),a.textBaseline="top",a.fillText(l?t.highLabel:t.lowLabel,r,s+n)}}}var h=i(142119),d=i(230058),c=i(422333),_=i(199471),p=i(956725),y=i(891512);class v extends y.SeriesBarCandlesPaneView{constructor(e,t){super(e,t),this._labelsRenderer=new u,this._candlesRenderer=new p.PaneRendererCandles,this._maxLengthLabel="",this._calculateFontSize=(0,s.default)(((e,t)=>Math.max(1,(0,o.lowerboundExt)((e=>e+1),null,(i=>{const s=(0,r.makeFont)(i,c.CHART_FONT_FAMILY);return(0,_.measureText)(e,s).width<=t}),7,36))),((e,t)=>`${e}/${t}`))}renderer(){const e=this._source.priceScale();if(!e||e.isEmpty())return null;const t=new h.CompositeRenderer,i=this._needLabels(),s=this._source.properties().childs().hiloStyle.childs(),r=this._model.timeScale().barSpacing();if(this._invalidated){const e=this._source.formatter();this._maxLengthLabel="",this._updateImpl({generateLabels:i,formatter:e}),this._invalidated=!1}if(this._candlesRenderer.setData({bars:this._bars,wickVisible:!1,bodyVisible:s.drawBody.value(),barSpacing:r,borderVisible:s.showBorders.value(),barWidth:(0,l.optimalHiLoWidth)(r),isPriceScaleInverted:e.isInverted()}),t.append(this._candlesRenderer),i){const i=this._calculateLabelFontSize();i&&i>=8&&(this._labelsRenderer.setData({bars:this._bars,barSpacing:r,font:c.CHART_FONT_FAMILY,fontSize:i,labelColor:s.labelColor.value(),inverted:e.isInverted(),labelsPadding:.4*i}),t.append(this._labelsRenderer))}
return this._model.selection().isSelected(this._source)&&this._isMarkersEnabled&&this._selectionData&&t.append(new d.SelectionRenderer(this._selectionData)),t}topPixelMargin(){return this._margin()}bottomPixelMargin(){return this._margin()}_createItem(e,t,i,s){const r={center:NaN,left:NaN,right:NaN,open:NaN,high:NaN,low:NaN,close:NaN,color:i.barColor,borderColor:i.barBorderColor,hollow:!1,highLabel:"",lowLabel:"",timePointIndex:e};if(!(0,y.baseBarCandlesUpdater)(t,r))return null;if(r.open=r.high,r.close=r.low,s.generateLabels){const e=s.formatter.format(r.high),t=s.formatter.format(r.low);r.highLabel=e,r.lowLabel=t;const i=(e.length>t.length?e:t).replace(/\d/g,"0");i.length>this._maxLengthLabel.length&&(this._maxLengthLabel=i)}return r}_margin(){if(this._needLabels()){const e=this._calculateLabelFontSize();if(e&&e>=8)return 1.4*e}return 0}_calculateLabelFontSize(){return""===this._maxLengthLabel?null:this._calculateFontSize(this._maxLengthLabel,Math.floor(this._model.timeScale().barSpacing())-2)}_needLabels(){const e=this._source.properties().childs().hiloStyle.childs().showLabels.value(),t=this._model.timeScale().barSpacing();return e&&t>5}}},579950:(e,t,i)=>{"use strict";i.d(t,{SeriesHLCAreaPaneView:()=>v});var s=i(86441),r=i(650151),o=i(244842),l=i(57372),n=i(63316),a=i(230058),u=i(534741),h=i(9640),d=i(142119),c=i(315801),_=i(879617),p=i(632739);class y extends p.ObjectValuesCache{_newObject(){return{high:void 0,close:void 0,low:void 0}}_clearObject(e){e.high=void 0,e.close=void 0,e.low=void 0}}class v{constructor(e,t){this._isMarkersEnabled=(0,o.enabled)("source_selection_markers"),this._hlcAreaCache=new y,this._highPoints=new p.CachedContainer,this._closePoints=new p.CachedContainer,this._lowPoints=new p.CachedContainer,this._barsBorders=new p.CachedContainer,this._filledAreas=new l.CachedMap,this._renderer=new d.CompositeRenderer,this._invalidated=!0,this._source=e,this._model=t,this._selectionIndexer=new n.SelectionIndexes(t.timeScale())}update(){this._invalidated=!0}renderer(){return this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._renderer}_updateImpl(){var e,t,i,o,n,d,p,y,v;this._renderer.clear();const m=this._model.timeScale(),S=this._source.priceScale();if(m.isEmpty()||!S||S.isEmpty())return;const b=m.visibleBarsStrictRange();if(null===b)return;if(0===this._source.bars().size())return;const g=this._source.firstValue();if(null===g)return;const f=null!==(e=this._source.nearestIndex(b.firstBar()-1,u.PlotRowSearchMode.NearestLeft))&&void 0!==e?e:b.firstBar()-1,C=null!==(t=this._source.nearestIndex(b.lastBar()+1,u.PlotRowSearchMode.NearestRight))&&void 0!==t?t:b.lastBar()+1;this._hlcAreaCache.invalidateCache(),this._hlcAreaCache.setStartIndex(f),this._barsBorders.invalidateCache(),this._highPoints.invalidateCache(),this._lowPoints.invalidateCache(),this._closePoints.invalidateCache(),this._filledAreas.invalidateCache();let w,x,P;this._source.bars().range(f,C).each(((e,t)=>{if(this._hlcAreaCache.isValidIndex(e)){const i=this._hlcAreaCache.at(e);i.close=t[4],i.high=t[2],i.low=t[3]}return!1}))
;const I=new Map,T=f+this._hlcAreaCache.length();for(let e=f;e<T;e++){const t=this._hlcAreaCache.at(e),s=null!==(i=t.close)&&void 0!==i?i:null,r=null!==(o=t.high)&&void 0!==o?o:null,l=null!==(n=t.low)&&void 0!==n?n:null;(null!==s||null!==r||null!==l||Number.isFinite(w)||Number.isFinite(x)||Number.isFinite(P))&&(w=s,x=r,P=l,this._highPoints.push(r),this._closePoints.push(s),this._lowPoints.push(l),this._barsBorders.push({timePointIndex:e,left:NaN,center:NaN,right:NaN}),I.set(e,this._barsBorders.length()-1))}S.pricesArrayToCoordinates(this._highPoints.data(),g,this._highPoints.length()),S.pricesArrayToCoordinates(this._closePoints.data(),g,this._closePoints.length()),S.pricesArrayToCoordinates(this._lowPoints.data(),g,this._lowPoints.length()),m.fillBarBorders(this._barsBorders.data(),{startItemIndex:0,endItemIndex:this._barsBorders.length()});const D=this._source.properties().childs().hlcAreaStyle.childs(),R=D.highCloseFillColor.value(),L=D.closeLowFillColor.value(),k=null!==(d=this._filledAreas.get(R))&&void 0!==d?d:new l.AreaBackgroundItemsGroup({type:0,color:R}),V=null!==(p=k.newItem())&&void 0!==p?p:new l.AreaBackgroundItem;k.push(V),this._filledAreas.set(R,k);const M=null!==(y=this._filledAreas.get(L))&&void 0!==y?y:new l.AreaBackgroundItemsGroup({type:0,color:L}),A=null!==(v=M.newItem())&&void 0!==v?v:new l.AreaBackgroundItem;M.push(A),this._filledAreas.set(L,M);const B=[],N=[],E=[],F=this._barsBorders.length();for(let e=0;e<F;e++){const t=this._closePoints.at(e),i=this._highPoints.at(e),s=this._lowPoints.at(e),r=this._barsBorders.at(e),o=r.center,l=(0,h.coordinateIsValid)(t),n=(0,h.coordinateIsValid)(i),a=(0,h.coordinateIsValid)(s);l&&n&&a&&(V.addPoints1Point(o,i),V.addPoints2Point(o,t),A.addPoints1Point(o,t),A.addPoints2Point(o,s),B.push({y:i,...r}),N.push({y:t,...r}),E.push({y:s,...r}))}const H=m.barSpacing();if(this._renderer.append(new l.AreaBackgroundRenderer({barSpacing:H,colorAreas:this._filledAreas})),this._renderer.append(new _.PaneRendererLine({barSpacing:H,items:E,simpleMode:!0,withMarkers:!1,lineColor:D.lowLineColor.value(),lineStyle:D.lowLineStyle.value(),lineWidth:D.lowLineWidth.value(),skipHoles:!0})),this._renderer.append(new _.PaneRendererLine({barSpacing:H,items:B,simpleMode:!0,withMarkers:!1,lineColor:D.highLineColor.value(),lineStyle:D.highLineStyle.value(),lineWidth:D.highLineWidth.value(),skipHoles:!0})),this._renderer.append(new _.PaneRendererLine({barSpacing:H,items:N,simpleMode:!0,withMarkers:!1,lineColor:D.closeLineColor.value(),lineStyle:D.closeLineStyle.value(),lineWidth:D.closeLineWidth.value(),skipHoles:!0})),this._model.selection().isSelected(this._source)&&this._isMarkersEnabled){const e=this._selectionIndexer.indexes(),t=[],i=[],o=(0,r.ensureNotNull)(this._model.paneForSource(this._source)).height();for(let r=0;r<e.length;r++){const l=e[r],n=I.get(l);if(void 0===n)continue;const a=this._closePoints.at(n),u=this._barsBorders.at(n).center;t.push(new s.Point(u,a)),i.push(this._model.backgroundColorAtYPercentFromTop(a/o))}this._renderer.append(new a.SelectionRenderer({bgColors:i,
points:t,visible:!0,barSpacing:m.barSpacing(),hittestResult:c.HitTarget.Regular}))}else this._selectionIndexer.clear()}}},41117:(e,t,i)=>{"use strict";i.d(t,{SeriesHollowCandlesPaneView:()=>a});var s=i(142119),r=i(9640),o=i(230058),l=i(956725),n=i(245242);class a extends n.SeriesCandlesPaneView{renderer(){this._invalidated&&(this._updateImpl(null),this._invalidated=!1);const e=this._source.priceScale();if(!e)return null;const t=this._source.properties().childs().hollowCandleStyle.childs(),i=this._model.timeScale().barSpacing(),n={bars:this._bars,barSpacing:i,bodyVisible:t.drawBody.value(),borderVisible:t.drawBorder.value(),borderColor:t.borderColor.value(),wickColor:t.wickColor.value(),barWidth:(0,r.optimalBarWidth)(i),wickVisible:t.drawWick.value(),isPriceScaleInverted:e.isInverted()},a=new s.CompositeRenderer;return a.append(new l.PaneRendererCandles(n)),this._model.selection().isSelected(this._source)&&this._isMarkersEnabled&&this._selectionData&&a.append(new o.SelectionRenderer(this._selectionData)),a}}},936258:(e,t,i)=>{"use strict";i.d(t,{SeriesLinePaneView:()=>u});var s=i(315801),r=i(142119),o=i(879617),l=i(627172),n=i(230058),a=i(143389);class u extends a.SeriesSingleLinePaneView{renderer(){this._invalidated&&(this._updateImpl(),this._invalidated=!1);const e=this._source.properties().childs(),t=e.style.value();let i,a=!1;2===t?i=e.lineStyle.childs():14===t?(i=e.lineWithMarkersStyle.childs(),a=!0):15===t?i=e.steplineStyle.childs():18===t&&(i=e.tpoStyle.childs());const u={barSpacing:this._model.timeScale().barSpacing(),items:this._items,lineColor:i.color.value(),lineStyle:i.linestyle.value(),withMarkers:a,lineWidth:i.linewidth.value(),simpleMode:!0,hitTestResult:s.HitTarget.Regular,skipHoles:!0};let h,d;if(h=15===t?new l.PaneRendererStepLine(u):new o.PaneRendererLine(u),this._model.selection().isSelected(this._source)&&this._isMarkersEnabled&&this._selectionData){const e=new r.CompositeRenderer;e.append(h),e.append(new n.SelectionRenderer(this._selectionData)),d=e}else d=h;return d}}},891512:(e,t,i)=>{"use strict";i.d(t,{SeriesBarCandlesPaneView:()=>h,baseBarCandlesUpdater:()=>u});var s=i(86441),r=i(244842),o=i(63316),l=i(534741),n=i(315801);function a(e){return null!=e}function u(e,t){const i=e[1],s=e[2],r=e[3],o=e[4];return!!(a(i)&&a(s)&&a(r)&&a(o))&&(t.open=i,t.high=s,t.low=r,t.close=o,!0)}class h{constructor(e,t){this._bars=[],this._invalidated=!0,this._isMarkersEnabled=(0,r.enabled)("source_selection_markers"),this._selectionData=null,this._source=e,this._model=t,this._selectionIndexer=new o.SelectionIndexes(t.timeScale())}items(){return this._bars}update(){this._invalidated=!0}_updateImpl(e){const t=this._model.timeScale(),i=this._source.priceScale();if(this._bars=[],t.isEmpty()||!i||i.isEmpty())return;const r=t.visibleBarsStrictRange();if(null===r)return;if(0===this._source.bars().size())return;let o=this._source.nearestIndex(r.firstBar(),l.PlotRowSearchMode.NearestRight);const a=this._source.nearestIndex(r.lastBar(),l.PlotRowSearchMode.NearestLeft);if(void 0===o||void 0===a)return;for(;o<=a;o++){
if(null!==this._source.bars().valueAt(o))break}if(o>a)return;const u=this._source.bars().range(o,a),h=this._source.barColorer(),d={};if(u.each(((t,i)=>{d.value=i;let s=this._source.precomputedBarStyle(i);void 0===s&&(s=h.barStyle(t,!1,d),this._source.setPrecomputedBarStyle(i,s));const r=this._createItem(t,i,s,e);return!!r&&(d.previousValue=i,this._bars.push(r),!1)})),0===this._bars.length)return;const c=this._source.firstValue();if(null!==c)if(i.barPricesToCoordinates(this._bars,c),t.fillBarBorders(this._bars),this._model.selection().isSelected(this._source)){const e=this._selectionIndexer.indexes();this._selectionData={points:[],bgColors:[],visible:!0,hittestResult:n.HitTarget.Regular,barSpacing:t.barSpacing()};const r=this._model.paneForSource(this._source);if(!r)return;const o=r.height();for(let r=0;r<e.length;r++){const l=e[r],n=this._source.bars().valueAt(l);if(null===n)continue;const a=n[1],u=n[4];if(null==a||null==u)continue;const h=.5*(a+u),d=t.indexToCoordinate(l),_=i.priceToCoordinate(h,c);this._selectionData.points.push(new s.Point(d,_)),this._selectionData.bgColors.push(this._model.backgroundColorAtYPercentFromTop(_/o))}}else this._selectionIndexer.clear()}}},143389:(e,t,i)=>{"use strict";i.d(t,{SeriesSingleLinePaneView:()=>d});var s=i(203308),r=i(86441),o=i(650151),l=i(244842),n=i(63316),a=i(534741),u=i(315801),h=i(674981);class d{constructor(e,t){this._items=[],this._invalidated=!0,this._isMarkersEnabled=(0,l.enabled)("source_selection_markers"),this._selectionData=null,this._source=e,this._model=t,this._selectionIndexer=new n.SelectionIndexes(t.timeScale())}update(){this._invalidated=!0}_updateImpl(){var e,t;this._items=[];const i=this._model.timeScale(),l=this._source.priceScale();if(i.isEmpty()||!l||l.isEmpty())return;const n=i.visibleBarsStrictRange();if(null===n)return;if(0===this._source.bars().size())return;const d=null!==(e=this._source.nearestIndex(n.firstBar()-1,a.PlotRowSearchMode.NearestLeft))&&void 0!==e?e:n.firstBar()-1,c=null!==(t=this._source.nearestIndex(n.lastBar()+1,a.PlotRowSearchMode.NearestRight))&&void 0!==t?t:n.lastBar()+1,_=this._source.barFunction();let p=null;const y=this._model.timeScale().barSpacing();if(y<.1&&this._source.supportsPressedChunks()){p=this._source.firstValue();const e=this._source.pressedChunks(y,(0,o.ensureNotNull)(this._source.priceSource())),t=(0,h.lowerbound)(e,d,((e,t)=>e.startTime<t)),i=Math.min(e.length-1,(0,h.lowerbound)(e,c,((e,t)=>e.endTime<t)));for(let s=t;s<=i;s++){const t=e[s];[t.open,t.high,t.low,t.close].forEach((e=>{this._items.push({timePointIndex:t.startTime,y:e,left:NaN,center:NaN,right:NaN})}))}}else{p=this._source.bars().range(d,c).reduce(((e,t,i)=>{const r=_(i);return(0,s.default)(r)?(this._items.push({timePointIndex:t,y:r,left:NaN,center:NaN,right:NaN}),n.contains(t)?null!=e?e:r:e):e}),null)}if(null!==p)if(l.pointsArrayToCoordinates(this._items,p),i.fillBarBorders(this._items),this._model.selection().isSelected(this._source)){const e=this._selectionIndexer.indexes();this._selectionData={points:[],bgColors:[],visible:!0,
barSpacing:i.barSpacing(),hittestResult:u.HitTarget.Regular};const t=(0,o.ensureNotNull)(this._model.paneForSource(this._source)).height();this._selectionData.hittestResult=u.HitTarget.Regular;for(let s=0;s<e.length;s++){const o=e[s],n=this._source.bars().valueAt(o);if(null===n)continue;const a=_(n),u=i.indexToCoordinate(o),h=l.priceToCoordinate(a,p);this._selectionData.points.push(new r.Point(u,h)),this._selectionData.bgColors.push(this._model.backgroundColorAtYPercentFromTop(h/t))}}else this._selectionIndexer.clear();else this._items=[]}}},748844:(e,t,i)=>{"use strict";i.d(t,{SeriesValuesProvider:()=>T,calculateColor:()=>P,changesData:()=>I});var s=i(650151),r=i(150335),o=i(724377),l=i(444372),n=i(638456),a=i(246733),u=i(31341),h=i(534741),d=i(885482),c=i(541346),_=i(943994),p=i(711757);function y(e,t){return 100*(t-e)/Math.abs(e||1)}var v=i(570226),m=i(616117),S=i(60897),b=i(334652);const g=b.lastDayChangeAvailable||b.alwaysShowLastPriceAndLastDayChange,f=n.CheckMobile.any(),C=new c.PercentageFormatter,w=new _.VolumeFormatter(2),x=`${S.notAvailable} (${S.notAvailable}%)`;function P(e,t){const i=(0,o.parseRgb)(t),s=(0,o.parseRgb)(e);return(0,o.distanceRgb)(i,s)<70?(0,o.rgbToHexString)((0,o.invertRgb)(i)):t}function I(e,t,i,s,r){var o;let l,n;if(null!==t){const e=r[4],i=t.change||0;n={change:i,currentPrice:e,prevPrice:e-i,percentChange:t.change_percent||0}}const a=i[4],u=e.search(s-1,h.PlotRowSearchMode.NearestLeft,1),d=null!==(o=null==u?void 0:u.value[4])&&void 0!==o?o:null;return null!==d&&null!=a&&(l={change:a-d,currentPrice:a,prevPrice:d,percentChange:y(d,a)}),{barChange:l,lastDayChange:n}}class T{constructor(e,t){this._series=e,this._model=t,this._emptyValues=[{title:l.t(null,void 0,i(539280)),visible:!1,value:"",index:0,id:""},{title:l.t(null,void 0,i(330777)),visible:!1,value:"",index:1,id:""},{title:l.t(null,void 0,i(608136)),visible:!1,value:"",index:2,id:""},{title:l.t(null,void 0,i(931691)),visible:!1,value:"",index:3,id:""},{title:"",visible:!1,value:"",index:4,id:""},{title:"",visible:!1,value:"",index:5,id:""},{title:l.t(null,void 0,i(349329)),visible:!1,value:"",index:6,id:""},{title:l.t(null,{context:"study"},i(32819)),visible:!1,value:"",index:7,id:""},{title:l.t(null,void 0,i(37611)),visible:!1,value:"",index:8,id:""}]}getItems(){return this._emptyValues}getValues(e){var t,i,o,l,n,d;const c=this._showLastPriceAndChangeOnly(),_=this._emptyValues.map(((e,t)=>({...e,value:6===t||8===t?x:S.notAvailable,visible:5!==t&&4!==t&&!c})));if(this._model.timeScale().isEmpty()||0===this._series.bars().size()||this._series.priceScale().isEmpty())return _;const p=(0,s.ensureNotNull)(this._series.data().bars().last());(0,r.isNumber)(e)||(e=p.index);const y=this._series.nearestIndex(e,h.PlotRowSearchMode.NearestLeft);if(void 0===y)return _;const m=this._series.data().valueAt(y),b=this._model.backgroundTopColor().value();if(null===m)return _;const f=m[1],T=m[2],D=m[3],R=m[4],{barChange:L,lastDayChange:k}=I(this._series.data(),this._series.quotes(),m,y,p.value),V=(0,v.getPriceValueFormatterForSource)(this._series)
;if((0,v.shouldBeFormattedAsPercent)(this._series)||(0,v.shouldBeFormattedAsIndexedTo100)(this._series))_[6].value="",_[8].value="";else{const e=this._series.formatter();if(void 0!==L){const{currentPrice:s,prevPrice:r,change:o,percentChange:l}=L,n=null!==(i=null===(t=e.formatChange)||void 0===t?void 0:t.call(e,s,r,!0))&&void 0!==i?i:e.format(o,!0);_[6].value=(0,u.forceLTRStr)(`${n} (${C.format(l,!0)})`)}if(void 0!==k){const{currentPrice:t,prevPrice:i,change:s,percentChange:r}=k,n=null!==(l=null===(o=e.formatChange)||void 0===o?void 0:o.call(e,t,i,!0))&&void 0!==l?l:e.format(s,!0);_[8].value=(0,u.forceLTRStr)(`${n} (${C.format(r,!0)})`)}}let M=null;if(c)_[5].value=null==R?S.notAvailable:V(R),_[5].visible=!0,M=this._getChangeColor(null==k?void 0:k.change),_[6].visible=void 0!==L,_[8].visible=void 0!==k||g;else{_[0].value=null==f?S.notAvailable:V(f),_[1].value=null==T?S.notAvailable:V(T),_[2].value=null==D?S.notAvailable:V(D),_[3].value=null==R?S.notAvailable:V(R),_[4].value=V(this._series.barFunction()(m));const e=m[5];(0,r.isNumber)(e)?_[7].value=w.format(e):_[7].visible=!1;const t=this._series.intervalObj().is1Tick();_[0].visible=!t,_[1].visible=!t,_[2].visible=!t,_[8].visible=void 0!==k||g,_[6].visible=void 0!==L;const i=this._series.barColorer().barStyle(y,!1);M=P(b,null!==(n=i.barBorderColor)&&void 0!==n?n:i.barColor)}M=(0,a.resetTransparency)(P(b,M));for(const e of _)e.color||(e.color=M);return _[8].visible&&(_[8].color=(0,a.resetTransparency)(P(b,this._getChangeColor(null===(d=k)||void 0===d?void 0:d.change)))),_}_mobileNonTrackingMode(){return f&&(null===this._model.crossHairSource().pane||(0,m.isLineToolName)(d.tool.value())||null!==this._model.lineBeingEdited())}_showLastPriceAndChangeOnly(){return b.alwaysShowLastPriceAndLastDayChange||this._mobileNonTrackingMode()}_getChangeColor(e){var t;const i=void 0===e||e>=0?p.SeriesBarColorer.upColor(this._series.properties()):p.SeriesBarColorer.downColor(this._series.properties());return null!==(t=i.barBorderColor)&&void 0!==t?t:i.barColor}}},736543:(e,t,i)=>{"use strict";i.d(t,{financialPeriodToShortString:()=>l,financialPeriodToString:()=>o});var s=i(650151),r=i(444372);function o(e){switch(e){case"FQ":return r.t(null,void 0,i(908831));case"FY":return r.t(null,void 0,i(34314));case"FH":return r.t(null,void 0,i(512421));case"TTM":return r.t(null,void 0,i(794236))}(0,s.ensureNever)(e)}function l(e){switch(e){case"FQ":return r.t(null,void 0,i(99374));case"FY":return r.t(null,void 0,i(776550));case"FH":return r.t(null,void 0,i(924468));case"TTM":return r.t(null,void 0,i(794236))}(0,s.ensureNever)(e)}},709081:(e,t,i)=>{"use strict";i.d(t,{Fundamental:()=>b});var s=i(444372),r=i(752928),o=i(736543),l=i(932167);class n extends l.StudyPriceAxisView{constructor(e,t){super(e,t),this._fundamental=e}_updatePaneRendererData(e){e.text="",this._showPaneLabel()&&(e.text=this._fundamental.labelTitle(),e.visible=!0)}}var a=i(506387);class u extends a.StudyPriceLineAxisView{constructor(e,t){super(e,t),this._model=e.model()}_isVisible(){
return this._model.properties().childs().scalesProperties.childs().showFundamentalLastValue.value()&&this._study.properties().childs().styles.childs()[this._plotname].childs().trackPrice.value()}}var h=i(509550),d=i(7288);const c=s.t(null,void 0,i(490411));class _ extends h.StudyStatusProvider{sourceStatusText(){const e=this._source.status();return e.type===d.StudyStatusType.Error&&(e.errorDescription.error.startsWith("resolve_error ")||e.errorDescription.error.startsWith("Symbol resolve error:"))?c:super.sourceStatusText()}}var p=i(368135),y=i(195447),v=i(534741),m=i(291784),S=i(982217);class b extends r.Study{constructor(e,t,i,s){super(e,t,i,s),this._linePlot=null;const r=s.plots.findIndex((e=>"line"===e.type));if(-1!==r){const e=s.plots[r],i=t.childs().styles.childs()[e.id];i.hasChild("plottype")&&(this._linePlot={plotIndex:r,plotType:i.childs().plottype})}}labelTitle(){return this.title(S.TitleDisplayTarget.StatusLine,!0)}hasStateForAlert(){return!1}titleInParts(e,t,i,s,r){return[this._title(e,!!t)]}statusProvider(e){return new _(this)}firstValue(){var e;const t=super.firstValue();if(null!==t||null===this._linePlot||this._linePlot.plotType.value()!==p.LineStudyPlotStyle.StepLine&&this._linePlot.plotType.value()!==p.LineStudyPlotStyle.StepLineWithDiamonds)return t;const i=this._model.timeScale().visibleBarsStrictRange();if(null===i)return null;if(!this.properties().childs().visible.value()||!this.isActualInterval())return this._ownFirstValue;const s=this.data().search(i.firstBar()-1,v.PlotRowSearchMode.NearestLeft,this._linePlot.plotIndex+1);return null===s?null:null!==(e=s.value[this._linePlot.plotIndex+1])&&void 0!==e?e:null}priceRange(e,t,i){let s=super.priceRange(e,t,i);if(null===s){const e=this.firstValue();null!==e&&(s=this._postProcessPriceRange(new m.PriceRange(e,e),i))}return s}_createPriceAxisView(e){return new n(this,{plotIndex:e})}_createPriceLineAxisView(e){return new u(this,e)}_title(e,t){const r=this.metaInfo();let l;if(l=t?r.shortDescription:r.description,void 0!==r.financialPeriod){const e=t?(0,o.financialPeriodToShortString)(r.financialPeriod):(0,o.financialPeriodToString)(r.financialPeriod);l=`${s.t(l,{context:"study"},i(168716))} Â· ${e}`}const n=this._titleInputs(e,!0),a=Object.keys(n);return a.length>0&&(l=`${s.t(n[a[0]],{context:"study"},i(168716))} Â· ${l}`),l}_titleInputsOptions(e,t,i){return{...super._titleInputsOptions(e,t,i),skipOptionalEmptySymbolInputs:!0,allowedInputTypes:["symbol"]}}_fillPrecalculatedAutoscaleInfo(e,t,i){const s=super._fillPrecalculatedAutoscaleInfo(e,t,i);if(null!==this._linePlot&&(this._linePlot.plotType.value()===p.LineStudyPlotStyle.StepLine||this._linePlot.plotType.value()===p.LineStudyPlotStyle.StepLineWithDiamonds)){const t=this.data().search(e,v.PlotRowSearchMode.NearestLeft);if(null!==t){const e=t.value[this._linePlot.plotIndex+1];s.baseValueMinMax=(0,y.mergeMinMax)(s.baseValueMinMax,{min:e,max:e})}}return s}}},580683:(e,t,i)=>{"use strict";function s(e,t,i){let s=e[`${t}#${i}`]||null;return null===s&&(s=e[t]||null),null===s&&Object.keys(e).forEach((i=>{
null===s&&i.startsWith(`${t}#`)&&(s=e[i]||null)})),s}i.d(t,{getObsoleteIdeaSymbolInfo:()=>s})},772466:(e,t,i)=>{"use strict";i.d(t,{NonSeriesStudy:()=>l,isNonSeriesStudy:()=>o});var s=i(650151),r=i(752928);function o(e){return e instanceof l}class l extends r.Study{clearData(){this._customData=null,this._indexes=null}restoreData(e,t,i){super.restoreData(e),this._customData=t,this._indexes=i}state(e){const t=super.state(e);return e&&(t.nonSeriesData=this._customData,t.indexes=this._indexes),t}customData(){return this._customData}_setPaneViews(e){this._paneViews=e,this.model().lightUpdate()}_onDataUpdated(e,t,i){null!==t&&(t.indexes_replace?((0,s.assert)("nochange"!==i),this._indexes=i):(this._customData=t.data,"nochange"!==i&&(this._indexes=i))),super._onDataUpdated(e,t,i)}}},343224:(e,t,i)=>{"use strict";i.r(t),i.d(t,{createStudy:()=>Gi,hasConfirmInputs:()=>ji,isESDStudy:()=>zi,isFundamentalStudy:()=>qi,isRollDatesStudy:()=>Ui,isStudy:()=>Hi,isStudyStrategy:()=>Oi,isStudyStub:()=>Wi,isSymbolicStudy:()=>Zi,studyColorRotationMode:()=>Yi,useSameColorRotationComparator:()=>Qi});var s=i(244842),r=i(526075),o=i(752928),l=i(650151),n=i(401580),a=i(790188),u=i(86441),h=i(724377),d=i(315801),c=i(510147),_=i(199471),p=i(678515);function y(e,t,i){return i?Math.sign(e)*(Math.round(Math.abs(e))+t):Math.round(e)+t}class v{constructor(e,t){this._data=e,this._textWidths=t}draw(e,t){const{horizontalPixelRatio:i,verticalPixelRatio:s}=t;void 0!==this._textWidths.renderingInfo&&(0,c.equalRenderingInfos)(this._textWidths.renderingInfo,t)||(this._textWidths.renderingInfo=t,this._textWidths.width.clear());const r=this._data;e.lineJoin="miter",e.miterLimit=Math.round(2*i),e.strokeStyle=r.bgColor,e.lineWidth=Math.max(2,(0,p.ceiledEven)(2*i));for(const i of r.items){e.beginPath();const o="lower"===i.pos;e.save();const l=Math.round(r.orderArrow.vMargin*s);e.translate(0,o?l:-l),this._drawOrderArrow(e,i.orderPoint,r.orderArrow,r.exitLineWidth,o,t),e.restore(),e.save(),this._drawPriceArrow(e,i.pricePoint,r.priceArrow,!o,t),e.restore(),e.closePath(),e.stroke(),e.fillStyle=r.exitLineWidth?r.exitColor:"buy"===i.type?r.buyColor:r.sellColor,e.fill()}const o=r.text;o.visible&&(0,_.drawScaled)(e,i,s,(()=>{e.font=o.fontSize+"px "+o.font,e.textAlign="center",e.textBaseline="top",e.fillStyle=r.labelColor,e.strokeStyle=r.bgColor,e.lineWidth=Math.min(2,Math.floor(2*i));for(const t of r.items){const i="lower"===t.pos;e.save();const s=i?1:-1,l=r.orderArrow;e.translate(0,(l.height+l.vMargin+r.exitLineWidth)*s);const n=i?o.vMargin:-o.fontSize-o.vMargin,a=s*(o.fontSize+o.lineSpacing);if(t.label&&(e.translate(0,n),e.strokeText(t.label,Math.ceil(t.orderPoint.x),t.orderPoint.y),e.fillText(t.label,Math.ceil(t.orderPoint.x),t.orderPoint.y),this._textWidths.width.has(t.label)||this._textWidths.width.set(t.label,e.measureText(t.label).width)),t.qty){const i=Boolean(t.label)?a:n;e.translate(0,i),e.strokeText(t.qty,Math.ceil(t.orderPoint.x),t.orderPoint.y),e.fillText(t.qty,Math.ceil(t.orderPoint.x),t.orderPoint.y),
this._textWidths.width.has(t.qty)||this._textWidths.width.set(t.qty,e.measureText(t.qty).width)}e.restore()}}))}hitTest(e){const t=this._testOrderArrows(e),i=!t&&this._data.text&&this._testText(e);return t||i?new d.HitTestResult(d.HitTarget.Regular):null}_drawOrderArrow(e,t,i,s,r,o){let l,n;r?(e.rotate(Math.PI),l=-t.x,n=-t.y):(l=t.x,n=t.y),n-=i.height+s;const{horizontalPixelRatio:a,verticalPixelRatio:u}=o,h=Math.max(1,Math.floor(a)),d=h%2?.5:0,c=r?"floor":"ceil";l=y(l*a,d,r),n=Math.round((Math[c](n)+.5)*u),e.translate(l,n);const _=(0,p.ceiledEven)(i.width*a)/2+d,v=(0,p.ceiledEven)(i.tailWidth*a)/2+d,m=Math.round(i.tailHeight*u);if(e.moveTo(-v,0),e.lineTo(v,0),e.lineTo(v,m),e.lineTo(_,m),e.lineTo(0,Math.round(i.height*u)),s){const t=Math.floor(h/2);e.lineTo(_+t,Math.round(i.height*u)),e.lineTo(_+t,Math.round((i.height+s)*u)),e.lineTo(-_-t,Math.round((i.height+s)*u)),e.lineTo(-_-t,Math.round(i.height*u)),e.lineTo(0,Math.round(i.height*u))}e.lineTo(-_,m),e.lineTo(-v,m),e.lineTo(-v,0),e.lineTo(v,0)}_drawPriceArrow(e,t,i,s,r){let o,l;s?(e.rotate(Math.PI),o=-t.x,l=-t.y):(o=t.x,l=t.y);const{horizontalPixelRatio:n,verticalPixelRatio:a}=r,u=Math.max(1,Math.floor(n)),h=u%2?.5:0;o=y(o*n,h,s)-u,l=y(l*a,h,s);const d=(0,p.ceiledEven)(2*i.width*a)/2,c=-(Math.round(i.width*n)+h);e.translate(o,l),e.moveTo(0,0),e.lineTo(c,-d),e.lineTo(c,d),e.lineTo(0,0),e.lineTo(c,-d)}_testOrderArrows(e){const t=this._data,i=t.orderArrow.width/2;for(const s of t.items){const r=s.orderPoint;if(e.x<r.x-i||e.x>r.x+i)continue;const o="lower"===s.pos;let l=t.orderArrow.height+t.exitLineWidth;o||(l=-l);const n=r.y+(o?t.orderArrow.vMargin:-t.orderArrow.vMargin),a=Math.min(n,n+l),u=Math.max(n,n+l);if(!(e.y<a||e.y>u))return!0}return!1}_testText(e){const t=this._data,i=t.text;if(!i.visible)return!1;for(const s of t.items){const r=s.orderPoint,o="lower"===s.pos;let l=t.orderArrow.vMargin+t.orderArrow.height+t.exitLineWidth;o||(l=-l);const n=r.y+l,a=(s.label?1:0)+(s.qty?1:0);let u=i.vMargin+i.fontSize*a+i.lineSpacing*Math.max(0,a-1);o||(u=-u);const h=Math.min(n,n+u),d=Math.max(n,n+u);if(e.y<h||e.y>d)continue;const c=s.label&&s.qty?o&&e.y<n+i.fontSize||!o&&e.y>n-i.fontSize?s.label:s.qty:s.label||s.qty,_=this._textWidths.width.get(c);if(!(void 0===_||e.x<r.x-_/2||e.x>r.x+_/2))return!0}return!1}}var m=i(422333),S=i(534741),b=i(142119);const g={BuyColor:(0,a.getHexColorByName)("color-tv-blue-500"),SellColor:"#FF1744",ExitColor:"#D500F9",LabelDarkColor:"#B2B5BE",LabelLightColor:(0,a.getHexColorByName)("color-cold-gray-900")};function f(e){return!1===e.e?"exit":e.b?"entryBuy":"entrySell"}function C(e){return e.b?"buy":"sell"}function w(e,t){return t?!e.b:e.b}function x(e,t){return w(e,t)?"lower":"upper"}function P(e,t,i){let s=e[t].get(i);return void 0===s&&(s=0,e[t].set(i,s)),s}function I(e,t,i,s){const r=(0,l.ensureDefined)(e[t].get(i));e[t].set(i,r+s)}function T(e,t){return t&&(e.c||e.id||"Untitled")||""}function D(e,t){return t&&(e.b?"+":"-")+e.q||""}function R(e,t,i){return(0,l.ensureNotNull)(e.b?i.valueAt(t,3):i.valueAt(t,2))}function L(e,t){
return("exit"===f(e)?2:0)+t.vMargin+t.height}class k{constructor(e,t,i){this._invalidated=!0,this._textWidths={width:new Map},this._study=e,this._series=t,this._model=i,this._orderArrow={vMargin:11,width:10,height:15,tailWidth:2,tailHeight:10},this._priceArrow={width:5},this._text={vMargin:7,font:m.CHART_FONT_FAMILY,fontSize:12,lineSpacing:2,visible:!0},this._items={entryBuy:[],entrySell:[],exit:[]},this._study.properties().childs().strategy.childs().orders.subscribe(this,this.update)}update(){this._invalidated=!0}clearItems(){this._items.entryBuy=[],this._items.entrySell=[],this._items.exit=[]}renderer(){const e=this._study.properties().childs();if(!e.visible.value()||!e.strategy.childs().orders.childs().visible.value())return null;if(this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._items.entryBuy.length||this._items.entrySell.length||this._items.exit.length){const e=new b.CompositeRenderer;return this._items.entryBuy.length&&e.append(this._strategyOrdersRenderer(this._items.entryBuy,!1)),this._items.entrySell.length&&e.append(this._strategyOrdersRenderer(this._items.entrySell,!1)),this._items.exit.length&&e.append(this._strategyOrdersRenderer(this._items.exit,!0)),e}return null}_strategyOrdersRenderer(e,t){const i=this._model.backgroundColor().value(),s="black"===(0,h.rgbToBlackWhiteString)((0,h.parseRgb)(i),150);return new v({items:e,buyColor:g.BuyColor,sellColor:g.SellColor,exitColor:g.ExitColor,labelColor:s?g.LabelDarkColor:g.LabelLightColor,bgColor:i,orderArrow:this._orderArrow,exitLineWidth:t?2:0,priceArrow:this._priceArrow,text:this._text},this._textWidths)}_updateImpl(){this.clearItems();const e=this._study.ordersData();if(!e||!e.length)return;const t=this._model.timeScale(),i=this._series.priceScale(),s=t.visibleBarsStrictRange();if(t.isEmpty()||i.isEmpty()||null===s)return;const r=this._study.barsIndexes(),o=this._series.nearestIndex(s.firstBar(),S.PlotRowSearchMode.NearestRight),n=this._series.nearestIndex(s.lastBar(),S.PlotRowSearchMode.NearestLeft);if(void 0===o||void 0===n)return;const[a,h]=function(e,t,i,s){const r=[],o=[];for(let l=0;l<e.length;++l){const n=s[l];n<t||n>i||(r.push(e[l]),o.push(n))}return[r,o]}(e,o,n,r),[d,c]=this._labelAndQtyVisibility(a.length),_=d||c,p=this._textHeight(d,c),y=(0,l.ensureNotNull)(this._series.firstValue()),v=i.isInverted(),m={upper:new Map,lower:new Map};for(let e=0;e<a.length;e++){const s=a[e],r=w(s,v),o=h[e],l=t.indexToCoordinate(o),n=R(s,o,this._series);let _=i.priceToCoordinate(n,y);const S=x(s,v),b=P(m,S,o);_+=r?b:-b;I(m,S,o,L(s,this._orderArrow)+p);const g=i.priceToCoordinate(s.p,y),k=f(s);this._items[k].push({orderPoint:new u.Point(l,_),pricePoint:new u.Point(l,g),label:T(s,d),qty:D(s,c),pos:S,type:C(s)})}this._text.visible=_}_labelAndQtyVisibility(e){const t=this._model.timeScale();if(t.barSpacing()<10&&this._orderArrow.width*e*2>t.width())return[!1,!1];const i=this._study.properties().childs().strategy.childs().orders.childs();return[i.showLabels.value(),i.showQty.value()]}_textHeight(e,t){
return e||t?e&&t?2*this._text.fontSize+this._text.vMargin+this._text.lineSpacing:this._text.fontSize+this._text.vMargin:0}}var V=i(811630);const M=["strategy_props"];class A extends o.Study{constructor(e,t,i,s,r){super(e,t,i,s),this.watchedData=new n.WatchedValue,this._barsIndexes=[],this._srcBarsIndexes=[],this._reportDataBuffer=null,this._reportData=null,this._activeState=!1,t.childs().visible.subscribe(this,(()=>{this._processChangeVisibility()})),this._processChangeVisibility(r)}destroy(){this._properties.childs().visible.unsubscribeAll(this),this.model().removeStrategySource(this,0),super.destroy()}properties(){return this._properties}hasStateForAlert(){return V.alertsAvailable&&this._series.alertCreationAvailable().value()}canHasAlertOnLineTools(){return!1}inputsForAlertState(){const e=this.inputs();return(0,l.ensureNotNull)(this._metaInfo).inputs.forEach((t=>{const i=e[t.id];i&&t.internalID&&(i.internalID=t.internalID)})),e}reportData(){return this._reportData}ordersData(){var e,t;return null!==(t=null===(e=this._reportData)||void 0===e?void 0:e.filledOrders)&&void 0!==t?t:null}barsIndexes(){return this._barsIndexes}clearData(){super.clearData(),this._reportDataBuffer=null,this._reportData=null,this._strategyOrdersPaneView&&this._strategyOrdersPaneView.clearItems()}strategyOrdersPaneView(){return this.isSourceHidden()?null:this._strategyOrdersPaneView}restoreData(e){super.restoreData(e);const t=e;this.model().addStrategySource(this,0),t.reportData&&t.barsIndexes&&(this._reportData=t.reportData,this._barsIndexes=t.barsIndexes,this.watchedData.setValue({method:"data_update",nonSeriesData:{indexes_replace:!1,data:{report:this._reportData}}})),t.activeState&&(this._activeState=!0)}activeState(){return this._activeState}updateAllViews(e){super.updateAllViews(e),this._strategyOrdersPaneView&&this._strategyOrdersPaneView.update()}state(e,t){const i=super.state(e,t);return e&&this._reportData&&this._barsIndexes&&(i.data||(i.data={}),i.data.reportData=this._reportData,i.data.barsIndexes=this._barsIndexes,i.data.activeState=this.model().activeStrategySource().value()===this),i}isHibernationAllowed(){return!1}_onData(e){e.method&&"data_update"!==e.method&&this.watchedData.setValue({method:e.method}),super._onData(e)}_onDataUpdated(e,t,i,s){var r,o,n;let a=t&&!t.indexes_replace&&t.data&&t.data.report;a?(t&&!t.indexes_replace&&t.isUpdate&&this._reportDataBuffer&&(a={...this._reportDataBuffer,...a}),this._reportData={...this._reportDataBuffer,...a},this._reportDataBuffer=this._reportData,this.watchedData.setValue({method:"data_update",nonSeriesData:(0,l.ensureNotNull)(t)})):this.watchedData.setValue({method:"data_update",nonSeriesData:{indexes_replace:!1,data:{report:this._reportDataBuffer}}});const u=!(!t||!t.indexes_replace);("nochange"!==i&&i.length>0||(null!==(n=null===(o=null===(r=this._reportData)||void 0===r?void 0:r.filledOrders)||void 0===o?void 0:o.length)&&void 0!==n?n:0)!==this._barsIndexes.length)&&(a||u)&&this._collateBarsIndexes(Array.isArray(i)?i:this._srcBarsIndexes),super._onDataUpdated(e,t,i,s)}
_createViews(){super._createViews(),this._strategyOrdersPaneView=new k(this,this._series,this._model)}_titleInputs(e,t,i){return this.inputs({symbolsForDisplay:!0,skipHiddenInputs:!0,skipFakeInputs:!1,fakeInputsForDisplay:!0,asObject:!0,skippedGroups:M,noExchanges:t,displayMask:e})}_getTelemetryObjectName(){return"strategy"}_collateBarsIndexes(e){var t;this._srcBarsIndexes=e;const i=null===(t=this._reportData)||void 0===t?void 0:t.filledOrders;if(i&&i.length){this._barsIndexes.length=0;for(let t=0;t<i.length;t++)this._barsIndexes[t]=e[i[t].tm]}}_processChangeVisibility(e){const t=!0===e?2:0;this.properties().childs().visible.value()?this.model().addStrategySource(this,t):this.model().removeStrategySource(this,t)}}var B=i(960769),N=i.n(B),E=i(444372),F=i(226663),H=i(31341),O=i(103221),W=i(389137),q=i(246733),z=i(511131),U=i(541346),G=i(943994),Y=i(458963),$=i(382778),Q=i(787123);const j={fillPath:new Path2D("M8.961.92a3 3 0 0 1 3.078 0l7.5 4.48A3 3 0 0 1 21 7.975V20a3 3 0 0 1-3 3H3a3 3 0 0 1-3-3V7.975A3 3 0 0 1 1.461 5.4l7.5-4.48z"),strokePath:new Path2D("M9.867 2.742c.39-.23.875-.23 1.266 0l7.5 4.406c.382.225.617.635.617 1.078V20c0 .69-.56 1.25-1.25 1.25H3c-.69 0-1.25-.56-1.25-1.25V8.226c0-.443.235-.853.617-1.078l7.5-4.406z")},X={fillPath:new Path2D("M8.961 23.08a3 3 0 0 0 3.078 0l7.5-4.48A3 3 0 0 0 21 16.025V4a3 3 0 0 0-3-3H3a3 3 0 0 0-3 3v12.025A3 3 0 0 0 1.461 18.6l7.5 4.48z"),strokePath:new Path2D("M9.866 21.257c.391.23.877.23 1.268 0l7.5-4.414a1.25 1.25 0 0 0 .616-1.078V4c0-.69-.56-1.25-1.25-1.25H3c-.69 0-1.25.56-1.25 1.25v11.765c0 .443.234.853.616 1.078l7.5 4.414z")},Z={fillPath:new Path2D("M3 0h15c1.662 0 3 1.338 3 3v15c0 1.662-1.338 3-3 3H3c-1.662 0-3-1.338-3-3V3c0-1.662 1.338-3 3-3z"),strokePath:new Path2D("M3 1.75h15c.693 0 1.25.557 1.25 1.25v15c0 .693-.557 1.25-1.25 1.25H3c-.692 0-1.25-.558-1.25-1.25V3c0-.692.558-1.25 1.25-1.25z")};function K(e,t,i,s,r){const{horizontalPixelRatio:o,verticalPixelRatio:l}=i;e.save(),e.translate(t.x-s.lollipop.width*o/2,t.y-s.lollipop.height*l/2),e.scale(o,l),s.lollipop.fillCircle&&s.lollipop.backgroundColor&&(e.fillStyle=s.lollipop.backgroundColor,e.fill(r.fillPath)),e.strokeStyle=s.lollipop.strokeStyle,e.lineWidth=Math.round(s.lollipop.lineWidth*o)/o,(0,Q.setLineStyle)(e,Y.LINESTYLE_SOLID),s.lollipop.fillCircle&&s.lollipop.fillStyle&&(e.fillStyle=s.lollipop.fillStyle,e.fill(r.strokePath)),e.stroke(r.strokePath),e.restore()}class J extends $.LollipopRenderer{_drawLollipop(e,t,i){const s=this._data.style;switch(s.type){case"Positive":!function(e,t,i,s){K(e,t,i,s,j)}(e,t,i,s);break;case"Negative":!function(e,t,i,s){K(e,t,i,s,X)}(e,t,i,s);break;default:!function(e,t,i,s){K(e,t,i,s,Z)}(e,t,i,s)}}}var ee=i(995874),te=i(224743),ie=i(988124),se=i(854798),re=i(700134),oe=i(232650),le=i(199687),ne=i(986837);class ae extends ne.LollipopPaneView{constructor(){super(...arguments),this._getMoreFinancialsLinkInitialTabId=le.PageId.Overview,this._symbolName=null}addLollipop(e,t,i,s,r,o,l){var n,a
;if(null===this._symbolName&&(this._symbolName=null!==(a=null===(n=this._model.mainSeries().symbolInfo())||void 0===n?void 0:n.name)&&void 0!==a?a:null,null===this._symbolName))return;const h=`${this._source.metaInfo().id}_${this._lollipopId(o)}_${this._symbolName}`,d=this._lollipops[h],c=void 0!==d?d.itemIndex:this._lollipopsCounter++,_=this._model.lastHittestData(),p=h===this.getLastClickedLollipopId(),y=this._model.hoveredSource()===this._source&&null!==_&&_.activeItem===c;this._lollipops[h]={id:h,itemIndex:c,visible:!0,basePoint:new u.Point(i.indexToCoordinate(r),e),hovered:y,active:p,stack:l,...this.extraData(o)}}renderer(e){return this._invalidated&&(this._updateImpl(e),this._invalidated=!1),this._source.hideLollipops()?null:this._renderer}_lollipopId(e){return e[0].toString()}_updateImpl(e){const t=this._source.data(),i=this._model.timeScale(),s=i.visibleBarsStrictRange(),r=this._model.mainSeries().bars(),o=this._model.mainSeries(),n=o.priceScale(),a=o.firstBar();if(n.isEmpty()||i.isEmpty()||!a||!t||null===s)return;const u=this._model.mainPane();if(!u)return;if(this._source.hideLollipops())return void this.clearLastClicked();for(const e in this._lollipops)this._lollipops.hasOwnProperty(e)&&((0,l.ensureDefined)(this._lollipops[e]).visible=!1);const h=this._getY(),d=s.firstBar(),c=s.lastBar(),_=this._source.zorder(),p=u.lollipopDataSources().filter((e=>e!==this._source&&e.zorder()>_&&e.isVisible()));t.range(d,c).each(((e,t)=>{let s=0;for(const t of p)s+=t.lollipopsAtIndex(e);return this.addLollipop(h,r,i,n,e,t,s),!1})),this.afterUpdate(h,r,i,n),this._createRenderers(e)}_formatDate(e,t){var i;let s,r=!0;if(r=se.Version.parse(this._source.metaInfo().version).isLessOrEqual(new se.Version(137,0)),r){let t="Etc/UTC";this._model.mainSeries().isDWM()||(t=null!==(i=this._model.timezoneExceptExchange().value())&&void 0!==i?i:"");const r=(0,ie.get_timezone)(t);s=(0,ie.utc_to_cal)(r,e)}else s=new Date(e);return(t?"â‰ˆ ":"")+this._model.dateFormatter().format(s)}_getMoreFinancialsLink(){var e;if(!/\betf\b/i.test((null===(e=this._model.mainSeries().symbolInfo())||void 0===e?void 0:e.description)||""))return{text:this._getMoreFinancialsLinkText(),onClick:()=>{te.globalCloseDelegate.fire(),s.enabled("mobile_app_action_open_financials_webview")?(0,oe.openFinancialsWebview)(new URLSearchParams):(0,re.showFinancialsDialog)({initialTabId:this._getMoreFinancialsLinkInitialTabId})}}}_getMoreFinancialsLinkText(){var e,t;return E.t(null,{replace:{symbol:null!==(t=null===(e=this._model.mainSeries().symbolInfo())||void 0===e?void 0:e.name)&&void 0!==t?t:""}},i(633282))}_onSymbolOrIntervalChanged(){super._onSymbolOrIntervalChanged(),this._symbolName=null}}var ue=i(385442),he=i(777566),de=i(261820),ce=i(274469),_e=i(788600),pe=i(85290),ye=i(315507)
;const ve=E.t(null,void 0,i(376434)),me=E.t(null,void 0,i(783851)),Se=E.t(null,void 0,i(802985)),be=E.t(null,void 0,i(396269)),ge=E.t(null,void 0,i(180160)),fe=E.t(null,void 0,i(68625)),Ce=E.t(null,void 0,i(94647)),we=E.t(null,void 0,i(634135)),xe=E.t(null,void 0,i(400241)),Pe=E.t(null,void 0,i(233481)),Ie=E.t(null,void 0,i(676912)),Te=E.t(null,void 0,i(651924)),De=E.t(null,void 0,i(744441)),Re=E.t(null,void 0,i(993225)),Le=E.t(null,void 0,i(259285)),ke=E.t(null,void 0,i(945855)),Ve=E.t(null,void 0,i(354079)),Me={dark:(0,a.getHexColorByName)("color-cold-gray-900"),light:(0,a.getHexColorByName)("color-white")},Ae={positive:(0,a.getHexColorByName)("color-minty-green-600"),negative:(0,a.getHexColorByName)("color-ripe-red-600"),future:(0,a.getHexColorByName)("color-grapes-purple-a400"),unknown:(0,a.getHexColorByName)("color-cold-gray-350")},Be={positive:(0,a.getHexColorByName)("color-minty-green-500"),negative:(0,a.getHexColorByName)("color-ripe-red-500"),future:(0,a.getHexColorByName)("color-grapes-purple-a200"),unknown:(0,a.getHexColorByName)("color-cold-gray-700")};function Ne(e){return e?Ae:Be}const Ee=new U.PercentageFormatter,Fe=new G.VolumeFormatter;class He extends ae{}class Oe extends He{constructor(e,t,i){super(e,t,i)}styles(e){return e?{positive:(0,a.getHexColorByName)("color-minty-green-600"),negative:(0,a.getHexColorByName)("color-ripe-red-600"),future:(0,a.getHexColorByName)("color-grapes-purple-a400"),unknown:(0,a.getHexColorByName)("color-cold-gray-350")}:{positive:(0,a.getHexColorByName)("color-minty-green-500"),negative:(0,a.getHexColorByName)("color-ripe-red-500"),future:(0,a.getHexColorByName)("color-grapes-purple-a200"),unknown:(0,a.getHexColorByName)("color-cold-gray-700")}}extraData(e){const t=e[8],i=14===t,s=e[1],r=e[2],o=e[3],l=e[4],n=i?null:e[5],a=null!=n&&null!=r?n-r:null,u=e[6],h=i?null:e[7];let d;return null!=t?t<20?d="Future":null!==a&&(d=a<0?"Negative":"Positive"):null!==a?d=a<0?"Negative":"Positive":l>Date.now()&&(d="Future"),{standardized:s,reported:n,estimate:r,revenueValue:h,revenueEstimate:u,period:o,date:l,type:d,timeType:null!=t?t:void 0}}afterUpdate(e,t,i,s){const r=this._source.getEstimate();if(r){const o=r.value.slice();o[4]*=1e3,this.addLollipop(e,t,i,s,r.index,o)}}getStyle(e){const t=this._getLollipopStatus(e);if(void 0===e.type)return super.getStyle(e,t);const i=t;let s=i;e.stack&&(s+="_stack:"+e.stack);let r=this._getStyleObject(e.type,s);if(null!==r)return r;if(this._stylesCache||(this._stylesCache={}),!this._stylesCache[s]){r=this._getStyleObject(e.type,i);const t=(0,W.clone)(r);t&&(e.stack&&(t.lollipop.incHeight=25*e.stack),this._stylesCache[s]=t)}return this._stylesCache[s]}_createTooltipContent(e){const t=e.standardized,i=null!=t,s=e.reported,r=null!=s,o=e.estimate,n=null!=o,a=r&&n?s-o:null;let u=e.revenueEstimate,h=!1;null!=u&&(h=!0,u*=1e6);let d=e.revenueValue,c=!1;null!=d&&(c=!0,d*=1e6);const _=c&&h?d-u:null,p=Ne(this._model.dark().value());let y,v,m,S,b;switch(e.type){case"Future":v=p.future,y=de;break;case"Negative":v=p.negative,y=he;break;case"Positive":
v=p.positive,y=ue;break;default:v=p.unknown,y=de}switch(e.timeType){case 12:case 22:m=ye,S=F.LollipopGroupIcons.AfterMarketClose,b=Ve;break;case 11:case 21:m=pe,S=F.LollipopGroupIcons.BeforeMarketOpen,b=ke}const g=10===e.timeType||14===e.timeType,f={name:Ie,value:this._formatDate(e.date,g)};m&&(f.valueRightIcon={iconContent:m,iconClass:S,tooltipText:b});const C=[f];e.period&&C.push({name:De,value:B.unix(e.period).format("MMM 'YY")});const w={type:"common",title:c||h?ve:me,subTitle:C,tooltipIcon:y,style:{color:v},content:[],anchor:this._getMoreFinancialsLink()},x={title:me,content:[]};if(i&&x.content.push({name:Se,value:(0,ee.roundToThirdDigit)(t)}),r&&x.content.push({name:be,value:(0,ee.roundToThirdDigit)(s)}),n&&x.content.push({name:ge,value:(0,ee.roundToThirdDigit)(o)}),null!==a){const e=100*Math.abs(a/o);let t=(0,ee.roundToThirdDigit)(a);isFinite(e)&&(t+=" ("+Ee.format(e)+")"),x.content.push({name:fe,value:(0,H.forceLTRStr)(t),style:{fontWeight:"bold",color:v}})}if((0,l.ensureDefined)(w.content).push(x),c||h){const e={title:Le,content:[]};if(c&&e.content.push({name:be,value:Fe.format(d)}),h&&e.content.push({name:ge,value:Fe.format(u)}),null!==_){const t=100*Math.abs(_/u);let i=Fe.format(_);isFinite(t)&&(i+=" ("+Ee.format(t)+")"),e.content.push({name:fe,value:(0,H.forceLTRStr)(i),style:{fontWeight:"bold",color:_>=0?p.positive:p.negative}})}(0,l.ensureDefined)(w.content).push(e)}return[w]}_showBarLine(e){return super._showBarLine(e)||this._model.mainSeries().properties().childs().esdShowBreaks.value()}_createRendererForLollipop(e,t){return new J(e,new d.HitTestResult(d.HitTarget.Custom,t),this._textWidthCache)}_recreateStyles(e){const t=e.dark().value(),i=Ne(t),s=i.unknown,r={barLine:{lineStyle:Y.LINESTYLE_DASHED,lineWidth:1,strokeStyle:s},lollipop:{width:21,height:21,bottom:2,lineWidth:1.5,importance:"earnings",strokeStyle:s,backgroundColor:t?Me.dark:Me.light,fillCircle:!0,text:{label:"E",strokeStyle:s,font:(0,z.makeFont)(12,m.CHART_FONT_FAMILY,"bold")}}},o={lollipop:{fillStyle:(0,q.generateColor)(s,85)}},l={lollipop:{fillStyle:s,text:{strokeStyle:(0,a.getHexColorByName)("color-cold-gray-50")}}};this._defaultStyle=(0,O.deepCopy)(r),this._hoveredStyle=(0,W.merge)((0,O.deepCopy)(r),o),this._activeStyle=(0,W.merge)((0,O.deepCopy)(r),l);const n=(e,t)=>{const i=(0,O.deepCopy)(r);return i.barLine.strokeStyle=e,i.lollipop.strokeStyle=e,i.lollipop.text.strokeStyle=e,i.type=t,o.lollipop.fillStyle=(0,q.generateColor)(e,85),l.lollipop.fillStyle=e,{default:i,hovered:(0,W.merge)((0,O.deepCopy)(i),o),active:(0,W.merge)((0,O.deepCopy)(i),l)}};l.lollipop.text.strokeStyle=(0,a.getHexColorByName)("color-grapes-purple-50");const u=n(i.future,"Future");r.lollipop.height=23,r.lollipop.text.deltaY=1,l.lollipop.text.strokeStyle=(0,a.getHexColorByName)("color-minty-green-50");const h=n(i.positive,"Positive");r.lollipop.bottom=.5,r.lollipop.text.deltaY=-.5,l.lollipop.text.strokeStyle=(0,a.getHexColorByName)("color-ripe-red-50");const d=n(i.negative,"Negative");this._earningTypeStyles={Future:u,Positive:h,Negative:d},this._stylesCache=null}
_getStyleObject(e,t){const i=this._earningTypeStyles[e];switch(t){case"default":return i.default;case"hovered":return i.hovered;case"active":return i.active}return null}}const We=(0,a.getHexColorByName)("color-tan-orange-600"),qe=(0,a.getHexColorByName)("color-tan-orange-500");function ze(e){return e?We:qe}class Ue extends He{extraData(e){const t=e[1];return{numerator:e[2],denominator:t,date:e[3]}}_createTooltipContent(e){let t=Ce;return(0,W.isNumber)(e.numerator)&&(0,W.isNumber)(e.denominator)&&(t+=": "+e.numerator+"/"+e.denominator),[{type:"common",title:t,subTitle:this._formatDate(e.date),tooltipIcon:ce,style:{color:ze(this._model.dark().value())},anchor:this._getMoreFinancialsLink()}]}_recreateStyles(e){const t=e.dark().value(),i=ze(t),s={barLine:{lineStyle:Y.LINESTYLE_DASHED,lineWidth:1,strokeStyle:i},lollipop:{width:23,height:23,bottom:1,lineWidth:1.5,importance:"splits",strokeStyle:i,backgroundColor:t?Me.dark:Me.light,fillCircle:!0,text:{label:"S",strokeStyle:i,font:(0,z.makeFont)(12,m.CHART_FONT_FAMILY,"bold")}}},r={lollipop:{fillStyle:(0,q.generateColor)(i,85)}},o={lollipop:{fillStyle:i,text:{strokeStyle:(0,a.getHexColorByName)("color-tan-orange-50")}}};this._defaultStyle=s,this._hoveredStyle=(0,W.merge)((0,O.deepCopy)(s),r),this._activeStyle=(0,W.merge)((0,O.deepCopy)(s),o),this._stylesCache=null}}const Ge=(0,a.getHexColorByName)("color-tv-blue-600"),Ye=(0,a.getHexColorByName)("color-tv-blue-500");function $e(e){return e?Ge:Ye}class Qe extends He{constructor(){super(...arguments),this._getMoreFinancialsLinkInitialTabId=le.PageId.Dividends}extraData(e){return{amountDividends:e[1],date:e[2],adjustedAmountDividends:e[3],paymentDate:e[4]}}_createTooltipContent(e){const{date:t,amountDividends:i,paymentDate:s,adjustedAmountDividends:r}=e,o=[{name:Te,value:this._formatDate(t)}];return(0,W.isNumber)(i)&&o.push({name:xe,value:(0,ee.roundToThirdDigit)(i)}),(0,W.isNumber)(r)&&o.push({name:Pe,value:(0,ee.roundToThirdDigit)(r)}),(0,W.isNumber)(s)&&o.push({name:Re,value:this._formatDate(s)}),[{type:"common",title:we,subTitle:o,tooltipIcon:_e,style:{color:$e(this._model.dark().value())},anchor:this._getMoreFinancialsLink()}]}_recreateStyles(e){const t=e.dark().value(),i=$e(t),s={barLine:{lineStyle:Y.LINESTYLE_DASHED,lineWidth:1,strokeStyle:i},lollipop:{width:23,height:23,bottom:1,lineWidth:1.5,importance:"dividends",strokeStyle:i,backgroundColor:t?Me.dark:Me.light,fillCircle:!0,text:{label:"D",strokeStyle:i,font:(0,z.makeFont)(12,m.CHART_FONT_FAMILY,"bold")}}},r={lollipop:{fillStyle:(0,q.generateColor)(i,85)}},o={lollipop:{fillStyle:i,text:{strokeStyle:(0,a.getHexColorByName)("color-tv-blue-50")}}};this._defaultStyle=s,this._hoveredStyle=(0,W.merge)((0,O.deepCopy)(s),r),this._activeStyle=(0,W.merge)((0,O.deepCopy)(s),o),this._stylesCache=null}_getMoreFinancialsLinkText(){var e,t;return E.t(null,{replace:{symbol:null!==(t=null===(e=this._model.mainSeries().symbolInfo())||void 0===e?void 0:e.name)&&void 0!==t?t:""}},i(177743))}}var je=i(888929),Xe=i(732149),Ze=i(782086),Ke=i(555502),Je=i(65455);class et extends o.Study{
constructor(e,t,i,s){super(e,t,i,s),this._restartRequired=!1,this.setOwnerSource(e.mainSeries());const r=this._externalVisibilityProperty();null!==r&&(this._destroyPropertyBinder=(0,Je.bindProperties)(r,this._properties.childs().visible))}destroy(){var e;this._paneView.destroy(),null===(e=this._destroyPropertyBinder)||void 0===e||e.call(this),super.destroy()}lollipopsAtIndex(e){return!this.hideLollipops()&&this.data().contains(e)?1:0}hideLollipops(){return this._model.timeScale().barSpacing()/23<2/3&&this._model.mainSeries().intervalObj().inMilliseconds()>=432e6}async start(){const e=super.start();return this._model.mainSeries().dataEvents().symbolResolved().subscribe(this,this._initPlotStash),this._initPlotStash(),e}stop(){super.stop(),this._model.mainSeries().dataEvents().symbolResolved().unsubscribe(this,this._initPlotStash)}restoreData(e){e.data=e.data.filter((e=>e.index!==Xe.INVALID_TIME_POINT_INDEX&&this.isValid(e.value))),this._transformData(e.data),e.end=e.data.length,super.restoreData(e)}onClickOutside(e,t){this._paneView.processClickOutside(e,t)}preferNoScale(){return!0}showInObjectTree(){return!1}isSavedInStudyTemplates(){return!1}isRemovedByStudyTemplates(){return!1}removeByRemoveAllStudies(){return!1}isDraggable(){return!1}copiable(){return!1}statusView(){return null}hasStateForAlert(){return!1}isSavedInChart(e){return Boolean(e)}isSpeciallyZOrderedSource(){return!0}isUserDeletable(){return!1}canHaveChildren(){return!1}isIncludedInAutoScale(){return!1}isCurrencySource(){return!1}isUnitSource(){return!1}_externalVisibilityProperty(){return null}_transformData(e){for(let t=e.length-1;t>=0;--t){const i=e[t],s=i.index!==Xe.INVALID_TIME_POINT_INDEX&&this.isValid(i.value);this._updatePlotStash(i,s)}}_createViews(){this._paneViews=[this._paneView],this._priceAxisViews=[],this._dataWindowView||(this._dataWindowView=new Ze.DataWindowView),this._legendView=null,this._statusView||(this._statusView=new Ke.StudyStatusView(this))}_seriesDataRangeToSave(e){return this._model.timeScale().visibleBarsStrictRange()}async _showTooltip(e,t,s){const r=this._model,o=this._model.timeScale(),n=[o.onScroll(),o.barSpacingChanged(),r.mainSeries().onSymbolIntervalChanged(),(0,l.ensureNotNull)(r.paneForSource(this)).onSizeChanged()],a=this._paneView.processClickOutside.bind(this._paneView,e),u=this._paneView.clearLastClicked.bind(this._paneView),h=s();if(null===h)return;const{showLollipopTooltip:d}=await Promise.all([i.e(1893),i.e(7436),i.e(38697),i.e(43630),i.e(11301),i.e(20442),i.e(10456),i.e(47416),i.e(39232),i.e(42670),i.e(19860),i.e(33193),i.e(99898),i.e(68941),i.e(88193),i.e(25045),i.e(75545),i.e(20739),i.e(90020),i.e(21557),i.e(68123),i.e(24964),i.e(64798),i.e(70799),i.e(90385),i.e(59255),i.e(79734),i.e(15773),i.e(93167),i.e(11541),i.e(25827),i.e(69226),i.e(48830),i.e(49039)]).then(i.bind(i,722832));d({items:h,position:t,customCloseSubscriptions:n,onClickOutside:a,onCustomClose:u,showScrollFades:!0})}_initPlotStash(){this._plotStash={}}_updatePlotStash(e,t){if(this._restartRequired||!this._plotStash)return
;const i=e.value.slice(),s=i.shift(),r=String(s);t?this._plotStash[r]?String(this._plotStash[r])!==String(i)&&(this._restartRequired=!0):this._plotStash[r]=i:this._plotStash[r]&&(this._restartRequired=!0)}}const tt=je.sortSourcesPreOrdered.Dividends,it=je.sortSourcesPreOrdered.Splits,st=je.sortSourcesPreOrdered.Earnings;class rt extends et{zorder(){return tt}isValid(e){const t=e[2];return(0,W.isNumber)(t)}state(e,t){const i=super.state(e,t);return i.data.version=2,i}restoreData(e){var t;(null!==(t=e.version)&&void 0!==t?t:1)<2&&e.data.forEach((e=>{e.value[3]=null})),super.restoreData(e)}_createViews(){this._paneView=new Qe(this._model,this,this._showTooltip.bind(this)),super._createViews()}_externalVisibilityProperty(){return this._model.mainSeries().properties().childs().esdShowDividends}}class ot extends et{zorder(){return it}isValid(e){const t=e[3];return(0,W.isNumber)(t)}_createViews(){this._paneView=new Ue(this._model,this,this._showTooltip.bind(this)),super._createViews()}_externalVisibilityProperty(){return this._model.mainSeries().properties().childs().esdShowSplits}}class lt extends et{constructor(){super(...arguments),this._estimatePlotRow=null}zorder(){return st}isValid(e){const t=e[3],i=e[4];return(0,W.isNumber)(t)&&(0,W.isNumber)(i)}restoreData(e){super.restoreData(e);let t=null;if(e.estimate)t=this._restorePointset(e.estimate);else if(e.pointSets&&null==e.pointSetsVersion){const i=this._getSymbol();if(null!==i){const s=i.split(":")[1].toUpperCase();e.pointSets[i]?t=this._restorePointset(e.pointSets[i]):e.pointSets[s]&&(t=this._restorePointset(e.pointSets[s]))}}else if(e.pointSets&&"1"===e.pointSetsVersion){const i=this._getSymbol();if(null!==i){const s=i.split(":")[1].toUpperCase();e.pointSets[i]?t=e.pointSets[i].estimate:e.pointSets[s]&&(t=e.pointSets[s].estimate)}}else null!=e.estimatePlotRow&&"2"===e.pointSetsVersion&&(t=e.estimatePlotRow);this._estimatePlotRow=t}getEstimate(){return this._estimatePlotRow}_createViews(){this._paneView=new Oe(this._model,this,this._showTooltip.bind(this)),super._createViews()}_externalVisibilityProperty(){return this._model.mainSeries().properties().childs().esdShowEarnings}_getSymbol(){var e,t;return null!==(t=null===(e=this._series.symbolInfo())||void 0===e?void 0:e.base_name[0].toLowerCase())&&void 0!==t?t:null}_restorePointset(e){return{index:e.index,value:[e.tickmark,void 0,e.estimate,(0,W.isNumber)(e.period)?e.period:N()(e.period).unix(),(0,W.isNumber)(e.date)?e.date:N()(e.date).unix()]}}}var nt=i(822914),at=i(682103),ut=i(528474);const ht=[E.t(null,void 0,i(926910)),E.t(null,void 0,i(316467)),E.t(null,void 0,i(322852)),E.t(null,void 0,i(997637)),E.t(null,void 0,i(668327)),E.t(null,void 0,i(49385)),E.t(null,void 0,i(323230)),E.t(null,void 0,i(486797)),E.t(null,void 0,i(661132)),E.t(null,void 0,i(290784)),E.t(null,void 0,i(171194)),E.t(null,void 0,i(55669))],dt=new Path2D("m13 6.02.5-.52-.5-.52-3.33-3.5-1.09 1.04 2.13 2.23H6.23L2.13.95l-1.01 1.1 4.3 4 .22.2H10.71L8.58 8.48l1.09 1.04 3.34-3.5Zm-9.4.45-3 3 1.06 1.06 3-3L3.6 6.47Z")
;class ct extends $.LollipopRenderer{_drawLollipop(e,t,i){const s=this._data.style;e.save(),e.translate(t.x,t.y),e.scale(i.horizontalPixelRatio,i.verticalPixelRatio),e.beginPath(),e.strokeStyle=s.outerBorderColor,e.lineWidth=1,e.arc(0,0,11,0,2*Math.PI),e.stroke(),e.fillStyle=s.backgroundColor,e.beginPath(),e.arc(0,0,10.5,0,2*Math.PI),e.fill(),e.translate(-6.5,-5.5),e.fillStyle=s.iconColor,e.fill(dt),e.translate(6.5,5.5),s.borderColor&&(e.strokeStyle=s.borderColor,e.lineWidth=1.5,(0,Q.setLineStyle)(e,Y.LINESTYLE_SOLID),e.beginPath(),e.arc(0,0,9.75,0,2*Math.PI),e.stroke()),e.restore()}}var _t=i(717090);const pt=E.t(null,void 0,i(520516)),yt=E.t(null,void 0,i(570323)),vt=E.t(null,void 0,i(881240)),mt=E.t(null,void 0,i(676912)),St={dark:{background:(0,a.getHexColorByName)("color-cold-gray-900"),foreground:(0,a.getHexColorByName)("color-deep-blue-a200"),linkColor:(0,a.getHexColorByName)("color-tv-blue-500")},light:{background:(0,a.getHexColorByName)("color-white"),foreground:(0,a.getHexColorByName)("color-deep-blue-a400"),linkColor:(0,a.getHexColorByName)("color-tv-blue-500")}},bt={barLine:{lineStyle:Y.LINESTYLE_DASHED,lineWidth:1,strokeStyle:""},lollipop:{width:21,height:21,bottom:2,lineWidth:1.5,strokeStyle:"",backgroundColor:"",fillCircle:!0,fillStyle:"",text:{label:"",strokeStyle:"",font:(0,z.makeFont)(12,m.CHART_FONT_FAMILY,"bold")}},iconColor:"",backgroundColor:"",outerBorderColor:""},gt=["F","G","H","J","K","M","N","Q","U","V","X","Z"];function ft(e,t){const i=Math.floor(t/100),s=t-100*i-1;return{name:`${e}${gt[s]}${i}`,expirationDate:`${ht[s]} ${i}`}}class Ct extends ae{extraData(e){const t=[];for(let i=0;i<4;++i){const s=3*i+1;if(!Boolean(e[s]))break;t.push({currentContractCode:e[s],nextContractCode:e[s+1],switchDate:e[s+2]})}return{items:t}}_createRendererForLollipop(e,t){return new ct(e,new d.HitTestResult(d.HitTarget.Custom,t),this._textWidthCache)}_createTooltipContent(e){return e.items.map((e=>{const t=[{name:mt,value:(0,at.formatYYYYMMDD)(this._model.dateFormatter(),e.switchDate)}],i=this._model.dark().value()?St.dark:St.light,s=this._model.mainSeries(),r=this._model.mainSeries().symbolInfo();if(null!==r&&void 0!==r.root){const o=r.listed_exchange,l={color:i.linkColor,cursor:"pointer"},n=ft(r.root,e.currentContractCode);t.push({name:yt,value:n.name,valueStyle:l,onValueClick:()=>this._model.undoModel().setSymbol(s,`${o}:${n.name}`)}),t.push({name:" ",value:n.expirationDate});const a=ft(r.root,e.nextContractCode);t.push({name:vt,value:a.name,valueStyle:l,onValueClick:()=>this._model.undoModel().setSymbol(s,`${o}:${a.name}`)}),t.push({name:" ",value:a.expirationDate})}return{type:"common",title:pt,subTitle:t,tooltipIcon:_t,style:{color:i.foreground}}}))}_lollipopId(e){return e[3].toString()}_showBarLine(e){return super._showBarLine(e)||this._model.mainSeries().properties().childs().showContinuousContractSwitchesBreaks.value()}_recreateStyles(e){const t=this._model.dark().value()?St.dark:St.light,i=t.foreground,s=t.background,r=(0,nt.default)(bt);r.iconColor=i,r.borderColor=i,r.backgroundColor=s,
r.outerBorderColor=s,r.barLine.strokeStyle=i,this._defaultStyle=r;const o=(0,nt.default)(r);o.backgroundColor=(0,ut.blendColors)(s,(0,q.applyAlpha)(i,.15)),this._hoveredStyle=o;const l=(0,nt.default)(r);l.backgroundColor=i,l.iconColor=s,l.borderColor=void 0,this._activeStyle=l,this._stylesCache=null}}class wt extends et{zorder(){return je.sortSourcesPreOrdered.RollDates}isValid(e){const t=e[4];return(0,W.isNumber)(t)}_createViews(){this._paneView=new Ct(this._model,this,this._showTooltip.bind(this)),super._createViews()}_externalVisibilityProperty(){return this._model.mainSeries().properties().childs().showContinuousContractSwitches}}var xt=i(709081),Pt=i(682541),It=i(772466);class Tt extends It.NonSeriesStudy{startIndex(){const e=this.customData();if(null==e||null==this._indexes)return null;const t=this._indexes[e.startIndex];return t!==Xe.INVALID_TIME_POINT_INDEX?t:null}endIndex(){const e=this.customData();if(null==e||null==this._indexes)return null;const t=this._indexes[e.endIndex];return t!==Xe.INVALID_TIME_POINT_INDEX?t:null}baseLine(){const e=this.customData();return null!=e?e.baseLine:null}downLine(){const e=this.customData();return null!=e?e.downLine:null}upLine(){const e=this.customData();return null!=e?e.upLine:null}pearsons(){const e=this.customData();return null!=e&&void 0!==e.pearsons?e.pearsons:null}isVisible(){if(!this.properties().childs().visible.value()||!this.isActualInterval())return!1;const e=(0,l.ensureDefined)(this.properties().childs().styles.childs());return 0!==e.upLine.childs().display.value()||0!==e.downLine.childs().display.value()||0!==e.baseLine.childs().display.value()}_createViews(){super._createViews(),Promise.all([i.e(77028),i.e(20507)]).then(i.bind(i,554855)).then((({LinearRegressionPaneView:e})=>{this._setPaneViews([new e(this.model(),this)])}))}}var Dt=i(894718),Rt=i(291784);var Lt=i(229765);class kt extends Lt.PriceAxisView{constructor(e,t){super(),this._source=e,this._styleId=t}_updateRendererData(e,t,i){var s;e.visible=!1;const r=this._source.priceScale(),o=this._source.properties().childs();if(!r||r.isEmpty()||!o.visible.value())return;const l=null===(s=this._source.properties().childs().graphics.childs().horizlines)||void 0===s?void 0:s.childs()[this._styleId].childs();if(!(l&&l.visible&&l.visible.value()&&this._isLabelVisibleAccordinglyToProperties()))return;const n=this._source.model().timeScale().logicalRange(),a=this._source.firstValue();if(null===a||null===n)return;const u={price:NaN,time:-1/0},h=this._source.graphics().horizlines().get(this._styleId);if(void 0===h)return;for(const e of h){if(void 0===e.level)continue;const t=n.contains(e.startIndex,!0);t===n.contains(e.endIndex,!0)&&0!==t||u.time<e.endIndex&&(u.time=e.endIndex,u.price=e.level)}if(isNaN(u.price))return;const d=(0,q.resetTransparency)(l.color.value());i.background=d,i.textColor=this.generateTextColor(d),i.coordinate=r.priceToCoordinate(u.price,a),e.text=r.formatPrice(u.price,a,!0),e.visible=!0}_isLabelVisibleAccordinglyToProperties(){
const e=this._source.model().properties().childs().scalesProperties.childs();return(e.showStudyLastValue.value()||e.showFundamentalLastValue.value())&&this._source.properties().childs().showLabelsOnPriceScale.value()}}var Vt=i(268008);class Mt extends o.Study{preferredZOrder(){return 0}async _createGraphicsPaneViews(){var e;const t=this.metaInfo().graphics,s=this.model(),r=[],o=this._needExtendToBarsEnding();if(t.hhists){const{HHistPaneView:t}=await Promise.all([i.e(77028),i.e(20507)]).then(i.bind(i,670751)),l=null===(e=this.properties().childs().graphics.childs().polygons)||void 0===e?void 0:e.childs();r.push(new t(this,s,void 0,null==l?void 0:l.histBoxBg,o))}if(t.horizlines){const{HorizLinePaneView:e}=await Promise.all([i.e(77028),i.e(20507)]).then(i.bind(i,722669));r.push(new e(this,s,void 0,o))}return r}_createGraphicsPriceAxisViews(){var e;return Object.keys(null!==(e=this.metaInfo().graphics.horizlines)&&void 0!==e?e:{}).map((e=>new kt(this,e)))}_createStudyPlotPaneView(e){return new Vt.StudyPlotPaneView(this,this._series,this._model,e,this._needExtendToBarsEnding())}_apiInputs(){return{...super._apiInputs(),mapRightBoundaryToBarStartTime:!!this._needExtendToBarsEnding()||void 0}}_needExtendToBarsEnding(){var e;return void 0!==(null===(e=this.metaInfo().defaults.inputs)||void 0===e?void 0:e.mapRightBoundaryToBarStartTime)}}class At extends Mt{priceRange(e,t){let i=!1;this.graphics().hhists().forEach(((e,t)=>{var s;i=i||(0,l.ensureDefined)(null===(s=this.properties().childs().graphics.childs().hhists)||void 0===s?void 0:s.childs()[t]).value()}));const s=function(e,t,i,s){let r=null;return e.forEach(((e,s)=>{e.forEach((e=>{e.firstBarTime<=i&&e.lastBarTime>=t&&(null===r?r={low:{l:e.priceLow,h:e.priceHigh},high:{h:e.priceHigh}}:(e.priceLow<r.low.l&&(r.low.l=e.priceLow,r.low.h=e.priceHigh),r.high.h=Math.max(r.high.h,e.priceHigh)))}))})),null===r?null:s?new Rt.PriceRange(r.low.l-.8*(r.low.h-r.low.l),r.high.h):new Rt.PriceRange(r.low.l,r.high.h)}(this.graphics().hhists(),e,t,i);if(null===s)return null;const r=(0,l.ensureNotNull)(this.priceScale());return r.isLog()?new Rt.PriceRange(r.priceToLogical(s.minValue()),r.priceToLogical(s.maxValue())):s}}var Bt=i(963894),Nt=i(195447),Et=i(827523),Ft=i(62745),Ht=i(7288),Ot=i(114315),Wt=i(989709),qt=i(484812);class zt{constructor(e,t){this._rough=e,this._detailed=t}forEach(e,t){this._mostDetailedHorizLines().forEach((i=>{e.call(t,i,i,this)}))}has(e){let t=!1;return this._mostDetailedHorizLines().forEach((i=>{t=t||i===e})),t}get size(){return this._rough.size}[Symbol.iterator](){const e=this._mostDetailedHorizLines().entries();return{[Symbol.iterator](){return this},next(){const t=e.next();return!0===t.done?t:{value:t.value[1]}}}}entries(){throw new Error("Not implemented")}keys(){throw new Error("Not implemented")}values(){throw new Error("Not implemented")}_mostDetailedHorizLines(){const e=new Map;this._rough.forEach((t=>e.set(t.startIndex,t)));for(let t=this._detailed.length-1;t>=0;t--){this._detailed[t].forEach((t=>{e.has(t.startIndex)&&e.set(t.startIndex,t)}))}return e}}
class Ut{constructor(e,t){this._mergedHorizLinesSet=e,this._roughIterator=t}[Symbol.iterator](){return this}next(){const e=this._roughIterator.next();if(!0===e.done)return e;const t=e.value[0];return{value:[t,(0,l.ensureDefined)(this._mergedHorizLinesSet.get(t))]}}}class Gt{constructor(e,t){this._roughHorizLineSets=e,this._detailedHorizLineSets=t}forEach(e,t){this._roughHorizLineSets.forEach(((i,s)=>{e.call(t,(0,l.ensureDefined)(this.get(s)),s,this)}))}get(e){const t=this._roughHorizLineSets.get(e);if(void 0!==t)return new zt(t,this._detailedHorizLineSets.map((t=>t.get(e))).filter((e=>void 0!==e)))}has(e){return this._roughHorizLineSets.has(e)}get size(){return this._roughHorizLineSets.size}[Symbol.iterator](){return new Ut(this,this._roughHorizLineSets.entries())}entries(){throw new Error("Not implemented")}keys(){throw new Error("Not implemented")}values(){throw new Error("Not implemented")}}class Yt{constructor(e,t){this._rough=e,this._detailed=t}forEach(e,t){this._rough.forEach(((i,s)=>{for(const i of this._detailed){const r=i.get(s);if(void 0!==r)return void e.call(t,r,s,this)}e.call(t,i,s,this)}))}get(e){for(const t of this._detailed){const i=t.get(e);if(void 0!==i)return i}return this._rough.get(e)}has(e){for(const t of this._detailed){if(t.has(e))return!0}return this._rough.has(e)}get size(){return this._rough.size}[Symbol.iterator](){throw new Error("Not implemented")}entries(){throw new Error("Not implemented")}keys(){throw new Error("Not implemented")}values(){throw new Error("Not implemented")}}class $t{constructor(e,t){this._graphics=e,this._styleId=t}forEach(e,t){this._graphics.hhistsByTimePointIndex().forEach((i=>{i.forEach((i=>{if(i.styleId===this._styleId){const s={firstBarTime:i.firstBarTime,lastBarTime:i.lastBarTime,rate:i.rate,priceHigh:i.priceHigh,priceLow:i.priceLow};e.call(t,s,s,this)}}))}))}has(e){let t=!1;return this._graphics.hhistsByTimePointIndex().forEach((i=>{i.forEach((i=>{i.styleId===this._styleId&&i===e&&(t=!0)}))})),t}get size(){let e=0;return this._graphics.hhistsByTimePointIndex().forEach((t=>{t.forEach((t=>{t.styleId===this._styleId&&e++}))})),e}[Symbol.iterator](){const e=this._graphics.hhistsByTimePointIndex()[Symbol.iterator]();let t,i;return{[Symbol.iterator](){return this},next(){for(;;){if(void 0===t&&(i=void 0,t=e.next(),!t.done&&!t.value))return{done:!0,value:void 0};const s=t.value;i||(i=s[Symbol.iterator]());const r=i.next();if(!r.done)return{value:r.value};{const e=t;if(t=void 0,r.value)return{value:r.value,done:e.done}}}}}}entries(){throw new Error("Not implemented")}keys(){throw new Error("Not implemented")}values(){throw new Error("Not implemented")}}class Qt{constructor(e,t){this._graphicsInfo=e,this._graphics=t}forEach(e,t){if(void 0===this._graphicsInfo.hhists)return;const i=Object.keys(this._graphicsInfo.hhists);for(const s of i)e.call(t,(0,l.ensureDefined)(this.get(s)),s,this)}get(e){if(void 0!==this._graphicsInfo.hhists)return new $t(this._graphics,e)}has(e){return void 0!==this._graphicsInfo.hhists&&e in this._graphicsInfo.hhists}get size(){
return void 0===this._graphicsInfo.hhists?0:Object.keys(this._graphicsInfo.hhists).length}[Symbol.iterator](){var e,t;const i=Object.keys(null!==(t=null===(e=this._graphicsInfo)||void 0===e?void 0:e.hhists)&&void 0!==t?t:{})[Symbol.iterator]();return{[Symbol.iterator](){return this},next:()=>{const e=i.next();return e.done?{done:!0,value:e.value?[e.value,(0,l.ensureDefined)(this.get(e.value))]:void 0}:{value:[e.value,(0,l.ensureDefined)(this.get(e.value))],done:e.done}}}}entries(){throw new Error("Not implemented")}keys(){throw new Error("Not implemented")}values(){throw new Error("Not implemented")}}class jt{constructor(e,t,i){this._graphicsInfo=e,this._roughStudyGraphics=t,this._detailedStudyGraphics=i}horizlines(){return new Gt(this._roughStudyGraphics.horizlines(),this._detailedStudyGraphics.map((e=>e.horizlines())))}vertlines(){return this._roughStudyGraphics.vertlines()}lines(){return this._roughStudyGraphics.lines()}hlines(){return this._roughStudyGraphics.hlines()}textmarks(){return this._roughStudyGraphics.textmarks()}shapemarks(){return this._roughStudyGraphics.shapemarks()}backgrounds(){return this._roughStudyGraphics.backgrounds()}polygons(){return this._roughStudyGraphics.polygons()}trendchannels(){return this._roughStudyGraphics.trendchannels()}hhists(){return new Qt(this._graphicsInfo,this)}hhistsByTimePointIndex(){return new Yt(this._roughStudyGraphics.hhistsByTimePointIndex(),this._detailedStudyGraphics.map((e=>e.hhistsByTimePointIndex())))}dwglabels(){return this._roughStudyGraphics.dwglabels()}dwglines(){return this._roughStudyGraphics.dwglines()}dwgpolylines(){return this._roughStudyGraphics.dwgpolylines()}dwgboxes(){return this._roughStudyGraphics.dwgboxes()}dwgtables(){return this._roughStudyGraphics.dwgtables()}dwgtablecells(){return this._roughStudyGraphics.dwgtablecells()}dwglinefills(){return this._roughStudyGraphics.dwglinefills()}tpos(){return this._roughStudyGraphics.tpos()}tpoBlockSets(){return this._roughStudyGraphics.tpoBlockSets()}tpoBlockSetsByStyleAndTpoId(e,t){return this._roughStudyGraphics.tpoBlockSetsByStyleAndTpoId(e,t)}tpoLevels(){return this._roughStudyGraphics.tpoLevels()}tpoVolumeRows(){return this._roughStudyGraphics.tpoVolumeRows()}tpoVolumeRowByStyleAndTpoId(e,t){return this._roughStudyGraphics.tpoVolumeRowByStyleAndTpoId(e,t)}logs(){return this._roughStudyGraphics.logs()}performance(){return this._roughStudyGraphics.performance()}footprints(){return this._roughStudyGraphics.footprints()}footprintLevels(){return this._roughStudyGraphics.footprintLevels()}}var Xt=i(964824),Zt=i(347710);const Kt="tv-volumebyprice",Jt=(0,Et.studyIdString)("VbPSessionsRough",Kt),ei=(0,Et.studyIdString)("VbPSessionsDetailed",Kt),ti=(0,Et.studyIdString)("VbPSessionsDetailedAlerts",Kt),ii=Number.MAX_SAFE_INTEGER,si=E.t(null,void 0,i(421934));class ri extends At{constructor(e,t,i,s){super(e,t,i,s),this._isPackageAvailable=oi(),this._alertsStudyMetaInfo=null,this._roughDataSource=null,this._detailedDataSource=null,this._detailedDataBuffer=new Bt.CircularBuffer(7),this._loadedGraphics=null,
this._loadedPlots=null,this._mergedGraphics=(0,qt.emptyStudyGraphics)(),this._mergedPlots=this._emptyPlotList(),this._isPackageAvailable||this._setStatus({type:Ht.StudyStatusType.Error,errorDescription:{error:si}})}destroy(){null!==this._detailedDataSource&&(this._detailedDataSource.dataUpdated().unsubscribe(this,this._onRoughOrDetailedDataUpdated),this._detailedDataSource.dataCleared().unsubscribe(this,this._onRoughOrDetailedDataCleared),this._detailedDataSource.studyStatusChanged().unsubscribe(this,this._onStudyStatusChanged),this._detailedDataSource.destroy(),this._detailedDataSource=null),null!==this._roughDataSource&&(this._roughDataSource.dataUpdated().unsubscribe(this,this._onRoughOrDetailedDataUpdated),this._roughDataSource.dataCleared().unsubscribe(this,this._onRoughOrDetailedDataCleared),this._roughDataSource.studyStatusChanged().unsubscribe(this,this._onStudyStatusChanged),this._roughDataSource.destroy(),this._roughDataSource=null),super.destroy()}data(){return this._loadedPlots||this._mergedPlots}graphics(){return this._loadedGraphics||this._mergedGraphics}clearData(){null!==this._roughDataSource&&this._roughDataSource.clearData(),null!==this._detailedDataSource&&this._detailedDataSource.clearData()}restoreData(e){this._invalidateLastNonEmptyPlotRowCache(),this._loadedPlots=this._emptyPlotList(),this._loadedPlots.restoreState(e),void 0!==e.graphics&&(this._loadedGraphics=(0,qt.loadStudyGraphics)(e.graphics)),this._postProcessGraphics()}isFailed(){return!this._isPackageAvailable||null!==this._roughDataSource&&this._roughDataSource.studyStatus().type===Ht.StudyStatusType.Error||null!==this._detailedDataSource&&this._detailedDataSource.studyStatus().type===Ht.StudyStatusType.Error}isLoading(){return null!==this._roughDataSource&&this._roughDataSource.studyStatus().type===Ht.StudyStatusType.Loading||null!==this._detailedDataSource&&this._detailedDataSource.studyStatus().type===Ht.StudyStatusType.Loading}isStarted(){return null!==this._roughDataSource&&this._roughDataSource.isStarted()||null!==this._detailedDataSource&&this._detailedDataSource.isStarted()}sourceId(){throw new Error("Invalid operation")}idForAlert(){return super._collectDepsForAlert().idForAlert}canHaveChildren(){return!1}isChildStudy(){return!1}hasChildren(){return!1}getAllChildren(){return[]}isHibernated(){return!(this.isVisible()||null!==this._roughDataSource&&this._roughDataSource.isStarted()||null!==this._detailedDataSource&&this._detailedDataSource.isStarted())}_alertMetaInfo(){return this._alertsStudyMetaInfo}_stopStudyOnServer(){var e,t;this._chartApi&&this._chartApi.isConnected().value()&&((null===(e=this._roughDataSource)||void 0===e?void 0:e.isStarted())&&this._roughDataSource.stop(),(null===(t=this._detailedDataSource)||void 0===t?void 0:t.isStarted())&&this._detailedDataSource.stop())}async _startAfterSymbolsResolved(e,t){if(!this.isStarted()||this.isRestarting())if(this._restarting=!1,this._isPackageAvailable=oi(),this._isPackageAvailable){if(this._allInputsAreValid()){if(this._inputs=this._apiInputs(),
null===this._roughDataSource){const e=await(0,Zt.studyMetaInfoRepository)().findById({type:"java",studyId:Jt});this._roughDataSource=new Ot.ExtendedStudyDataSource(this.model().chartApi(),this.model().mainSeries(),"vbpsessionsrough_",e),this._roughDataSource.studyStatusChanged().subscribe(this,this._onStudyStatusChanged),this._roughDataSource.dataCleared().subscribe(this,this._onRoughOrDetailedDataCleared),this._roughDataSource.dataUpdated().subscribe(this,this._onRoughOrDetailedDataUpdated)}else this._roughDataSource.stop();if(this._roughDataSource.setInputs(li(this._roughDataSource.metaInfo().inputs,this._inputs)),null===this._detailedDataSource){const e=await(0,Zt.studyMetaInfoRepository)().findById({type:"java",studyId:ei});this._detailedDataSource=new Ot.ExtendedStudyDataSource(this.model().chartApi(),this.model().mainSeries(),"vbpsessionsdetailed_",e),this._detailedDataSource.studyStatusChanged().subscribe(this,this._onStudyStatusChanged),this._detailedDataSource.dataCleared().subscribe(this,this._onRoughOrDetailedDataCleared),this._detailedDataSource.dataUpdated().subscribe(this,this._onRoughOrDetailedDataUpdated)}else this._detailedDataSource.stop();this._detailedDataSource.setInputs(ni(this._inputs)),this._roughDataSource.start(),this._detailedDataSource.start(),this._createStudyGraphics(),this._subscribeToSessionId(),this._setStatus(this._statusValueFromDataSources()),this._onStart.fire(),null===this._alertsStudyMetaInfo&&(this._alertsStudyMetaInfo=await(0,Zt.studyMetaInfoRepository)().findById({type:"java",studyId:ti}),this._updateAlertCreationAvailable())}}else this._setStatus({type:Ht.StudyStatusType.Error,errorDescription:{error:si}})}async _changeInputsImpl(e,t){if(null!==this._roughDataSource){if((0,Ft.areStudyInputsEqual)(this._roughDataSource.metaInfo().inputs,t,e)){if(null!==this._detailedDataSource){const t=ni(e),i=(0,Ft.rangeDependentStudyInputsToTimeRange)(t);if(this._moreDetailedDataRequiredForTimeRange(i)){if(this._detailedDataSource.isActive()){const e=this._detailedDataSource.stopAndStealData();if(e.plots.size()>0||!(0,qt.isStudyGraphicsEmpty)(e.graphics)){const t=(0,l.ensureNotNull)(this._detailedDataSource.inputs());e.plots=this._extractEffectiveDetailedPlotValues(e.plots,t),this._detailedDataBuffer.enqueue({lod:ai(t),value:e})}}this._detailedDataSource.setInputs(t),this._detailedDataSource.start()}}}else this._inputs=e,this._roughDataSource.setInputs(li(this._roughDataSource.metaInfo().inputs,e)),this._detailedDataBuffer.clear(),null!==this._detailedDataSource&&this._detailedDataSource.setInputs(ni(e));null!==this._detailedDataSource&&this._createStudyGraphics()}}_collectDepsForAlert(){const e=super._collectDepsForAlert();if(null===this._alertsStudyMetaInfo)throw new Error("Alerts study metainfo is not ready yet. Have you checked the alert availability using hasStateForAlert()?");return{...e,studyDependencies:e.studyDependencies.map((e=>{const t=e.study===ui(this.metaInfo());return{id:e.id,inputs:t?(i=e.inputs,{...i,subscribeRealtime:!0}):e.inputs,
study:t&&null!==this._alertsStudyMetaInfo?ui(this._alertsStudyMetaInfo):e.study};var i}))}}_statusValueFromDataSources(){const e={type:Ht.StudyStatusType.Undefined};if(null===this._roughDataSource||null===this._detailedDataSource)return e;const t=this._roughDataSource.studyStatus(),i=this._detailedDataSource.studyStatus();if(t.type===Ht.StudyStatusType.Error)return t;if(i.type===Ht.StudyStatusType.Error)return i;if(t.type===Ht.StudyStatusType.Loading||i.type===Ht.StudyStatusType.Loading){const e=t.type===Ht.StudyStatusType.Loading?t.startTime:1/0,s=i.type===Ht.StudyStatusType.Loading?i.startTime:1/0;return{type:Ht.StudyStatusType.Loading,startTime:Math.min(e,s)}}return t.type===Ht.StudyStatusType.Completed?{type:Ht.StudyStatusType.Completed}:e}_emptyPlotList(){return new Nt.PlotList((0,Wt.studyPlotFunctionMap)(this.metaInfo()),Wt.studyEmptyPlotValuePredicate)}_createStudyPlots(){const e=(0,l.ensureNotNull)(this._roughDataSource),t=(0,l.ensureNotNull)(this._detailedDataSource);this._mergedPlots.clear();const i=[];i.push({lod:ii,value:e.plots()}),this._detailedDataBuffer.forEach((e=>{i.push({lod:e.lod,value:e.value.plots})}));const s=(0,l.ensureNotNull)(t.inputs());i.push({lod:ai(s),value:this._extractEffectiveDetailedPlotValues(t.plots(),s)}),i.sort(((e,t)=>t.lod-e.lod));for(const e of i)e.value.each(((e,t)=>{for(const e of t)if(void 0===e)return!1;return this._mergedPlots.add(e,t),!1}));this._invalidateLastNonEmptyPlotRowCache()}_createStudyGraphics(){const e=(0,l.ensureNotNull)(this._roughDataSource),t=(0,l.ensureNotNull)(this._detailedDataSource),i=[];this._detailedDataBuffer.forEach((e=>{i.push({lod:e.lod,value:e.value.graphics})})),void 0!==this._inputs&&i.push({lod:ai(this._inputs),value:t.graphics()}),i.sort(((e,t)=>e.lod-t.lod));const s=i.map((e=>e.value));this._mergedGraphics=new jt(this.metaInfo().graphics,e.graphics(),s),this._postProcessGraphics()}_extractEffectiveDetailedPlotValues(e,t){const i=(0,Ft.rangeDependentStudyInputsToTimeRange)(t),s=this.model().timeScale().timePointToIndex(i.from),r=this.model().timeScale().timePointToIndex(i.to);return e.size()>0?e.range(s||(0,l.ensureNotNull)(e.firstIndex()),r||(0,l.ensureNotNull)(e.lastIndex())):this._emptyPlotList()}_moreDetailedDataRequiredForTimeRange(e){const{from:t,to:i}=e;let s=!1;return(0,l.ensureNotNull)(this._roughDataSource).graphics().hhistsByTimePointIndex().forEach(((e,r)=>{if(s)return;const o=this.model().timeScale().indexToTimePoint(r);if(null===o||o<t||i<o)return;const l=i-t;let n=!1;this._detailedDataBuffer.forEach((e=>{if(e.lod<=l){e.value.graphics.hhistsByTimePointIndex().has(r)&&(n=!0)}})),n||(s=!0)})),s}_onStudyStatusChanged(){const e=this.status();this._setStatus(this._statusValueFromDataSources()),e.type!==this.status().type&&this._updateAlertCreationAvailable(),(0,l.ensureDefined)(this._statusView).update()}_onRoughOrDetailedDataCleared(){null!==this._roughDataSource&&null!==this._detailedDataSource&&(this._invalidateLastNonEmptyPlotRowCache(),this._detailedDataBuffer.clear(),this._createStudyPlots(),this._createStudyGraphics(),
this.updateAllViews((0,Xt.sourceChangeEvent)({sourceId:this.id(),clearData:!0})),this.model().updateSource(this))}_onRoughOrDetailedDataUpdated(e){null!==this._roughDataSource&&null!==this._detailedDataSource&&(e.length>0&&this._createStudyPlots(),this.updateAllViews((0,Xt.sourceChangeEvent)(this.id())),this.model().updateSource(this))}}function oi(){return void 0!==window.pro&&window.pro.hasPackage(Kt)}function li(e,t){const i={};for(const s of e)i[s.id]=t[s.id];return i}function ni(e){const t=e.last_visible_bar_time-e.first_visible_bar_time;return{...e,first_visible_bar_time:e.first_visible_bar_time-t,last_visible_bar_time:e.last_visible_bar_time+t}}function ai(e){const{from:t,to:i}=(0,Ft.rangeDependentStudyInputsToTimeRange)(e);return i-t}function ui(e){return`${e.id}-${e.version}`}var hi=i(576678),di=i(556983),ci=i(856676);class _i extends ci.TpoStudyBase{splitMergeSupported(){return!1}}var pi=i(205838),yi=i(871934);class vi{constructor(e,t,i,s){this._priceAxisFontSize=11,this._prices=[],this._labelWidth=0,this._pixelRatioParams=e,this._recreateCanvasAndContext((0,yi.size)({width:0,height:0})),this.reset({font:t,fontSize:i,backColors:s})}destroy(){delete this._canvas,delete this._cache}canvas(){return this._canvas}reset(e){this._renderParams=e,this._prices=[],this._cache.font=e.fontSize+"px "+e.font,this._labelWidth=["P","S1","R1","S2","R2","S3","R3","S4","R4","S5","R5","/"].reduce(((e,t)=>{const i=this._cache.measureText(t).width;return Math.max(i,e)}),0)}rowHeight(){return this._priceAxisFontSize+4}labelRectByIndex(e){return{left:0,top:Math.round(this._topByIndex(e)),width:Math.round(this._labelWidth+4),height:Math.round(this._renderParams.fontSize+8)}}setPrices(e){let t=!1;const i=(e,t)=>{const i=void 0===e,s=void 0===t;return(!i&&!s||i===s)&&(0,l.ensureDefined)(e).formatted===(0,l.ensureDefined)(t).formatted};if(e.length!==this._prices.length)t=!0;else for(let s=0;s<this._prices.length;s++)if(!i(this._prices[s],e[s])){t=!0;break}if(t){const t=this._labelWidth+6,i=this._renderParams.fontSize,s=Math.max(e.length,22)*(i+8);this._recreateCanvasAndContext((0,yi.size)({width:t,height:s})),this._prices=e,this._cache.save(),(0,_.drawScaled)(this._cache,this._pixelRatioParams.horizontalPixelRatio,this._pixelRatioParams.verticalPixelRatio,(()=>{this._cache.translate(.5,.5),this._cache.font=this._renderParams.fontSize+"px "+this._renderParams.font,this._cache.textBaseline="middle";for(let e=0;e<this._prices.length;e++){if(!this._prices[e])continue;const t=["P","S1","R1","S2","R2","S3","R3","S4","R4","S5","R5"][e];this._cache.fillStyle=this._renderParams.backColors[e],this._cache.fillText(t,0,this._centerByIndex(e)),this._cache.fillText("/",0,this._centerByIndex(e+11))}})),this._cache.restore(),this._prices=e}}_recreateCanvasAndContext(e){this._canvas=document.createElement("canvas"),this._canvas.width=e.width*this._pixelRatioParams.horizontalPixelRatio,this._canvas.height=e.height*this._pixelRatioParams.verticalPixelRatio,this._cache=(0,l.ensureNotNull)(this._canvas.getContext("2d"))}_centerByIndex(e){
return Math.round((e+.5)*(this._renderParams.fontSize+8))}_topByIndex(e){return Math.round(e*(this._renderParams.fontSize+8))}}const mi=["P","S1","R1","S2","R2","S3","R3","S4","R4","S5","R5"];class Si extends Lt.PriceAxisView{constructor(e,t){super(),this._source=e,this._data=t;const i=t.name;this._completeName="P"===i.toUpperCase()?"P":`S${i[1]}/R${i[1]}`}_updateRendererData(e,t,i){e.visible=!1,t.visible=!1;const s=this._source.properties().childs();if(!s.visible.value())return;const r=this._completeName,o=s.levelsStyle.childs().visibility.childs();if(!o[r]||!o[r].value())return;const l=this._source.model().timeScale(),n=this._source.priceScale();if(l.isEmpty()||null===l.visibleBarsStrictRange()||null!==n&&n.isEmpty())return;const a=this._source.customData();if(!a||!a.pivots)return;const u=this._source.pricesView().prices()[mi.indexOf(this._data.name.toUpperCase())];if(!u)return;i.background=(0,q.resetTransparency)(u.color),i.textColor=this.generateTextColor(i.background),i.coordinate=u.coordinate,i.floatCoordinate=u.coordinate;const h=this._source.model().properties().childs().scalesProperties.childs();h.showStudyLastValue.value()&&(e.text=u.formatted,e.visible=!0),h.showStudyPlotLabels.value()&&(t.text=this._source.priceLabelText(this._data.name),t.visible=!0)}}var bi=i(742391),gi=i(544820);const fi=["p","s1","r1","s2","r2","s3","r3","s4","r4","s5","r5"],Ci={P:"P",S1:"S1/R1",S2:"S2/R2",S3:"S3/R3",S4:"S4/R4",S5:"S5/R5",R1:"S1/R1",R2:"S2/R2",R3:"S3/R3",R4:"S4/R4",R5:"S5/R5"};class wi{constructor(e){this._visiblePivots=new Set,this._invidated=!0,this._prices=[],this._source=e}visiblePivots(){return this._visiblePivots}update(){this._invidated=!0}prices(){return this._invidated&&(this._updateImpl(),this._invidated=!1),this._prices}_updateImpl(){this._visiblePivots.clear();const e=this._source.model(),t=this._source.priceScale();if(null===t)return;if(e.timeScale().isEmpty()||t.isEmpty())return;const i=e.timeScale().visibleBarsStrictRange();if(null===i)return;if(!this._source.customData()||!this._source.customData().pivots)return;const s=e.mainSeries().bars().search(i.lastBar(),S.PlotRowSearchMode.NearestLeft);if(null===s)return;const r=this._source.indexes();if(!r)return;const o=s.index,l=this._source.customData().pivots,n=this._source.properties().childs(),a=this._source.firstValue();for(let e=0;e<l.length;e++){if(!l[e])continue;const i=r[l[e].startIndex],s=r[l[e].endIndex],u=n.inputs.childs().showHistoricalPivots.value();if(i<=o&&(s>=o||u)){this._visiblePivots.add(l[e]),this._prices=[];for(let i=0;i<fi.length;i++){const s=fi[i],r=l[e][s];if(void 0===r||null===a)continue;const o=t.priceToCoordinate(r,a),u=s.toUpperCase(),h=Ci[u],d=n.levelsStyle.childs().colors.childs()[h].value();this._prices.push({formatted:t.formatPrice(r,a),price:r,coordinate:o,color:d})}}}}}var xi=i(9524),Pi=i(43192);class Ii extends Pi.BitmapCoordinatesPaneRenderer{constructor(e,t,i){super(),this._drawRects=[],this._cacheProvider=e,this._point=t,this._label=i}hitTest(e){
for(const t of this._drawRects)if(e.x>=t.left&&e.x<=t.left+t.width&&e.y>=t.top&&e.y<=t.top+t.height)return new d.HitTestResult(d.HitTarget.Regular);return null}_drawImpl(e){const t=this._cacheProvider(e),{horizontalPixelRatio:i,verticalPixelRatio:s,context:r}=e;this._drawRects=[];const o=e=>{const o=t.labelRectByIndex(e),l={left:Math.round(this._point.x-o.width+n),top:Math.round(this._point.y-o.height/2),width:o.width,height:o.height};return r.drawImage(t.canvas(),Math.round(o.left*i),Math.round(o.top*s),o.width*i,o.height*s,Math.round(l.left*i),Math.round(l.top*s),l.width*i,l.height*s),this._drawRects.push(l),o.width},l=this._label.split("/");let n=0;for(let e=0;e<l.length;e++){const t=["P","S1","R1","S2","R2","S3","R3","S4","R4","S5","R5"].indexOf(l[e]);e>0&&(n+=o(t+11)/2),n+=o(t)/2}}}function Ti(e){return"P"===e?e:"S"+e[1]+"/R"+e[1]}function Di(e,t,i){const s=t;void 0===e[s]?e[s]={text:i,ids:[Ti(i)]}:(e[s].text+="/"+i,e[s].ids.push(Ti(i)))}class Ri{constructor(e,t){this._pivots=[],this._invalidated=!0,this._renderer=new b.CompositeRenderer,this._model=e,this._source=t,this._cacheProvider=this._source.getCache.bind(this._source)}update(e){this._invalidated=!0}renderer(){return this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._renderer}_updateImpl(){this._renderer.clear();const e=this._source.ownerSource();if(null===e)return;this._source.pricesView().prices(),this._pivots=[];const t=this._source.customData();if(!t||!t.pivots)return;const i=this._source.properties().childs();if(!i.visible.value())return;const s=t.pivots,r=this._source.indexes(),o=this._model.timeScale(),n=this._source.priceScale(),a=e.firstValue();if(!n||n.isEmpty()||o.isEmpty()||!s||!r||null===a)return;const h=(0,l.ensureNotNull)(o.visibleBarsStrictRange()),c=h.firstBar(),_=h.lastBar();for(let e=0;e<s.length;e++){if(!s[e])continue;const t=r[s[e].startIndex],l=r[s[e].endIndex];if(l<c||t>_)continue;const u={},h=i.levelsStyle.childs().visibility.childs();h.P.value()&&Di(u,s[e].p,"P"),h["S1/R1"].value()&&(Di(u,s[e].s1,"S1"),Di(u,s[e].r1,"R1")),h["S2/R2"].value()&&(Di(u,s[e].s2,"S2"),Di(u,s[e].r2,"R2")),h["S3/R3"].value()&&(Di(u,s[e].s3,"S3"),Di(u,s[e].r3,"R3")),h["S4/R4"].value()&&(Di(u,s[e].s4,"S4"),Di(u,s[e].r4,"R4")),h["S5/R5"].value()&&(Di(u,s[e].s5,"S5"),Di(u,s[e].r5,"R5"));const d=o.indexToCoordinate(t),p=o.indexToCoordinate(l);for(const t of Object.keys(u)){const i=parseFloat(t),r=n.priceToCoordinate(i,a);this._pivots.push({x1:d,x2:p,y:r,label:u[t].text,labelIds:u[t].ids,src:s[e]})}}const p=i.levelsStyle.childs().colors,y=i.levelsStyle.childs().widths,v=this._source.visiblePivots();for(let e=0;e<this._pivots.length;e++){const t=this._pivots[e];if(!v.has(t.src))continue;const s={color:p.childs()[t.labelIds[0]].value(),linewidth:y.childs()[t.labelIds[0]].value(),linestyle:Y.LINESTYLE_SOLID,y:t.y,left:t.x1,right:t.x2},r=new xi.HorizontalLineRenderer;r.setData(s),r.setHitTest(new d.HitTestResult(d.HitTarget.Regular)),this._renderer.append(r),
i.levelsStyle.childs().showLabels.value()&&this._renderer.append(new Ii(this._cacheProvider,new u.Point(t.x1,t.y),t.label))}}}class Li extends It.NonSeriesStudy{constructor(e,t,i,s){super(e,t,i,s),this._cache=null,this._cachedPixelRatioParams=null;const r=["P","S1/R1","S2/R2","S3/R3","S4/R4","S5/R5"],o=this.properties().childs().levelsStyle.childs().visibility;for(let e=0;e<r.length;e++)o.childs()[r[e]].listeners().subscribe(this,(()=>this.processHibernate()))}pricesView(){return this._pricesView}indexes(){return this._indexes}properties(){return this._properties}getCache(e){if(null===this._cache||null==this._cachedPixelRatioParams||(t=e,i=this._cachedPixelRatioParams,t.horizontalPixelRatio!==i.horizontalPixelRatio||t.verticalPixelRatio!==i.verticalPixelRatio)){this._cache&&this._cache.destroy();const t=this._getActualCacheParams(),i={horizontalPixelRatio:e.horizontalPixelRatio,verticalPixelRatio:e.verticalPixelRatio};this._cache=new vi(i,t.font,t.fontSize,t.backColors),this._cache.setPrices((0,l.ensureNotNull)(this._pricesView).prices()),this._cachedPixelRatioParams=i,this._cache.reset(t)}var t,i;return this._cache}priceLabelText(e){return this._metaInfo.shortDescription+":"+e.toUpperCase()}updateAllViews(e){super.updateAllViews(e),this._pricesView.update()}visiblePivots(){return this._pricesView.visiblePivots()}isVisible(){if(!this.properties().childs().visible.value()||!this.isActualInterval())return!1;const e=["P","S1/R1","S2/R2","S3/R3","S4/R4","S5/R5"],t=this.properties().childs().levelsStyle.childs().visibility;for(let i=0;i<e.length;i++)if(t.childs()[e[i]].value())return!0;return!1}stop(){super.stop(),this._cache&&(this._cache.destroy(),this._cache=null)}priceRange(e,t){var i;const s=null===(i=this.customData())||void 0===i?void 0:i.pivots;if(!s||!this._indexes)return null;if(!this.priceScale())return null;const r=s,o=this._indexes;let l=null;for(let i=0;i<r.length;i++){if(!r[i])continue;const s=o[r[i].startIndex];if(o[r[i].endIndex]<e||s>t)continue;const n=[],a=this.properties().childs().levelsStyle.childs().visibility.childs();a.P.value()&&n.push(r[i].p),a["S1/R1"].value()&&n.push(r[i].s1,r[i].r1),a["S2/R2"].value()&&n.push(r[i].s2,r[i].r2),a["S3/R3"].value()&&n.push(r[i].s3,r[i].r3),a["S4/R4"].value()&&n.push(r[i].s4,r[i].r4),a["S5/R5"].value()&&n.push(r[i].s5,r[i].r5);for(let e=0;e<n.length;e++)n[e]&&(null===l?l=new Rt.PriceRange(n[e],n[e]):l.apply(n[e],n[e]))}const n=this.priceScale();return n&&n.isLog()&&l?new Rt.PriceRange(n.priceToLogical(l.minValue()),n.priceToLogical(l.maxValue())):l}_createViews(){this._cache&&(this._cache.destroy(),this._cache=null),this._priceAxisViews=[];const e=["P","S1","R1","S2","R2","S3","R3","S4","R4","S5","R5"];this._paneViews.length=0,this._labelPaneViews=[];const t=new Ri(this._model,this);this._paneViews.push(t);for(let t=0;t<e.length;t++){const i=new Si(this,{name:e[t]});this._priceAxisViews.push(i),this._labelPaneViews.push(new bi.PanePriceAxisView(i,this,this._model))}this._dataWindowView||(this._dataWindowView=new gi.StudyDataWindowView(this,this._model)),
this._statusView||(this._statusView=new Ke.StudyStatusView(this)),this._legendView=null,this._pricesView=new wi(this)}_postProcessGraphics(){}_getActualCacheParams(){const e=this.properties().childs(),t=e.levelsStyle.childs().colors.childs();return{font:m.CHART_FONT_FAMILY,fontSize:e.fontsize.value(),backColors:[t.P.value(),t["S1/R1"].value(),t["S1/R1"].value(),t["S2/R2"].value(),t["S2/R2"].value(),t["S3/R3"].value(),t["S3/R3"].value(),t["S4/R4"].value(),t["S4/R4"].value(),t["S5/R5"].value(),t["S5/R5"].value()]}}}var ki=i(7195),Vi=i(943855),Mi=i(738949),Ai=i(306682),Bi=i(531094);class Ni extends o.Study{constructor(e,t,i,s){super(e,t,i,s)}base(){return 1}destroy(){super.destroy()}showOnTopOnHovering(){return!1}_titleInParts(e,t,i,s,r,o){const l=super._titleInParts(e,t,i,s,r),n=this._getVolumeUnit();return n&&!o&&(l[0]+=` Â· ${n}`),l}_skippedTitleInputs(){const e=super._skippedTitleInputs();0===this._getPlotDisplayValue("vol_ma")&&!e.includes("length")&&e.push("length");return e}_getVolumeUnit(){const e=this.symbolSource().symbolInfo();return e?(0,Bi.getVolumeUnit)({...e,currency:e.original_currency_code||e.currency_code}):void 0}}var Ei=i(470130),Fi=i(537919);function Hi(e){return e instanceof o.Study}function Oi(e){return e instanceof A}function Wi(e){return e instanceof Ai.StudyStub}function qi(e){return e instanceof xt.Fundamental}function zi(e){return e instanceof lt||e instanceof ot||e instanceof rt}function Ui(e){return e instanceof wt}function Gi(e,t,i,s,l,n){var a;if(r.StudyMetaInfo.isScriptStrategy(s)){return new A(e,t,i,s,2===n)}const u=(0,Ei.studyNameByMetaInfo)(s),h=new((null===(a=(0,Fi.getStudyInfoByName)(u))||void 0===a?void 0:a.studyConstructor)||o.Study)(e,t,i,s);return void 0!==l&&h.setId(l),h}function Yi(e){const t=(0,Ei.studyNameByMetaInfo)(e),i=(0,Fi.getStudyInfoByName)(t);return i?i.colorRotationMode:void 0===e.pine||r.StudyMetaInfo.isStandardPine(e.id)?1!==e.plots.length?"shift":"loop":null}function $i(e,t){return e.id===t.id&&(s=t,((i=e).pine?i.pine.version:void 0)===(s.pine?s.pine.version:void 0));var i,s}function Qi(e){const t=(0,Ei.studyNameByMetaInfo)(e),i=(0,Fi.getStudyInfoByName)(t);if(i){const e=i.colorRotationComparator;if(void 0!==e)return e}return $i}function ji(e){return(null!=e?e:[]).some((e=>e.confirm))}(0,Fi.addStudyInfoToMap)("study_PivotPointsStandard",(0,Fi.createStudyInfo)(Li)),(0,Fi.addStudyInfoToMap)("study_Overlay",(0,Fi.createStudyInfo)(ki.study_Overlay,"loop")),(0,Fi.addStudyInfoToMap)("study_Compare",(0,Fi.createStudyInfo)(Vi.StudyCompare,"loop")),(0,Fi.addStudyInfoToMap)("study_Volume",(0,Fi.createStudyInfo)(Ni)),(0,Fi.addStudyInfoToMap)("study_VbPVisible",(0,Fi.createStudyInfo)(class extends At{alertCreationAvailable(){return new n.WatchedValue(!1).readonly()}_needExtendToBarsEnding(){return!1}})),(0,Fi.addStudyInfoToMap)("study_ScriptWithDataOffset",(0,Fi.createStudyInfo)(Mi.study_ScriptWithDataOffset)),(0,Fi.addStudyInfoToMap)("study_Earnings",(0,Fi.createStudyInfo)(lt)),(0,Fi.addStudyInfoToMap)("study_Splits",(0,Fi.createStudyInfo)(ot)),(0,
Fi.addStudyInfoToMap)("study_Dividends",(0,Fi.createStudyInfo)(rt)),(0,Fi.addStudyInfoToMap)("study_BarSetContinuousRollDates",(0,Fi.createStudyInfo)(wt)),(0,Fi.addStudyInfoToMap)(Ei.fundamentalsPrefix,(0,Fi.createStudyInfo)(xt.Fundamental,"loop",((e,t)=>(0,Ei.isFundamentalStudyMetaInfo)(t)))),(0,Fi.addStudyInfoToMap)("study_ElliottWave",(0,Fi.createStudyInfo)(Pt.study_ElliottWave)),(0,Fi.addStudyInfoToMap)("study_LinearRegression",(0,Fi.createStudyInfo)(Tt)),(0,Fi.addStudyInfoToMap)("study_PivotPointsHighLow",(0,Fi.createStudyInfo)(Dt.study_PivotPointsHighLow)),(0,Fi.addStudyInfoToMap)("study_VbPSessions",(0,Fi.createStudyInfo)(At)),(0,Fi.addStudyInfoToMap)("study_VbPPeriodic",(0,Fi.createStudyInfo)(Mt)),(0,Fi.addStudyInfoToMap)("study_VbPSessionsRoughDetailed",(0,Fi.createStudyInfo)(ri)),(0,Fi.addStudyInfoToMap)("study_ZigZag",(0,Fi.createStudyInfo)(hi.study_ZigZag)),(0,Fi.addStudyInfoToMap)("study_VbPAutoAnchored",(0,Fi.createStudyInfo)(Mt)),(0,Fi.addStudyInfoToMap)("study_TPOPeriodic",(0,Fi.createStudyInfo)(di.TpoPeriodicStudy)),(0,Fi.addStudyInfoToMap)("study_TPOSessions",(0,Fi.createStudyInfo)(_i)),(0,Fi.addStudyInfoToMap)("study_VolumeFootprint",(0,Fi.createStudyInfo)(pi.VolumeFootprintStudy)),(0,Fi.addStudyInfoToMap)("StudyStrategy",(0,Fi.createStudyInfo)(A));const Xi=["Overlay@tv-basicstudies","CorrelationCoefficient@tv-basicstudies","Correlation Coeff@tv-basicstudies","Spread@tv-basicstudies","Ratio@tv-basicstudies"];function Zi(e){return Xi.includes(e.id)}},306682:(e,t,i)=>{"use strict";i.d(t,{StudyStub:()=>S});var s=i(316230),r=i(877009),o=i(555502),l=i(974655),n=i(624444),a=i(707957),u=i(354950),h=i(414585),d=i(982217);class c extends h.StudyStatusProviderBase{text(){return this._source.isActualInterval()?`${this._source.title(d.TitleDisplayTarget.StatusLine)} ${this.sourceStatusText()}`:this._source.title(d.TitleDisplayTarget.StatusLine)}}var _=i(7288),p=i(790524),y=i(347710);class v{getItems(){return[]}getValues(e){return[]}}const m=new a.Delegate;class S extends l.PriceDataSource{constructor(e,t,i,s){super(e),this._priceStep=.01,this._origState=null,this._descriptor=null,this._status={type:_.StudyStatusType.Undefined},this._statusChanged=new a.Delegate,this._descriptorChanged=new a.Delegate,this._formatter=new n.PriceFormatter(100),(0,y.isStudyDescriptor)(t)?this._descriptor=t:this._origState=t,this._title=i,this._alwaysShowInLegend=s;this._properties=new u.Property({visible:!0}),this._statusView=new o.StudyStatusView(this)}barColorer(){return null}properties(){return this._properties}statusView(){return this._statusView}legendView(){return null}state(e){return this._origState}getDescriptor(){return null===this._descriptor?null:{descriptor:this._descriptor,title:this._title,isOverlay:Boolean(this._alwaysShowInLegend),id:this.id(),status:this._status}}updateDescriptor(e){(0,s.default)(this._descriptor,e)||(this._descriptor=e,this._descriptorChanged.fire())}onDescriptorChanged(){return this._descriptorChanged}setStatus(e){const t=this.isDisplayedInLegend();if(this._status=e,this._statusChanged.fire(),
this.isDisplayedInLegend()!==t){const e=this._model.paneForSource(this);if(e){const t=this._model.panes().indexOf(e),i=r.InvalidationMask.invalidateLegendWidgetLayout(t);this.model().invalidate(i)}}}formatter(){return this._formatter}name(){return this._title}title(){return this._title}titleInParts(){return[this._title]}isFailed(){return this._status.type===_.StudyStatusType.Error}isLoading(){return this._status.type===_.StudyStatusType.Loading}isDisplayedInLegend(){return this._alwaysShowInLegend||this.isFailed()}setFailed(e){this.setStatus({type:_.StudyStatusType.Error,errorDescription:{error:e}}),this._model.updateSource(this)}isSymbolInvalid(){return!1}isActualInterval(){return!0}onIsActualIntervalChange(){return m}start(){}status(){return this._status}onStatusChanged(){return this._statusChanged}firstValue(){return null}currency(){return null}sessionId(){return this._model.mainSeries().sessionId()}sessionIdChanged(){return this._model.mainSeries().sessionIdChanged()}unit(){return null}symbolSource(){return this._model.mainSeries()}barsProvider(){return this._model.mainSeries()}valuesProvider(){return new v}statusProvider(e){return new c(this)}isRemovedByStudyTemplates(){return null!==this._origState&&(0,p.isStudyState)(this._origState)}async pineSourceCodeModel(){return null!==this._descriptor&&"pine"===this._descriptor.type?Promise.all([i.e(86644),i.e(76792),i.e(40032),i.e(89199)]).then(i.bind(i,356146)).then((({PineSourceCodeModel:e})=>new e(this))):Promise.resolve(null)}}},556983:(e,t,i)=>{"use strict";i.r(t),i.d(t,{TpoPeriodicStudy:()=>u,createTpoPeriodicStudy:()=>h});var s=i(650151),r=i(339315),o=i(444331),l=i(752928),n=i(347710),a=i(856676);class u extends a.TpoStudyBase{splitMergeSupported(){return!0}_splitsAndMergesActionsKey(){const e=this._model.mainSeries(),t=e.proSymbol(),i=this.properties().childs().inputs.childs();return`${t};${this._chartStyleMode||(0,o.isTimeBasedStyle)(e.style())?"common":e.style()};${i.blockSize.value()};${i.periodsNum.value()};${i.period.value()}`}_splitsAndMergesInputsDeps(){return["blockSize","periodsNum","period"]}}async function h(e,t){const i=(0,s.ensureDefined)(r.SYMBOL_STRING_DATA[18]),o=await(0,n.studyMetaInfoRepository)().findById({type:"java",studyId:i.type}),a=(0,l.prepareStudyProperties)(o,{},null,(0,n.studyMetaInfoRepository)().studyVersioning(),[]);return new u(e,a,[],o,!0,t)}},856676:(e,t,i)=>{"use strict";i.d(t,{TpoStudyBase:()=>p,extendingInputIds:()=>c});var s=i(650151),r=i(444372),o=i(809796),l=i(142257),n=i(752928),a=i(354950),u=i(339315),h=i(66732),d=i(832696);const c=["extendPoorLow","extendPoorHigh","extendPOC","extendSingleprints"];class _ extends l.UndoCommand{constructor(e,t,s){super(new o.TranslatedString("TPO Reset all splits and merges",r.t(null,void 0,i(543775)))),this._model=e,this._id=t,this._splitsAndMerges=s}redo(){this._study().setSplitsAndMerges({})}undo(){this._study().setSplitsAndMerges(this._splitsAndMerges)}_study(){return(0,s.ensureNotNull)(this._model.dataSourceForId(this._id))}}class p extends n.Study{constructor(e,t,i,s,r,o=_){
c.forEach((e=>t.removeExcludedKey(`inputs.${e}`,1))),super(e,t,i,s),this._autoTickPerRowData=null,this._splitsAndMerges={},this._onSeriesCompletedChanged=e=>{e&&(this._seriesCompleted.unsubscribe(this._onSeriesCompletedChanged),this._tryCalculateTickPerRow())},this._seriesCompleted=(0,h.combine)((e=>u.seriesReadyStatuses.has(e.seriesStatus)),e.mainSeries().compositeStatusVW().weakReference()),this._chartStyleMode=!!r,this._resetAllSplitsUndoCommandCtor=o,t.childs().styles.hasChild("splitByBlocks")||t.childs().styles.addChild("splitByBlocks",new a.Property(!1));const l="graphics.tpoLevels.tpo";t.setThemedColors([{path:`${l}.tpoPoc.color`,colors:d.tpoThemedColors.poc},{path:`${l}.tpoPoorHigh.color`,colors:d.tpoThemedColors.poorHigh},{path:`${l}.tpoPoorLow.color`,colors:d.tpoThemedColors.poorLow},{path:`${l}.tpoSingleprints.color`,colors:d.tpoThemedColors.singleprints},{path:`${l}.tpoVah.color`,colors:d.tpoThemedColors.vah},{path:`${l}.tpoVal.color`,colors:d.tpoThemedColors.val}]);const n=e.mainSeries(),p=()=>{this._autoTickPerRowData=null,this._tryCalculateTickPerRow()},y=()=>{const e=this.properties().childs().inputs.childs();"Auto"===e.rowSize.value()&&e.ticksPerRow.setValue(NaN),this._autoTickPerRowData=null,this._seriesCompleted.unsubscribe(this._onSeriesCompletedChanged),this._seriesCompleted.subscribe(this._onSeriesCompletedChanged,{once:!0})};this.properties().childs().inputs.childs().rowSize.subscribe(this,p),this.properties().onRestoreFactoryDefaults().subscribe(this,p),n.symbolResolved().subscribe(this,y),n.onIntervalChanged().subscribe(this,y),this._tryCalculateTickPerRow();const v=this._properties.childs().inputs.childs();if(this._properties.addExcludedKey("inputs.mergePoints",1),this.splitMergeSupported()){n.symbolResolved().subscribe(this,this._applySplitAndMerges),n.properties().childs().symbol.subscribe(this,this._applySplitAndMerges);const e=v.mergePoints;this._splitsAndMerges[this._splitsAndMergesActionsKey()]=e.value(),this._splitsAndMergesInputsDeps().forEach((e=>{var t;null===(t=v[e])||void 0===t||t.subscribe(this,this._applySplitAndMerges)})),e.subscribe(this,(()=>{const t=this._splitsAndMergesActionsKey(),i=e.value();"[]"===i?delete this._splitsAndMerges[t]:this._splitsAndMerges[t]=i}))}}destroy(){const e=this._model.mainSeries();this._seriesCompleted.unsubscribe(this._onSeriesCompletedChanged),this._seriesCompleted.destroy(),e.symbolResolved().unsubscribeAll(this),e.properties().childs().symbol.unsubscribeAll(this),e.onIntervalChanged().unsubscribeAll(this),this._properties.destroy(),super.destroy()}preferredZOrder(){return 0}stateCustomFields(){var e;return{autoTickPerRowData:null!==(e=this._autoTickPerRowData)&&void 0!==e?e:void 0,splitsAndMerges:this._splitsAndMerges}}restoreStateCustomFields(e){var t,i;this._autoTickPerRowData=null!==(t=e.autoTickPerRowData)&&void 0!==t?t:null,this.splitMergeSupported()&&(this._splitsAndMerges=null!==(i=e.splitsAndMerges)&&void 0!==i?i:{},this._applySplitAndMerges())}resetAllSplitsAndMerges(){
const e=this._model.undoModel(),t=new this._resetAllSplitsUndoCommandCtor(this._model,this.id(),{...this._splitsAndMerges});e.undoHistory().pushUndoCommand(t)}setSplitsAndMerges(e){this._splitsAndMerges=e,this._applySplitAndMerges()}splitBlock(e){this._appendMergeSplitAction(e,"split",new o.TranslatedString("TPO split block",r.t(null,void 0,i(134234))))}mergeProfile(e){this._appendMergeSplitAction(e,"merge",new o.TranslatedString("TPO merge block",r.t(null,void 0,i(205340))))}paneViews(e){return this._chartStyleMode?this._paneViews:super.paneViews(e)}priceScale(){return this._chartStyleMode?this._model.mainSeries().priceScale():super.priceScale()}_splitsAndMergesActionsKey(){return""}_splitsAndMergesInputsDeps(){return[]}_apiInputs(){const{rowSize:e,...t}=super._apiInputs();return t}_allInputsAreValid(){const e=this.properties().childs().inputs.childs().ticksPerRow.value();return!isNaN(e)&&super._allInputsAreValid()}_autoRowSizeModeEnabled(){return"Auto"===this.properties().childs().inputs.childs().rowSize.value()}_tryCalculateTickPerRow(){if(this._autoRowSizeModeEnabled()&&(e=this._autoTickPerRowData,t=this._currentAutoTickPerRowData(),null===e||e.symbol!==t.symbol||e.interval!==t.interval)){this._calculateTickPerRow()?this._autoTickPerRowData=this._currentAutoTickPerRowData():(this._seriesCompleted.unsubscribe(this._onSeriesCompletedChanged),this._seriesCompleted.subscribe(this._onSeriesCompletedChanged,{once:!0}))}var e,t}_calculateTickPerRow(){const e=this._model.mainSeries(),t=e.symbolInfo(),i=e.data().bars();if(!i.size()||!t)return!1;const r=this._model.timeScale().visibleBarsStrictRange();if(null===r)return!1;const o=i.rangeCountback(r.lastBar(),300),l=o.minMaxOnRangeCached((0,s.ensureNotNull)(o.firstIndex()),(0,s.ensureNotNull)(o.lastIndex()),[{name:"low",offset:0},{name:"high",offset:0}]);if(null===l)return!1;const n=t.minmov/t.pricescale,a=(l.max-l.min)/n,u=Math.round(a/80),h=Math.floor(Math.log10(u)),d=5*Math.max(1,Math.pow(10,h-1)),c=Math.round(u/d)*d,_=Math.min(1e6,Math.max(1,c));return this.properties().childs().inputs.childs().ticksPerRow.setValue(_),!0}_currentAutoTickPerRowData(){const e=this._model.mainSeries();return{symbol:e.getSymbolString(),interval:e.interval()}}_appendMergeSplitAction(e,t,i){const s=this._properties.childs().inputs.childs().mergePoints.value(),r=""===s?[]:JSON.parse(s);r.push({action:t,time:e}),this._model.undoModel().setProperty(this._properties.childs().inputs.childs().mergePoints,JSON.stringify(r),i)}_applySplitAndMerges(){var e;const t=null!==(e=this._splitsAndMerges[this._splitsAndMergesActionsKey()])&&void 0!==e?e:"[]";this._properties.childs().inputs.childs().mergePoints.setValue(t)}}},832696:(e,t,i)=>{"use strict";i.d(t,{tpoThemedColors:()=>d});var s=i(790188),r=i(246733);const o=(0,s.getHexColorByName)("color-cold-gray-900"),l=(0,s.getHexColorByName)("color-cold-gray-200"),n=(0,s.getHexColorByName)("color-deep-blue-a700"),a=(0,s.getHexColorByName)("color-deep-blue-a200"),u=(0,s.getHexColorByName)("color-grapes-purple-a200"),h=(0,r.generateColor)(u,85),d={poc:[o,l],
poorHigh:[n,a],poorLow:[n,a],singleprints:[h,h],vah:[o,l],val:[o,l]}},205838:(e,t,i)=>{"use strict";i.r(t),i.d(t,{VolumeFootprintStudy:()=>n,createVolumeFootprintStudy:()=>a});var s=i(650151),r=i(752928),o=i(347710),l=i(339315);class n extends r.Study{constructor(){super(...arguments),this._rowSize=.1}rowSize(){return this._rowSize}hasStateForAlert(){return!1}paneViews(){return this._paneViews}priceScale(){return this._model.mainSeries().priceScale()}firstValue(){return this._model.mainSeries().firstValue()}stateCustomFields(){return{rowSize:this._rowSize}}restoreStateCustomFields(e){var t;this._rowSize=null!==(t=e.rowSize)&&void 0!==t?t:this._rowSize}_onDataUpdated(e,t,i,s){var r;super._onDataUpdated(e,t,i,s),(null==t?void 0:t.indexes_replace)||(this._rowSize=null!==(r=(null==t?void 0:t.data).rowSize)&&void 0!==r?r:this._rowSize)}}async function a(e){const t=(0,s.ensureDefined)(l.SYMBOL_STRING_DATA[17]),i=await(0,o.studyMetaInfoRepository)().findById({type:"java",studyId:t.type}),a=(0,r.prepareStudyProperties)(i,{},null,(0,o.studyMetaInfoRepository)().studyVersioning(),[]);return new n(e,a,[],i)}},943855:(e,t,i)=>{"use strict";i.d(t,{StudyCompare:()=>W});var s=i(650151),r=i(580683),o=i(261066),l=i(752928),n=i(444331),a=i(354950),u=i(919892),h=i(244842),d=i(909598),c=i(229765),_=i(740086),p=i(246733);const y=h.enabled("force_exchange_as_title");class v extends c.PriceAxisView{constructor(e,t){super(),this._studyCompare=e,this._data=t}_updateRendererData(e,t,i){e.visible=!1,t.visible=!1;const r=this._studyCompare.priceScale(),o=this._studyCompare.lastValueData(this._data.plotIndex,!1);if(o.noData||null===r||r.isEmpty())return;const l=this._studyCompare.model(),n=l.timeScale().visibleBarsStrictRange(),a=l.mainSeries().bars().lastIndex();if(null===n||null===a)return;if(a<=n.lastBar())i.background=(0,p.resetTransparency)(o.color),i.textColor=this.generateTextColor(i.background),i.borderColor=void 0,e.borderVisible=!1,t.borderVisible=!1;else{const r=l.backgroundColorAtYPercentFromTop(o.coordinate/(0,s.ensureNotNull)(l.paneForSource(this._studyCompare)).height());i.background=r,i.textColor=(0,p.resetTransparency)(o.color),i.borderColor=i.textColor,e.borderVisible=!0,t.borderVisible=!0}i.coordinate=o.coordinate,i.floatCoordinate=o.floatCoordinate;const u=l.properties().childs().scalesProperties.childs();u.showSeriesLastValue.value()&&(e.text=(0,_.getCurrentModePriceText)(r,o),u.seriesLastValueMode.value()!==d.PriceAxisLastValueMode.LastPriceAndPercentageValue?e.secondLine="":e.secondLine=(0,_.getOppositeModePriceText)(r,o),e.visible=!0),t.text="",u.showSymbolLabels.value()&&(t.text=this._paneText(),t.visible=t.text.length>0)}_paneText(){let e="";const t=this._studyCompare.symbolInfo();return y?e=(0,n.displayedSymbolExchange)(t):this._studyCompare.model().properties().childs().scalesProperties.childs().showSymbolLabels.value()&&(e=(0,n.displayedSymbolName)(t)),e}}var m=i(444372),S=i(544820),b=i(103055),g=i(885482),f=i(638456),C=i(616117),w=i(389137),x=i(982217);const P=f.CheckMobile.any()
;class I extends b.StudyValuesProvider{constructor(e,t){super(e,t),this._emptyValues[0].title=e.guiPlotName(x.TitleDisplayTarget.StatusLine,"")}getValues(e){return(0,w.isNumber)(e)||(this._showLastPriceAndChangeOnly()?e=this._study.data().lastIndex():(e=this._model.crossHairSource().appliedIndex(),(0,w.isNumber)(e)||(e=this._study.data().lastIndex()))),super.getValues(e)}_hideValues(){return!1}_showLastPriceAndChangeOnly(){return P&&(null===this._model.crossHairSource().pane||(0,C.isLineToolName)(g.tool.value())||null!==this._model.lineBeingEdited())}}class T extends S.StudyDataWindowView{constructor(e,t){super(e,t),this._studyCompare=e}_hideValues(){return!1}_createValuesProvider(e,t){return new I(e,t)}}var D=i(177126);class R extends T{constructor(e,t){super(e,t),this._additional=null,this._showSeriesOHLC=t.properties().childs().paneProperties.childs().legendProperties.childs().showSeriesOHLC,this._showSeriesOHLC.subscribe(this,this.update)}areValuesVisible(){return this._showSeriesOHLC.value()}destroy(){this._showSeriesOHLC.unsubscribeAll(this)}additional(){return this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._additional}_updateImpl(){{const e=(0,D.getDataVendorString)(this._studyCompare.symbolInfo());this._additional=e?m.t(null,void 0,i(493345))+" "+e:null}super._updateImpl()}}var L=i(555502),k=i(551775),V=i(509550);class M extends V.StudyStatusProvider{getSplitTitle(){return this._source.titleInParts(x.TitleDisplayTarget.StatusLine,!0,void 0,!1,!1)}text(){return this._source.isActualInterval()?this._source.isFailed()?`${this._source.title(x.TitleDisplayTarget.StatusLine,!0,void 0,!1,!1)}: ${this.sourceStatusText()}`:`${this._source.title(x.TitleDisplayTarget.StatusLine,!0,void 0,!1,!1)} ${this.sourceStatusText()}`:this._source.title(x.TitleDisplayTarget.StatusLine,!0,void 0,!1,!1)}}var A=i(502141),B=i(25e4),N=i(401580);const E=h.enabled("study_overlay_compare_legend_option"),F=h.enabled("force_exchange_as_title"),H=!h.enabled("hide_study_compare_legend_item"),O=h.enabled("hide_unresolved_symbols_in_legend");class W extends l.Study{constructor(e,t,i,s){super(e,function(e){return e.hasChild("currencyId")||e.addChild("currencyId",new a.Property(null)),e.hasChild("unitId")||e.addChild("unitId",new a.Property(null)),e.addExcludedKey("currencyId",1),e.addExcludedKey("unitId",1),e}(t),i,s),this._isActingAsSymbolSource=new N.WatchedValue(!0),this._realignToolsLastParams=null,this._lastResolvedSymbolSource="",this.properties().childs().minTick.subscribe(null,(()=>this._recreatePriceFormattingDependencies())),this.properties().childs().minTick.subscribe(null,(()=>this._model.fullUpdate())),this.properties().childs().currencyId.subscribe(this,this._onCurrencyChanged),this.properties().childs().unitId.subscribe(this,this._onUnitChanged),this._symbolResolvingActive=new N.WatchedValue(!1),this._symbolHibernated=new N.WatchedValue(!1),e.mainSeries().onIntervalChanged().subscribe(this,(()=>e.realignLineTools(this)))}destroy(){this._model.mainSeries().onIntervalChanged().unsubscribeAll(this),super.destroy()}
properties(){return this._properties}isActingAsSymbolSource(){return this._isActingAsSymbolSource.readonly()}symbolParams(){return(0,A.symbolParams)(this)}compareSymbolParams(e){return(0,A.compareSymbolParams)(this,e,this._model.unitConversionEnabled())}setSymbolParams(e){this._setSymbolCurrencyUnitInternal(e)}symbol(){return this.properties().childs().inputs.childs().symbol.value()}symbolChanged(){return this.properties().childs().inputs.childs().symbol.listeners()}setSymbol(e){this.setSymbolParams({symbol:e})}symbolInfo(){if(!this._resolvedSymbols)return null;const e=this.symbol();if(!e)return null;let t;return t=this._model.isSnapshot()?this._resolvedSymbols.___snapshot||null:this._resolvedSymbols[this._getSymbolForResolve(e)]||null,this._model.isSnapshot()&&null===t&&(t=(0,r.getObsoleteIdeaSymbolInfo)(this._resolvedSymbols,e,this.currency()),null!==t&&(this._resolvedSymbols.___snapshot=t)),t}symbolResolved(){return this.symbolsResolved()}symbolResolvingActive(){return this._symbolResolvingActive}symbolHibernated(){return this._symbolHibernated}isVisible(){const e=super.isVisible();return this._symbolHibernated.setValue(!e),e}symbolSameAsCurrent(e){return(0,A.symbolSameAsCurrent)(e,this.symbolInfo())}symbolSameAsResolved(e){return(0,B.symbolSameAsResolved)(e,this._lastResolvedSymbolSource,this.symbol())}currency(){return this.properties().childs().currencyId.value()||null}setCurrency(e){this.setSymbolParams({currency:e})}isConvertedToOtherCurrency(){return(0,n.isConvertedToOtherCurrency)(this.symbolInfo())}unit(){return this.properties().childs().unitId.value()||null}setUnit(e){this.setSymbolParams({unit:e})}isConvertedToOtherUnit(){return(0,n.isConvertedToOtherUnit)(this.symbolInfo(),this._model.unitConversionEnabled())}style(){return 2}setStyle(e){}interval(){return this._model.mainSeries().interval()}setInterval(e){}symbolSource(){return this}valueAt(e,t){var i,s;return null!==(s=null===(i=this.data().search(e))||void 0===i?void 0:i.value[1])&&void 0!==s?s:null}state(e,t){var i;const r=super.state(e,t);this._model.unitConversionEnabled()||delete r.state.unitId;const o=this.symbol();return r.state.inputs.symbol=(0,n.symbolToSaveInState)(null!==(i=this.symbolInfo())&&void 0!==i?i:this._model.chartApi().lastSymbolResolveInfo(o),o),e&&((0,s.ensureDefined)(r.data).symbols={___snapshot:this.symbolInfo()||void 0}),r}symbolTitle(e,t,i){return this.title(e,!0,{},!1,t)}titleInParts(e,t,i,s,r){var o;const l=this._titleInParts(e,t,i,s,r);return[[l[0],...null!==(o=l[1])&&void 0!==o?o:[]].join(", ")]}tags(){const e=this.symbol();return e?[e]:[]}statusView(){return H?super.statusView():null}guiPlotName(e,t){return this.properties().childs().inputs.childs().symbol.value()}canOverrideMinTick(){return!0}canBeHiddenByGlobalFlag(){return!1}valuesProvider(){return new I(this,this.model())}statusProvider(e){return new M(this)}measureUnitId(){return(0,n.measureUnitId)(this.symbolInfo())}getSymbolString(e){return void 0===e&&(e=this._getSymbolForApi(this.symbol())),(0,
u.encodeExtendedSymbolOrGetSimpleSymbolString)(this._getSymbolObject(e))}_createPriceAxisView(e){return new v(this,{plotIndex:"compare"})}_createViews(){this._legendView||(this._legendView=new R(this,this._model)),this._dataWindowView||(this._dataWindowView=new T(this,this._model)),this._statusView||(this._statusView=new L.StudyStatusView(this)),super._createViews()}_onUnitChanged(){"alwaysOff"!==(0,o.currencyUnitVisibilityProperty)().value()&&this._model.fullUpdate(),this._model.unitConversionEnabled()&&this.isStarted()&&this._tryChangeInputs(),this._unitChanged.fire()}_getSymbolObject(e){const t=super._getSymbolObject(e),i=this.currency();null!==i&&(t["currency-id"]=i);const s=this.unit();return this._model.unitConversionEnabled()&&null!==s&&(t["unit-id"]=s),t}_onSymbolResolvingStart(e,t){this._lastResolvedSymbolSource=t,super._onSymbolResolvingStart(e,t),this._symbolResolvingActive.setValue(!0)}_onSymbolError(){super._onSymbolError(),this._symbolResolvingActive.setValue(!1)}_onSymbolResolved(e,t,i){super._onSymbolResolved(e,t,i),this._recreatePriceFormattingDependencies();const s=t===this.symbol()?(0,n.extractSymbolNameFromSymbolInfo)(i,this.symbol()):null,r=(0,n.symbolCurrency)(i),o=(0,n.symbolUnit)(i,this._model.unitConversionEnabled());this._setSymbolCurrencyUnitInternal({symbol:null!=s?s:void 0,currency:r,unit:o},i),this._symbolResolvingActive.setValue(!1)}async _changeInputsImpl(e,t){await super._changeInputsImpl(e,t),this._realignLineToolsIfParamsChanged()}_createStudyOnServer(){const e=super._createStudyOnServer();return this._realignLineToolsIfParamsChanged(),e}_tryCreateFormatter(){var e,t;t=null===(e=null===k.customFormatters||void 0===k.customFormatters?void 0:k.customFormatters.priceFormatterFactory)||void 0===e?void 0:e.call(k.customFormatters,this.symbolInfo(),this.properties().childs().minTick.value());return(0,n.createSeriesFormatter)(this.symbolInfo(),this.properties().childs().minTick.value())}_tryCreateDefaultFormatter(){return(0,n.createSeriesFormatter)(this.symbolInfo(),"default")}_titleInParts(e,t,i,s,r){const o=this.symbolInfo();return[this._getSymbolTitlePart(o),[this._getExchangeTitlePart(o,r),this._getPriceSourceTitlePart(o)].filter((e=>null!==e))]}_skipHistogramBaseOnAutoScale(){return!0}_getSymbolTitlePart(e){var t;if(null===e)return O?"":this.properties().childs().inputs.childs().symbol.value();const i=(0,n.getSymbolExchange)(e);if(F&&void 0!==i)return i;if(E)switch(this._model.mainSeries().symbolTextSourceProxyProperty().value()){case"description":return e.description;case"ticker-and-description":return`${e.name}, ${e.description}`;case"long-description":return null!==(t=e.long_description)&&void 0!==t?t:e.description}return e.name}_getExchangeTitlePart(e,t){return null===e||t?null:(0,n.getSymbolExchange)(e)}_getPriceSourceTitlePart(e){return null}_setSymbolCurrencyUnitInternal(e,t){const{symbol:i,currency:s,unit:r}=e,o=this.properties().childs(),l=o.inputs.childs().symbol.value(),a=o.currencyId.value(),u=o.unitId.value();if(void 0!==i&&o.inputs.childs().symbol.setValueSilently(i),
void 0!==s&&o.currencyId.setValueSilently(s),void 0!==r&&o.unitId.setValueSilently(r),t)this._resolvedSymbolsByInput[this.symbol()]=t,this._resolvedSymbols[this._getSymbolForResolve(this.symbol())]=t,this._realignToolsLastParams=null;else{const e=this.symbolInfo();null!==e&&(o.currencyId.setValueSilently((0,n.symbolCurrency)(e)),o.unitId.setValueSilently((0,n.symbolUnit)(e,this._model.unitConversionEnabled())))}o.inputs.childs().symbol.value()!==l&&o.inputs.childs().symbol.listeners().fire(o.inputs.childs().symbol,""),o.currencyId.value()!==a&&o.currencyId.listeners().fire(o.currencyId,""),o.unitId.value()!==u&&o.unitId.listeners().fire(o.unitId,""),this._realignLineToolsIfParamsChanged()}_realignLineToolsIfParamsChanged(){let e=null===this._realignToolsLastParams;if(null!==this._realignToolsLastParams){const t=this.compareSymbolParams(this._realignToolsLastParams);e=t.symbolChanged||t.intervalChanged||t.currencyChanged||t.unitChanged}e&&(this._model.realignLineTools(this),this._realignToolsLastParams=this.symbolParams())}}},328484:(e,t,i)=>{"use strict";i.d(t,{StudyOverlayBase:()=>De});var s=i(650151),r=i(580683),o=i(638456),l=i(201089),n=i(752928),a=i(548587),u=i(261066),h=i(544421),d=i(444331),c=i(354950),_=i(919892),p=i(244842),y=i(356747),v=i(502141),m=i(25e4),S=i(276871),b=i(195447),g=i(534741),f=i(389137),C=i(291784),w=i(401580),x=i(551775),P=i(555502),I=i(147664),T=i(229765),D=i(909598),R=i(740086),L=i(246733);const k=p.enabled("force_exchange_as_title");class V extends T.PriceAxisView{constructor(e){super(),this._source=e}_updateRendererData(e,t,i){e.visible=!1,t.visible=!1;const r=this._source.lastValueData("close",!1);if(r.noData)return;const o=this._source.model(),l=this._source.priceScale();if(null===l)return;if(!o.isPriceScaleVisible(l))return;const n=o.timeScale().visibleBarsStrictRange(),a=o.mainSeries().bars().lastIndex();if(null===n||null===a)return;if(a<=n.lastBar())i.background=(0,L.resetTransparency)(r.color),i.textColor=this.generateTextColor(r.color),e.borderVisible=!1,t.borderVisible=!1;else{const l=o.backgroundColorAtYPercentFromTop(r.coordinate/(0,s.ensureNotNull)(o.paneForSource(this._source)).height());i.background=l,i.textColor=(0,L.resetTransparency)(r.color),i.borderColor=i.textColor,e.borderVisible=!0,t.borderVisible=!0}i.coordinate=r.coordinate,i.floatCoordinate=r.floatCoordinate;const u=this._source.model().properties().childs().scalesProperties.childs();u.showSeriesLastValue.value()&&(e.text=(0,R.getCurrentModePriceText)(l,r),u.seriesLastValueMode.value()!==D.PriceAxisLastValueMode.LastPriceAndPercentageValue?e.secondLine="":e.secondLine=(0,R.getOppositeModePriceText)(l,r),e.visible=!0),t.text="",u.showSymbolLabels.value()&&(t.text=this._paneText(),t.visible=t.text.length>0)}_paneText(){let e="";const t=this._source.symbolInfo();return k?e=(0,d.displayedSymbolExchange)(t):this._source.model().properties().childs().scalesProperties.childs().showSymbolLabels.value()&&(e=(0,d.displayedSymbolName)(t)),e}}var M=i(506387);class A extends M.PriceLineAxisView{constructor(e){super(),
this._study=e}_value(){return this._study.lastValueData("",!0)}_priceLineColor(e){return e}_lineWidth(){return 1}_isVisible(){const e=this._study.model().properties().childs().scalesProperties.childs().showSeriesLastValue.value();return this._study.properties().childs().showPriceLine.value()&&e}}var B=i(458963),N=i(9524);class E{constructor(e){this._lineRenderer=new N.HorizontalLineRenderer,this._visible=!1,this._source=e}update(){if(this._visible=!1,!this._source.properties().childs().showPriceLine.value())return;const e=this._source.lastValueData("",!0);e.noData||(this._visible=!0,this._lineRenderer.setData({y:e.coordinate,color:e.color,linewidth:1,linestyle:B.LINESTYLE_DOTTED,visible:this._visible}))}renderer(){return this._visible?this._lineRenderer:null}}var F=i(782086),H=i(616117),O=i(885482),W=i(982217),q=i(150335),z=i(444372),U=i(31341),G=i(541346),Y=i(748844),$=i(334652),Q=i(711757),j=i(570226),X=i(60897);const Z=$.lastDayChangeAvailable||$.alwaysShowLastPriceAndLastDayChange,K=o.CheckMobile.any(),J=new G.PercentageFormatter,ee=X.notAvailable,te=`${ee} (${ee}%)`;class ie{constructor(e,t){this._study=e,this._model=t,this._emptyValues=[{title:z.t(null,void 0,i(539280)),visible:!1,value:"",index:0,id:""},{title:z.t(null,void 0,i(330777)),visible:!1,value:"",index:1,id:""},{title:z.t(null,void 0,i(608136)),visible:!1,value:"",index:2,id:""},{title:z.t(null,void 0,i(931691)),visible:!1,value:"",index:3,id:""},{title:"",visible:!1,value:"",index:4,id:""},{title:"",visible:!1,value:"",index:5,id:""},{title:z.t(null,void 0,i(349329)),visible:!1,value:"",index:6,id:""},{title:z.t(null,void 0,i(37611)),visible:!1,value:"",index:7,id:""}]}getItems(){return this._emptyValues}getValues(e){var t,i,s,r,o,l;const n=this._emptyValues.map((e=>({...e})));if(this._model.timeScale().isEmpty())return n;const a=this._study.data(),u=a.lastIndex();if(0===a.size()||null===u)return n;const h=a.search(u,g.PlotRowSearchMode.NearestLeft,1);if(null===h)return n;const d=this._showLastPriceAndChangeOnly();if((0,q.isNumber)(e)||(d?e=u:(e=this._model.crossHairSource().appliedIndex(),(0,q.isNumber)(e)||(e=u))),null===e||!(0,q.isNumber)(e))return n;const c=a.search(e,g.PlotRowSearchMode.NearestLeft,1),_=this._model.backgroundTopColor().value();if(null===c)return n;const p=c.index,y=c.value,v=y[1],m=y[2],S=y[3],b=y[4];n[0].value=ee,n[1].value=ee,n[2].value=ee,n[3].value=ee,n[7].value=te,n[6].value=te;for(const e of n)e.visible=!d;const f=n[4];f.visible=!1;const{barChange:C,lastDayChange:w}=(0,Y.changesData)(a,this._study.quotes(),c.value,c.index,h.value),x=(0,j.getPriceValueFormatterForSource)(this._study);if((0,j.shouldBeFormattedAsPercent)(this._study)||(0,j.shouldBeFormattedAsIndexedTo100)(this._study))n[7].value="",n[6].value="";else{const e=this._study.formatter();if(void 0!==C){const{currentPrice:s,prevPrice:r,change:o}=C,l=null!==(i=null===(t=e.formatChange)||void 0===t?void 0:t.call(e,s,r,!0))&&void 0!==i?i:e.format(o,!0);n[6].value=(0,U.forceLTRStr)(`${l} (${J.format(C.percentChange,!0)})`)}if(void 0!==w){
const{currentPrice:t,prevPrice:i,change:o,percentChange:l}=w,a=null!==(r=null===(s=e.formatChange)||void 0===s?void 0:s.call(e,t,i,!0))&&void 0!==r?r:e.format(o,!0);n[7].value=(0,U.forceLTRStr)(`${a} (${J.format(l,!0)})`)}}let P=null;if(d)n[5].value=null==b?ee:x(b),n[5].visible=!0,P=this._getChangeColor(null==w?void 0:w.change),n[6].visible=void 0!==C,n[7].visible=void 0!==w||Z;else{n[0].value=null==v?ee:x(v),n[1].value=null==m?ee:x(m),n[2].value=null==S?ee:x(S),n[3].value=null==b?ee:x(b),f.value=x(this._study.barFunction()(y)),n[5].visible=!1;const e=this._model.mainSeries().intervalObj().is1Tick();n[0].visible=!e,n[1].visible=!e,n[2].visible=!e,n[7].visible=void 0!==w||Z,n[6].visible=void 0!==C;const t=this._study.barColorer().barStyle(p,!1),i=null!==(o=t.barBorderColor)&&void 0!==o?o:t.barColor;P=(0,Y.calculateColor)(_,i)}P=(0,L.resetTransparency)((0,Y.calculateColor)(_,P));for(const e of n)e.color||(e.color=P);return n[7].visible&&(n[7].color=(0,L.resetTransparency)((0,Y.calculateColor)(_,this._getChangeColor(null===(l=w)||void 0===l?void 0:l.change)))),n}_mobileNonTrackingMode(){return K&&(null===this._model.crossHairSource().pane||(0,H.isLineToolName)(O.tool.value())||null!==this._model.lineBeingEdited())}_showLastPriceAndChangeOnly(){return $.alwaysShowLastPriceAndLastDayChange||this._mobileNonTrackingMode()}_getChangeColor(e){var t;const i=void 0===e||e>=0?Q.SeriesBarColorer.upColor(this._study.properties()):Q.SeriesBarColorer.downColor(this._study.properties());return null!==(t=i.barBorderColor)&&void 0!==t?t:i.barColor}}const se=o.CheckMobile.any();class re extends F.DataWindowView{constructor(e,t){super(),this._invalidated=!0,this._study=e,this._model=t,this._valueProvider=this._createValuesProvider(e,t),this._items=this._valueProvider.getItems().map((e=>new F.DataWindowItem(e.id,e.title,""))),this.update()}items(){return this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._items}update(){this._invalidated=!0}study(){return this._study}_updateImpl(){var e,t;this._header=this._study.title(W.TitleDisplayTarget.DataWindow);let i;this._showLastPriceAndChangeOnly()?i=this._study.data().lastIndex():(i=this._model.crossHairSource().appliedIndex(),isNaN(i)&&(i=this._study.data().lastIndex(),p.enabled("use_last_visible_bar_value_in_legend")&&(i=null!==(t=null===(e=this._model.timeScale().visibleBarsStrictRange())||void 0===e?void 0:e.lastBar())&&void 0!==t?t:NaN)));const s=this._valueProvider.getValues(i);for(let e=0;e<s.length;++e){const t=s[e],i=this._items[e];i.setValue(t.value),i.setVisible(t.visible),i.setColor(t.color)}}_showLastPriceAndChangeOnly(){return se&&(null===this._model.crossHairSource().pane||(0,H.isLineToolName)(O.tool.value())||null!==this._model.lineBeingEdited())}_createValuesProvider(e,t){return new ie(e,t)}}class oe extends ie{constructor(e,t){super(e,t);const i=t.properties().childs().paneProperties.childs().legendProperties.childs();this._showBarChange=i.showBarChange,this._showLastDayChange=i.showLastDayChange,this._showSeriesOHLC=i.showSeriesOHLC}getValues(e){var t,i,s
;const r=super.getValues(e),o=this._study.properties().childs(),l=o.style.value(),n=12!==l,a=this._showSeriesOHLC.value(),u=n&&this._showBarChange.value(),h=n&&this._showLastDayChange.value();if(this._showLastPriceAndChangeOnly())return(t=r[7]).visible&&(t.visible=u),r[6].visible=!1,r;const c=(0,d.isPriceSourceStyle)(l),_=12!==l&&16!==l,p=12!==l,y=this._model.mainSeries().intervalObj().is1Tick(),v=a&&!c,m=a&&c;if(r[0].visible=v&&_&&!y,r[1].visible=v&&!y,r[2].visible=v&&!y,r[3].visible=v&&p,(i=r[7]).visible&&(i.visible=h),(s=r[6]).visible&&(s.visible=u),r[4].visible=m,16===l){const e=o.hlcAreaStyle.childs();r[1].color=e.highLineColor.value(),r[2].color=e.lowLineColor.value(),r[3].color=e.closeLineColor.value()}return r}}var le=i(197050),ne=i(177126);class ae extends re{constructor(e,t){super(e,t),this._additional=null,this._studyOverlay=e,this._backgroundColorSpawn=t.backgroundTopColor().spawn(),this._backgroundColorSpawn.subscribe(this.update.bind(this));const i=t.properties().childs().paneProperties.childs().legendProperties.childs();this._visibilityProperty=(0,le.combineProperty)(((e,t)=>e||t),i.showBarChange.weakReference(),i.showSeriesOHLC.weakReference()),this._visibilityProperty.subscribe(this,this.update)}areValuesVisible(){return this._visibilityProperty.value()}additional(){return this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._additional}destroy(){this._backgroundColorSpawn.destroy(),this._visibilityProperty.destroy()}_updateImpl(){super._updateImpl();{const e=(0,ne.getDataVendorString)(this._studyOverlay.symbolInfo());this._additional=e?z.t(null,void 0,i(493345))+" "+e:null}}_createValuesProvider(e,t){return new oe(e,t)}}var ue=i(742391),he=i(825278),de=i(245242),ce=i(936258),_e=i(904891),pe=i(579950),ye=i(255799),ve=i(41117),me=i(72731),Se=i(262550),be=i(707621),ge=i(509550);class fe extends ge.StudyStatusProvider{getSplitTitle(){return this._source.titleInParts(W.TitleDisplayTarget.StatusLine,!0,void 0,!1,!1)}text(){return this._source.isActualInterval()?this._source.isFailed()?`${this._source.title(W.TitleDisplayTarget.StatusLine,!0,void 0,!1,!1)}: ${this.sourceStatusText()}`:`${this._source.title(W.TitleDisplayTarget.StatusLine,!0,void 0,!1,!1)} ${this.sourceStatusText()}`:this._source.title(W.TitleDisplayTarget.StatusLine,!0,void 0,!1,!1)}}const Ce=(o.CheckMobile.any(),!0),we=p.enabled("study_overlay_compare_legend_option"),xe=(p.enabled("secondary_series_extend_time_scale"),p.enabled("hide_unresolved_symbols_in_legend")),Pe=!p.enabled("hide_study_overlay_legend_item"),Ie=(0,l.getLogger)("Chart.StudyOverlay");function Te(e,t){return null==e[t]}class De extends n.Study{constructor(e,t,i,s){super(e,function(e){e.hasChild("currencyId")||e.addChild("currencyId",new c.Property(null)),e.hasChild("unitId")||e.addChild("unitId",new c.Property(null)),(0,be.allChartStyles)().includes(e.childs().style.value())||e.childs().style.setValueSilently(2);const t=e.childs();if(t.lineStyle.hasChild("styleType")){const e=t.lineStyle.childs(),i=e.styleType.value();let s,r;0===i&&(r=14,
s=t.lineWithMarkersStyle.childs()),1===i&&(r=15,s=t.steplineStyle.childs()),s&&(s.color.setValueSilently(e.color.value()),s.linestyle.setValueSilently(e.linestyle.value()),s.linewidth.setValueSilently(e.linewidth.value()),s.priceSource.setValueSilently(e.priceSource.value())),void 0!==r&&2===t.style.value()&&t.style.setValueSilently(r),t.lineStyle.removeProperty("styleType")}return e.addExcludedKey("currencyId",1),e.addExcludedKey("unitId",1),e}(t),i,s),this._seriesSource=null,this._symbolResolvingActive=new w.WatchedValue(!1),this._symbolHibernated=new w.WatchedValue(!1),this._styleToRecover=null,this._isActingAsSymbolSource=new w.WatchedValue(!0),this._realignToolsLastParams=null,this._precomputedBarStyles=new WeakMap,this._lastResolvedSymbolSource="",this._data=new b.PlotList((0,h.seriesPlotFunctionMap)(),Te),this._quotesProvider=new y.QuotesProvider(void 0,e.collapsed().spawnOwnership()),Ce&&this._quotesProvider.quotesUpdate().subscribe(this,this._onQuotesUpdate);const r=this.properties().childs();r.currencyId.subscribe(this,this._onCurrencyChanged),r.unitId.subscribe(this,this._onUnitChanged),r.allowExtendTimeScale.subscribe(this,this._onAllowExtendTimeScaleChanged),this._onAllowExtendTimeScaleChanged(),this._model.mainSeries().properties().childs().dividendsAdjustment.subscribe(this,(()=>{this._tryChangeInputs()})),r.style.subscribe(this,this._onChartStyleChanged),r.lineStyle.childs().priceSource.subscribe(this,this._updateBarFunction),r.lineWithMarkersStyle.childs().priceSource.subscribe(this,this._updateBarFunction),r.steplineStyle.childs().priceSource.subscribe(this,this._updateBarFunction),r.areaStyle.childs().priceSource.subscribe(this,this._updateBarFunction),r.baselineStyle.childs().priceSource.subscribe(this,this._updateBarFunction),r.columnStyle.childs().priceSource.subscribe(this,this._updateBarFunction),this._updateBarFunction(),r.minTick.subscribe(this,this._onMinTickChanged),this._formatter=null,this._defaultFormatter=null,e.mainSeries().onIntervalChanged().subscribe(this,(()=>e.realignLineTools(this)))}destroy(){this._model.mainSeries().properties().childs().dividendsAdjustment.unsubscribeAll(this),this._model.mainSeries().onIntervalChanged().unsubscribeAll(this),this._quotesProvider.destroy(),super.destroy()}isActingAsSymbolSource(){return this._isActingAsSymbolSource.readonly()}precomputedBarStyle(e){return this._precomputedBarStyles.get(e)}setPrecomputedBarStyle(e,t){this._precomputedBarStyles.set(e,t)}properties(){return this._properties}barColorer(){return new Q.SeriesBarColorer({data:()=>this.data(),bars:()=>this.data(),nsBars:()=>new b.PlotList,priceScale:()=>(0,s.ensureNotNull)(this.priceScale()),properties:()=>this.properties(),firstValue:()=>this.firstValue()})}symbolParams(){return(0,v.symbolParams)(this)}compareSymbolParams(e){return(0,v.compareSymbolParams)(this,e,this._model.unitConversionEnabled())}setSymbolParams(e){this._setSymbolParamsInternal(e)}symbol(){return this.properties().childs().inputs.childs().symbol.value()}symbolChanged(){
return this.properties().childs().inputs.childs().symbol.listeners()}setSymbol(e){this.setSymbolParams({symbol:e})}symbolInfo(){if(!this._resolvedSymbols)return null;const e=this._properties.childs().inputs.childs().symbol.value();if(!e)return null;let t;return t=this._model.isSnapshot()?this._resolvedSymbols.___snapshot||null:this._resolvedSymbols[this._getSymbolForResolve(e)]||null,this._model.isSnapshot()&&null===t&&(t=(0,r.getObsoleteIdeaSymbolInfo)(this._resolvedSymbols,e,this.currency()),null!==t&&(this._resolvedSymbols.___snapshot=t)),t}supportsPressedChunks(){return!1}pressedChunks(e,t){throw new Error("Pressed chunks are not supported")}data(){return null===this._seriesSource?super.data():this._seriesSource.data().bars()}symbolResolved(){return this.symbolsResolved()}symbolResolvingActive(){return this._symbolResolvingActive}symbolHibernated(){return this._symbolHibernated}isVisible(){const e=super.isVisible();return this._symbolHibernated.setValue(!e),e}symbolSameAsCurrent(e){return(0,v.symbolSameAsCurrent)(e,this.symbolInfo())}symbolSameAsResolved(e){return(0,m.symbolSameAsResolved)(e,this._lastResolvedSymbolSource,this.symbol())}priceSource(){const e=this.properties().childs();switch(e.style.value()){case 2:return e.lineStyle.childs().priceSource.value();case 14:return e.lineWithMarkersStyle.childs().priceSource.value();case 15:return e.steplineStyle.childs().priceSource.value();case 3:return e.areaStyle.childs().priceSource.value();case 10:return e.baselineStyle.childs().priceSource.value();case 13:return e.columnStyle.childs().priceSource.value()}return null}barFunction(){return this._barFunction}quotesProvider(){return this._quotesProvider}quotes(){return this._quotesProvider.quotes()}currency(){return this.properties().childs().currencyId.value()||null}setCurrency(e){this.setSymbolParams({currency:e})}isConvertedToOtherCurrency(){return(0,d.isConvertedToOtherCurrency)(this.symbolInfo())}unit(){return this.properties().childs().unitId.value()||null}setUnit(e){this.setSymbolParams({unit:e})}isConvertedToOtherUnit(){return(0,d.isConvertedToOtherUnit)(this.symbolInfo(),this._model.unitConversionEnabled())}style(){return this.properties().childs().style.value()}setStyle(e){this.setSymbolParams({style:e})}interval(){return this._model.mainSeries().interval()}setInterval(e){}valueAt(e,t){var i,s;return null!==(s=null===(i=this.data().search(e))||void 0===i?void 0:i.value[t])&&void 0!==s?s:null}symbolSource(){return this}barsProvider(){return this}state(e,t){var i;const r=super.state(e,t);this._model.unitConversionEnabled()||delete r.state.unitId;const o=this.symbol();return r.state.inputs.symbol=(0,d.symbolToSaveInState)(null!==(i=this.symbolInfo())&&void 0!==i?i:this._model.chartApi().lastSymbolResolveInfo(o),o),e&&((0,s.ensureDefined)(r.data).symbols={___snapshot:this.symbolInfo()||void 0}),r}symbolTitle(e,t,i){return this.title(e,!0,{},!1,t)}title(e,t,i,s,r){var o;const l=this._titleInParts(e,t,i,s,r);return[l[0],...null!==(o=l[1])&&void 0!==o?o:[]].join(` ${d.symbolTitleSeparator} `)}
titleInParts(e,t,i,s,r){return[this.title(e,t,i,s,r)]}isStarted(){return null===this._seriesSource?super.isStarted():this._seriesSource.isStarted()}sourceId(){return null===this._seriesSource?super.sourceId():(0,s.ensureNotNull)(this._seriesSource.instanceId())}moveData(e){null===this._seriesSource?super.moveData(e):this._seriesSource.moveData(e)}firstValue(){const e=this._model.timeScale().visibleBarsStrictRange();if(null===e)return null;const t=e.firstBar();if(0===this.data().size())return this._ownFirstValue;const i=this.data().search(t,g.PlotRowSearchMode.NearestRight,1);return this._ownFirstValue=null!==i?this._barFunction(i.value,0):null,this._ownFirstValue}lastValueData(e,t,i){const s={noData:!0},r=this.priceScale();if(this._model.timeScale().isEmpty()||null===r||r.isEmpty()||this.data().isEmpty())return s;const o=this._model.timeScale().visibleBarsStrictRange();if(null===o)return s;const l=this.properties().childs();if(!l.visible.value())return s;const n=this.nearestIndex(o.lastBar(),g.PlotRowSearchMode.NearestLeft,1);if(void 0===n)return s;const a=this.firstValue();if(null===a)return s;const u=this._lastNonEmptyPlotRow(4),h=null!==u&&o.contains(u.index),d=null!==u?u.value:null,c=t||h?d:this.data().valueAt(n);if(null===c)return s;const _=this._barFunction(c,2);if(!(0,f.isNumber)(_))return s;const p=r.priceToCoordinate(_,a);let y;switch(l.style.value()){case 0:y=c[1]<=c[4]?l.barStyle.childs().upColor.value():l.barStyle.childs().downColor.value();break;case 1:y=c[1]<=c[4]?l.candleStyle.childs().upColor.value():l.candleStyle.childs().downColor.value();break;case 9:y=c[1]<=c[4]?l.hollowCandleStyle.childs().upColor.value():l.hollowCandleStyle.childs().downColor.value();break;case 13:y=c[1]<=c[4]?l.columnStyle.childs().upColor.value():l.columnStyle.childs().downColor.value();break;case 2:y=l.lineStyle.childs().color.value();break;case 14:y=l.lineWithMarkersStyle.childs().color.value();break;case 15:y=l.steplineStyle.childs().color.value();break;case 3:y=l.areaStyle.childs().linecolor.value();break;case 16:y=l.hlcAreaStyle.childs().closeLineColor.value();break;case 10:{const e=l.baselineStyle.childs();y=p<Math.round(r.height()*(Math.abs(100-e.baseLevelPercentage.value())/100))?e.topLineColor.value():e.bottomLineColor.value();break}case 12:y=l.hiloStyle.childs().color.value();break;default:throw new Error("Not supported overlay style")}const v={...r.getFormattedValues(_,a,!0),noData:!1,floatCoordinate:p,coordinate:p,color:y};return i&&(v.price=_),v}priceRange(e,t,i){if(!(0,f.isInteger)(e))return Ie.logDebug("priceRange: incorrect startBar"),null;if(!(0,f.isInteger)(t))return Ie.logDebug("priceRange: incorrect endBar"),null;if(0===this.data().size())return null;const s=this.priceSource();let r;r=null!==s?this.data().minMaxOnRangeCached(e,t,[{name:s,offset:0}]):this.data().minMaxOnRangeCached(e,t,[{name:"low",offset:0},{name:"high",offset:0}]);const o=null!==r?new C.PriceRange(r.min,r.max):null;return this._postProcessPriceRange(o,i)}bars(){return this.data()}open(e){return(0,s.ensureNotNull)(this.bars().valueAt(e))[1]
}high(e){return(0,s.ensureNotNull)(this.bars().valueAt(e))[2]}low(e){return(0,s.ensureNotNull)(this.bars().valueAt(e))[3]}close(e){return(0,s.ensureNotNull)(this.bars().valueAt(e))[4]}hl2(e){return(this.high(e)+this.low(e))/2}hlc3(e){return(this.high(e)+this.low(e)+this.close(e))/3}ohlc4(e){return(this.open(e)+this.high(e)+this.low(e)+this.close(e))/4}canBeHiddenByGlobalFlag(){return!1}async start(e,t){var i;this._formatter=null,this._defaultFormatter=null;const s=super.start(e,t);return null===(i=this.priceScale())||void 0===i||i.updateFormatter(),Ce&&this._setQuotesSymbol((0,_.encodeExtendedSymbolOrGetSimpleSymbolString)(this._getSymbolObject(this.symbol()))),s}stop(e){super.stop(e),this._quotesProvider.setQuotesSessionSymbol(null)}formatter(){return this._formatter||this._recreateFormatter(),(0,s.ensureNotNull)(this._formatter)}statusView(){return Pe?super.statusView():null}moveItem(e,t,i){if(10===this.style()&&0===t){const t=(0,s.ensureNotNull)(this.priceScale()),i=this.properties().childs().baselineStyle,r=t.height(),o=100-e.y/r*100,l=o<0?0:Math.round(10*o)/10;i.childs().baseLevelPercentage.setValue(Math.max(Math.min(l,100),0))}}measureUnitId(){return(0,d.measureUnitId)(this.symbolInfo())}dataUpdated(){return this._dataUpdated}alertCreationAvailable(){var e;return new w.WatchedValue(!(null===(e=this.priceScale())||void 0===e?void 0:e.isPercentage())&&super.alertCreationAvailable().value()).readonly()}valuesProvider(){return new oe(this,this.model())}defaultPlotIdForAlert(){return""}tags(){const e=[],t=this.symbolInfo();if(t)e.push(t.name);else{const t=this.symbol();t&&e.push(t)}return e}statusProvider(e){return new fe(this)}_onPropertiesChanged(){super._onPropertiesChanged(),this._precomputedBarStyles=new WeakMap}async _tryChangeInputs(){var e;await super._tryChangeInputs(),this._formatter=null,this._defaultFormatter=null,null===(e=this.priceScale())||void 0===e||e.updateFormatter()}_tryCreateFormatter(){var e,t;t=null===(e=null===x.customFormatters||void 0===x.customFormatters?void 0:x.customFormatters.priceFormatterFactory)||void 0===e?void 0:e.call(x.customFormatters,this.symbolInfo(),this.properties().childs().minTick.value());return(0,d.createSeriesFormatter)(this.symbolInfo(),this.properties().childs().minTick.value())}_tryCreateDefaultFormatter(){return(0,d.createSeriesFormatter)(this.symbolInfo(),"default")}_onUnitChanged(){"alwaysOff"!==(0,u.currencyUnitVisibilityProperty)().value()&&this._model.fullUpdate(),this._model.unitConversionEnabled()&&this.isStarted()&&this._tryChangeInputs(),this._unitChanged.fire()}_getSymbolObject(e){const t=super._getSymbolObject(e),i=this.currency();null!==i&&(t["currency-id"]=i);const s=this.unit();return this._model.unitConversionEnabled()&&null!==s&&(t["unit-id"]=s),t.adjustment=this._model.mainSeries().properties().childs().dividendsAdjustment.value()?"dividends":"splits",t}_onSymbolResolvingStart(e,t){this._lastResolvedSymbolSource=t,super._onSymbolResolvingStart(e,t),this._symbolResolvingActive.setValue(!0)}_onSymbolError(){super._onSymbolError(),
this._symbolResolvingActive.setValue(!1)}_onSymbolResolved(e,t,i){super._onSymbolResolved(e,t,i),this._recreatePriceFormattingDependencies();const s=t===this.symbol()?(0,d.extractSymbolNameFromSymbolInfo)(i,this.symbol()):null,r=(0,d.symbolCurrency)(i),o=(0,d.symbolUnit)(i,this._model.unitConversionEnabled());this._setSymbolParamsInternal({symbol:null!=s?s:void 0,currency:r,unit:o},i),Ce&&this._setQuotesSymbol((0,_.encodeExtendedSymbolOrGetSimpleSymbolString)(this._getSymbolObject(this.symbol()))),this._checkStyle(),this._symbolResolvingActive.setValue(!1)}async _changeInputsImpl(e,t){await super._changeInputsImpl(e,t),this._realignLineToolsIfParamsChanged()}_setQuotesSymbol(e){const t=this.symbolInfo(),i=(0,d.extractSymbolNameFromSymbolInfo)(t,e),s=i&&this.getSymbolString(i);this._quotesProvider.setQuotesSessionSymbol(s)}_onQuotesUpdate(e,t){!this._legendView||void 0===t.values.change&&void 0===t.values.change_percent||(this._legendView.update(),this._model.updateSource(this))}_createViews(){this._priceAxisViews=[];const e=new V(this);this._priceAxisViewsBase=[e];const t=new A(this);this._priceLinesAxisViews=[t],this._paneViews=[],this._labelPaneViews=[];let i=null,r=null;switch(this.properties().childs().style.value()){case 0:r=new he.SeriesBarsPaneView(this,this._model);break;case 1:r=new de.SeriesCandlesPaneView(this,this._model);break;case 9:r=new ve.SeriesHollowCandlesPaneView(this,this._model);break;case 13:r=new me.SeriesColumnsPaneView(this,this._model);break;case 2:case 14:case 15:r=new ce.SeriesLinePaneView(this,this._model);break;case 3:r=new _e.SeriesAreaPaneView(this,this._model);break;case 16:r=new pe.SeriesHLCAreaPaneView(this,this._model);break;case 10:{r=new ye.SeriesBaselinePaneView(this,this._model);const e=this.properties().childs().baselineStyle.childs();i=new I.SeriesWaterlinePaneView({paneHeight:()=>(0,s.ensureNotNull)(this.priceScale()).height(),color:()=>e.baselineColor.value(),baseLevelPercentage:()=>e.baseLevelPercentage.value()});break}case 12:r=new Se.SeriesHiLoPaneView(this,this._model)}r&&this._paneViews.push(r),null!==i&&this._paneViews.push(i),this._paneViews.push(new E(this)),this._dataWindowView||(this._dataWindowView=new re(this,this._model)),this._legendView||(this._legendView=new ae(this,this._model)),this._statusView||(this._statusView=new P.StudyStatusView(this)),this._priceAxisViews=[...this._priceAxisViewsBase],this._labelPaneViews.push(new ue.PanePriceAxisView(e,this,this._model))}_createStudyOnServer(){let e;return null===this._seriesSource?e=super._createStudyOnServer():(this._modifyStudyOnServer((0,s.ensureDefined)(this._inputs)),e=!0),this._realignLineToolsIfParamsChanged(),e}_modifyStudyOnServer(e){null===this._seriesSource?super._modifyStudyOnServer(e,0):(this._seriesSource.modifySeries((0,_.decodeExtendedSymbol)(e.symbol),(0,S.getServerInterval)(this._series.properties().childs().interval.value())),this._seriesSource.isStarted()||this._seriesSource.start())}_stopStudyOnServer(){null===this._seriesSource?super._stopStudyOnServer():this._seriesSource.stop()}
_titleInParts(e,t,i,s,r){const o=this.symbolInfo();return[this._getSymbolTitlePart(o),[this._getExchangeTitlePart(o,r),this._getPriceSourceTitlePart(o)].filter((e=>null!==e))]}_getSymbolTitlePart(e){var t;if(null===e)return xe?"":this.properties().childs().inputs.childs().symbol.value();if(we)switch(this._model.mainSeries().symbolTextSourceProxyProperty().value()){case"description":return e.description;case"ticker-and-description":return`${e.name}, ${e.description}`;case"long-description":return null!==(t=e.long_description)&&void 0!==t?t:e.description}return e.name}_getExchangeTitlePart(e,t){return null===e||t?null:(0,d.getSymbolExchange)(e)}_getPriceSourceTitlePart(e){return null}_onAllowExtendTimeScaleChanged(){}_setSymbolParamsInternal(e,t){const{symbol:i,currency:s,unit:r,style:o}=e,l=this.properties().childs(),n=l.inputs.childs().symbol.value(),a=l.currencyId.value(),u=l.unitId.value(),h=l.style.value();if(void 0!==i&&l.inputs.childs().symbol.setValueSilently(i),void 0!==s&&l.currencyId.setValueSilently(s),void 0!==r&&l.unitId.setValueSilently(r),void 0!==o&&l.style.setValueSilently(o),t)this._resolvedSymbolsByInput[this.symbol()]=t,this._resolvedSymbols[this._getSymbolForResolve(this.symbol())]=t,this._realignToolsLastParams=null;else{const e=this.symbolInfo();null!==e&&(l.currencyId.setValueSilently((0,d.symbolCurrency)(e)),l.unitId.setValueSilently((0,d.symbolUnit)(e,this._model.unitConversionEnabled())))}l.inputs.childs().symbol.value()!==n&&l.inputs.childs().symbol.listeners().fire(l.inputs.childs().symbol,""),l.currencyId.value()!==a&&l.currencyId.listeners().fire(l.currencyId,""),l.unitId.value()!==u&&l.unitId.listeners().fire(l.unitId,""),l.style.value()!==h&&l.style.listeners().fire(l.style,""),this._checkStyle(),this._realignLineToolsIfParamsChanged()}_updateBarFunction(){this._barFunction=(0,a.barFunctionByStyle)(this.style(),this.priceSource())}_onMinTickChanged(){this._recreatePriceFormattingDependencies(),this.updateAllViews({type:"global-change"}),this._model.fullUpdate()}_onChartStyleChanged(){var e;this._updateBarFunction(),(null===(e=this._styleToRecover)||void 0===e?void 0:e.originalStyle)!==this.style()&&(this._styleToRecover=null)}_checkStyle(){const e=this.style();(0,d.isCloseBasedSymbol)(this.symbolInfo())?(0,d.isSingleValueBasedStyle)(e)||(this.setStyle(2),this._styleToRecover={correctedStyle:this.style(),originalStyle:e}):null!==this._styleToRecover&&(this.setStyle(this._styleToRecover.originalStyle),this._styleToRecover=null)}_realignLineToolsIfParamsChanged(){let e=null===this._realignToolsLastParams;if(null!==this._realignToolsLastParams){const t=this.compareSymbolParams(this._realignToolsLastParams);e=t.symbolChanged||t.intervalChanged||t.currencyChanged||t.unitChanged}e&&(this._model.realignLineTools(this),this._realignToolsLastParams=this.symbolParams())}}},682541:(e,t,i)=>{"use strict"
;var s=i(650151).ensureNotNull,r=i(86441).Point,o=i(535698).TextRenderer,l=i(772466).NonSeriesStudy,n=i(541801).TrendLineRenderer,a=i(315801).HitTestResult,u=i(315801).HitTarget,h=i(142119).CompositeRenderer,d=i(246733),c=i(855152).LineEnd,_=i(422333).CHART_FONT_FAMILY;const{LINESTYLE_SOLID:p,LINESTYLE_DASHED:y}=i(458963);class v{constructor(e,t){this._model=e,this._source=t,this._waves=[],this._highlights=[],this._retracements=[],this._invalidated=!0}update(){this._invalidated=!0}updateImpl(){if(this._waves=[],this._highlights=[],this._retracements=[],this._source.customData()&&this._source.properties().visible.value()){var e=this._source.customData().waves,t=this._source._indexes,i=this._model.timeScale(),o=this._source.priceScale(),l=this._model.mainSeries(),n=l.firstBar();if(o&&!o.isEmpty()&&!i.isEmpty()&&n&&e){for(var a=i.visibleBarsStrictRange(),u=a.lastBar(),h=a.firstBar(),d=["m0StartIndex","startIndex","endIndex","m2EndIndex","m3EndIndex"],c=l.firstValue(),_=0;_<e.length;_++)if(e[_]){for(var m=[],S=0;S<5;S++){var b=t[e[_][d[S]]];if(!isFinite(b))break;m.push(b)}if(0!==m.length&&!(m[0]>u||m[m.length-1]<h)){var g=+e[_].size;if(isFinite(g)){var f="level"+g,C=this._source.properties()[f];if(C.visible.value()){var w=parseInt(e[_].direction,10),x=[];x.dir=w,x.prices=[],x.orig_prices=[];for(var P=0;P<m.length;P++){if(void 0!==m[P]){var I={};if((M=m[P])<(n=s(l.bars().first())).index)continue;if(I.x=i.indexToCoordinate(M),null===(V=l.bars().valueAt(M))){x.push(void 0),x.prices.push(void 0),x.orig_prices.push(void 0),w=-w;continue}var T,D=1===w?V[TradingView.HIGH_PLOT]:V[TradingView.LOW_PLOT];if(x.orig_prices.push(D),x.prices.push(D),I.y=o.priceToCoordinate(D,c),I.label=v._wave5Labels[g][P],I.align=-1===w?"top":"bottom",I.color=C.color.value(),delete I.backgroundColor,x.id="wave_"+_,this._source===this._model.hoveredSource())(T=this._model.lastHittestData())&&T.wave&&T.wave.id===x.id&&(I.color="#FFFFFF",I.backgroundColor=C.color.value());I.fontsize=v._fontSizes[g],I._textCache={widths:[]},I.wave=x,x.push(I)}else x.push(void 0),x.prices.push(void 0);w=-w}x.inds=m,x.dir=w,x.color=C.color.value(),this._waves.push(x)}}}}if(this._source===this._model.hoveredSource())if(T=this._model.lastHittestData()){m=T.wave.inds,w=-T.wave.dir;var R=T.backgroundColor?T.backgroundColor:T.color,L=T.wave.orig_prices,k=null;for(P=0;P<m.length;P++){if(void 0!==m[P]){var V,M=m[P],A=i.indexToCoordinate(M);if(null===(V=l.bars().valueAt(M))){w=-w;continue}D=L[P];var B=o.priceToCoordinate(D,c),N=new r(A,B);k&&this._highlights.push({points:[k,N],color:R}),k=N}w=-w}if(void 0!==L[1]&&void 0!==L[2]){var E=L[1],F=L[2],H=L[3],O=L[0];this._retracements.push({y:o.priceToCoordinate(E,c),x:0,extendLeft:!0,extendRight:!0,color:R,text:"",style:p}),this._retracements.push({y:o.priceToCoordinate(E,c),x:0,extendLeft:!0,extendRight:!0,color:R,text:"",style:p});w=F-E;if(void 0!==L[0]){D=E+(W=(O-E)/w)*w,A=i.indexToCoordinate(m[0]);this._retracements.push({y:o.priceToCoordinate(D,c),x:A,extendLeft:!1,extendRight:!0,color:R,text:""+W.toFixed(3),style:y})}
if(void 0!==H){var W;D=F-(W=(F-H)/w)*w,A=i.indexToCoordinate(m[3]);this._retracements.push({y:o.priceToCoordinate(D,c),x:A,extendLeft:!0,extendRight:!1,color:R,text:""+W.toFixed(3),style:y})}}}}}}renderer(){this._invalidated&&(this.updateImpl(),this._invalidated=!1);for(var e=new h,t=this.CIRCLE_SIZE,i={},s=0;s<this._waves.length;s++)for(var l=this._waves[s],y=0;y<l.length;y++){var v=l[y];if(void 0!==v){var m,S;"top"===v.align?(m=v.y+4,i["top_"+v.x]?(m+=i["top_"+v.x]*t,i["top_"+v.x]=i["top_"+v.x]+1):i["top_"+v.x]=1,S=m+t):(m=v.y-t-4,i["bottom_"+v.x]?(m-=i["bottom_"+v.x]*t,i["bottom_"+v.x]=i["bottom_"+v.x]+1):i["bottom_"+v.x]=1,S=m+t);var b={};b.points=[new r(v.x,(m+S)/2)],b.text=v.label,b.color=v.color,b.backgroundColor=v.backgroundColor,b.font="Verdana",b.bold=!0,b.offsetX=0,b.offsetY=0,b.vertAlign="middle",b.horzAlign="center",b.fontsize=v.fontsize;var g=new a(u.Regular,v);e.append(new o(b,g))}}for(s=0;s<this._highlights.length;s++){var f=this._highlights[s],C={points:f.points,width:this._model.timeScale().width(),height:this._source.priceScale().height(),color:d.generateColor(f.color,50),linewidth:3,linestyle:p,extendleft:!1,extendright:!1,leftend:c.Circle,rightend:c.Circle};(w=new n).setData(C),e.append(w)}for(s=0;s<this._retracements.length;s++){var w,x=this._retracements[s];C={points:[new r(x.x+1,x.y),new r(x.x,x.y)],width:this._model.timeScale().width(),height:this._source.priceScale().height(),color:d.generateColor(x.color,50),linewidth:1,linestyle:x.style,extendleft:x.extendLeft,extendright:x.extendRight,leftend:c.Normal,rightend:c.Normal};(w=new n).setData(C),e.append(w);var P={points:[new r(x.x,x.y)],text:this._retracements[s].text,backgroundColor:"#606060",color:"#FFFFFF",vertAlign:"middle",horzAlign:"center",font:_,offsetX:x.extendRight?-50:50,offsetY:2,fontsize:12};e.append(new o(P))}return e}}v.prototype.CIRCLE_SIZE=16,v._wave5Labels=[["i","ii","iii","iv","v"],["(i)","(ii)","(iii)","(iv)","(v)"],["((i))","((ii))","((iii))","((iv))","((v))"],["1","2","3","4","5"],["(1)","(2)","(3)","(4)","(5)"],["((1))","((2))","((3))","((4))","((5))"],["I","II","III","IV","V"],["(I)","(II)","(III)","(IV)","(V)"],["((I))","((II))","((III))","((IV))","((V))"]],v._wave3Labels=[["a","b","c"],["A","B","C"]],v._fontSizes=[10,10,10,11,11,11,12,12,12];t.study_ElliottWave=class extends l{margins(){return[.1,.1]}isVisible(){if(!this.properties().visible.value()||!this.isActualInterval())return!1;for(var e=0;e<=8;e++)if(this.properties()["level"+e].visible.value())return!0;return!1}_createViews(){super._createViews(),this._setPaneViews([new v(this.model(),this)])}}},7195:(e,t,i)=>{"use strict";var s=i(328484).StudyOverlayBase;t.study_Overlay=class extends s{async _getPropertyDefinitionsViewModelClass(){return(await Promise.all([i.e(88601),i.e(96461),i.e(9408),i.e(78555),i.e(30154),i.e(82375),i.e(47924),i.e(60607)]).then(i.bind(i,811173))).StudyOverlayDefinitionsViewModel}}},894718:(e,t,i)=>{"use strict"
;var s=i(772466).NonSeriesStudy,r=i(315801).HitTestResult,o=i(315801).HitTarget,l=i(142119).CompositeRenderer,n=i(710455).MediaCoordinatesPaneRenderer,a=i(422333);class u extends n{constructor(e,t){super(),this._data=e,this._textCache=t}_drawImpl(e){var t=e.context;t.textBaseline="bottom",t.font=(this._data.bold?"bold ":"normal ")+this._data.fontsize+"px "+this._data.font;var i=Math.round(t.measureText(this._data.text).width+4);this._textCache.width=i,t.translate(this._data.x+.5,this._data.y),t.strokeStyle=this._data.borderColor,t.fillStyle=this._data.backColor,t.beginPath(),t.moveTo(0,0),1===this._data.type?(t.lineTo(5,-5),t.lineTo(i/2,-5),t.lineTo(i/2,-5-this._data.fontsize),t.lineTo(-i/2,-5-this._data.fontsize),t.lineTo(-i/2,-5),t.lineTo(-5,-5),t.lineTo(0,0)):(t.lineTo(5,5),t.lineTo(i/2,5),t.lineTo(i/2,5+this._data.fontsize),t.lineTo(-i/2,5+this._data.fontsize),t.lineTo(-i/2,5),t.lineTo(-5,5),t.lineTo(0,0)),t.fill(),t.stroke(),t.fillStyle=this._data.textColor,t.textAlign="center",t.textBaseline="middle",1===this._data.type?t.fillText(this._data.text,0,-5-this._data.fontsize/2):t.fillText(this._data.text,0,5+this._data.fontsize/2)}hitTest(e){var t=this._textCache.width,i=this._data.fontsize+15,s=this._data.x-t/2,l=this._data.y;return 1===this._data.type&&(l-=i),e.x>=s&&e.x<=s+t&&e.y>=l&&e.y<=l+i?new r(o.Regular):null}}class h{constructor(e,t){this._model=e,this._source=t,this._pivots=[],this._textCache={},this._invalidated=!0}update(){this._invalidated=!0}updateImpl(){if(this._pivots=[],this._source.customData()&&this._source.customData().pivots&&this._source.properties().visible.value()){var e=this._source.customData().pivots,t=this._source._indexes,i=this._model.timeScale(),s=this._source.priceScale(),r=this._model.mainSeries(),o=r.firstValue();if(s&&!s.isEmpty()&&!i.isEmpty()&&o)for(var l=i.visibleBarsStrictRange(),n=l.firstBar(),a=l.lastBar(),u=0;u<e.length;u++)if(e[u]){var h=t[e[u].index];if(!(h<n||h>a)){var d=e[u].type,c=r.bars().valueAt(h);if(null!==c){var _=1===d?c[TradingView.HIGH_PLOT]:c[TradingView.LOW_PLOT],p=Math.round(i.indexToCoordinate(h)),y=s.priceToCoordinate(_,o);1===d?y-=i.barSpacing()/6:y+=i.barSpacing()/6+1,y=Math.round(y),this._pivots.push({x:p,y,price:s.formatPrice(_,o),type:d})}}}}}_pixelMargins(){return this._source.properties().fontsize.value()+15}topPixelMargin(){return this._pixelMargins()}bottomPixelMargin(){return this._pixelMargins()}renderer(){if(this._invalidated&&(this.updateImpl(),this._invalidated=!1),0!==this._pivots.length){for(var e=a.CHART_FONT_FAMILY,t=this._source.properties().fontsize.value(),i=this._source.properties().borderColor.value(),s=this._source.properties().backColor.value(),r=this._source.properties().textColor.value(),o=new l,n=0;n<this._pivots.length;n++){var h=this._pivots[n],d={x:h.x,y:h.y,type:h.type,text:h.price,font:e,fontsize:t,borderColor:i,backColor:s,textColor:r},c=n;this._textCache[c]||(this._textCache[c]={}),o.append(new u(d,this._textCache[c]))}return o}}}t.study_PivotPointsHighLow=class extends s{isVisible(){
return this.properties().visible.value()&&this.isActualInterval()}_createViews(){super._createViews(),this._setPaneViews([new h(this.model(),this)])}autoScaleInfo(e,t){return{range:this._series.priceRange(e,t),topPixelMargin:this._paneViews.length>0?this._paneViews[0].topPixelMargin():0,bottomPixelMargin:this._paneViews.length>0?this._paneViews[0].bottomPixelMargin():0}}}},738949:(e,t,i)=>{"use strict";var s=i(650151).assert,r=i(389137).clone,o=i(752928).Study,l=i(195447).PlotList,n=i(989709).studyPlotFunctionMap,a=i(989709).studyEmptyPlotValuePredicate;class u{constructor(e,t,i){this._strategyPlotIndex=e,this._targetPlotIndex=t,this._startIndex=i}rebuildData(e){var t=this._targetPlotIndex+1,i=this._strategyPlotIndex+1,s=null,r=null;e.range(this._startIndex||e.firstIndex(),e.lastIndex()).each((function(o,l){var n=l[t],a=l[i]?Math.round(l[i]):null;if(l[t]=null,l[i]=null,!a||a>0)return!1;var u=o+a,h={pointIndex:u,value:n};if(r){if(r.pointIndex!==h.pointIndex){u>=0&&(e.valueAt(u)[t]=n);var d=!1;s&&(d=s.value<=r.value&&r.value<=n||s.value>=r.value&&r.value>=n),d?r.pointIndex>=0&&(e.valueAt(r.pointIndex)[t]=null):s=r,r=h}}else r=h;return!1}))}}t.study_ScriptWithDataOffset=class extends o{constructor(e,t,i,s){super(e,t,i,s),this._underlyingData=new l(n(s),a)}clearData(){super.clearData(),this._underlyingData.clear()}_mergeData(e){this._invalidateLastNonEmptyPlotRowCache();var t=this._underlyingData.firstIndex();this._underlyingData.merge(e),t!==this._underlyingData.firstIndex()&&(this._data=new l(n(this._metaInfo),a));var i=this._data.lastIndex();this._underlyingData.range(i,this._underlyingData.lastIndex()).each(function(e,t){return this._data.add(e,r(t)),!1}.bind(this)),this._plotsForStrategyProcessing().forEach((function(e){new u(e.strategyIndex,e.targetIndex,i).rebuildData(this._data)}),this)}_plotsForStrategyProcessing(){var e=[];return this._metaInfo.plots.forEach((function(t,i){if("dataoffset"===t.type){var r=this._metaInfo.plots.findIndex((function(e){return e.id===t.target}));s(r>=0,"target plot not found for strategy plot "+t.id);var o={strategyIndex:i,targetIndex:r};e.push(o)}}),this),e}}},576678:(e,t,i)=>{"use strict";var s=i(86441).Point,r=i(772466).NonSeriesStudy,o=i(541801).TrendLineRenderer,l=i(315801).HitTestResult,n=i(315801).HitTarget,a=i(142119).CompositeRenderer,u=i(855152).LineEnd;const{LINESTYLE_SOLID:h}=i(458963);class d{constructor(e,t){this._model=e,this._source=t,this._pivots=[],this._textCache={},this._invalidated=!0}update(){this._invalidated=!0}updateImpl(){if(this._pivots=[],this._source.customData()&&this._source.customData().zigzag&&this._source.properties().visible.value()){var e=this._source.customData().zigzag,t=this._source._indexes,i=this._model.timeScale(),s=this._source.priceScale(),r=this._model.mainSeries(),o=r.firstValue();if(s&&!s.isEmpty()&&!i.isEmpty()&&o)for(var l=0;l<e.length;l++)if(e[l]){var n=t[e[l].index],a=e[l].type,u=r.bars().valueAt(n);if(null!==u){
var h=1===a?u[TradingView.HIGH_PLOT]:u[TradingView.LOW_PLOT],d=Math.round(i.indexToCoordinate(n)),c=s.priceToCoordinate(h,o);this._pivots.push({x:d,y:c})}}}}renderer(){this._invalidated&&(this.updateImpl(),this._invalidated=!1);for(var e=new a,t=this._source.properties().color.value(),i=this._source.properties().linewidth.value(),r=1;r<this._pivots.length;r++){var d=this._pivots[r],c=this._pivots[r-1],_={points:[new s(c.x,c.y),new s(d.x,d.y)],width:this._model.timeScale().width(),height:this._source.priceScale().height(),color:t,linewidth:i,linestyle:h,extendleft:!1,extendright:!1,leftend:u.Normal,rightend:u.Normal},p=new o;p.setData(_),p.setHitTest(new l(n.Regular)),e.append(p)}return e}}t.study_ZigZag=class extends r{isVisible(){return this.properties().visible.value()&&this.isActualInterval()}_createViews(){super._createViews(),this._setPaneViews([new d(this.model(),this)])}}},25e4:(e,t,i)=>{"use strict";function s(e,t,i){return e===t||e===i}i.d(t,{symbolSameAsResolved:()=>s})},904310:(e,t,i)=>{"use strict";function s(e){return e.charAt(0).toUpperCase()+e.substring(1)}i.d(t,{capitalizeFirstLetter:()=>s})},315507:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18"><path fill="currentColor" d="M12.57 5.5h-.07a3.5 3.5 0 1 0 .07 7A4.98 4.98 0 0 1 4 9a5 5 0 0 1 8.57-3.5z"/></svg>'},85290:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18"><path fill="currentColor" d="M12.22 11.78A3.47 3.47 0 0 0 9 6.98a3.48 3.48 0 0 0-3.22 4.8 6.97 6.97 0 0 1 6.44 0zM4.18 9.83L2.1 9.28l.33-1.24 2.07.55-.33 1.24zM6.38 6.36l-.9-1.94 1.16-.54.9 1.94-1.16.54zM10.46 5.82l.9-1.94 1.16.54-.9 1.94-1.16-.54zM13.49 8.6l2.07-.56.33 1.24-2.07.55-.33-1.24z"/></svg>'},788600:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 25 25" width="25" height="25" fill="none"><circle stroke="currentColor" stroke-width="1.5" cx="12.5" cy="12.5" r="11.75"/><path fill="currentColor" d="M8.25 18V7.43h3.96c1.05 0 1.95.2 2.68.62.75.4 1.31 1 1.7 1.78.4.78.6 1.73.6 2.83v.02a6.5 6.5 0 0 1-.59 2.88c-.39.8-.96 1.4-1.7 1.82a5.4 5.4 0 0 1-2.69.62H8.25Zm1.9-1.59h1.82c.7 0 1.29-.14 1.78-.43.5-.29.87-.71 1.12-1.26.26-.55.4-1.22.4-2.02v-.01c0-.77-.14-1.43-.4-1.98a2.78 2.78 0 0 0-1.13-1.26 3.45 3.45 0 0 0-1.77-.43h-1.83v7.4Z"/></svg>'},261820:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 25 25" width="25" height="25" fill="none"><rect width="21.5" height="21.5" stroke="currentColor" stroke-width="1.5" rx="1.25" x=".75" y="2.75"/><path fill="currentColor" d="M8.21 19V8.43h6.84v1.6H10.1v2.85h4.68v1.5H10.1v3.03h4.95V19H8.21Z"/></svg>'},777566:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 25 25" width="25" height="25" fill="none"><path stroke="currentColor" stroke-width="1.5" d="M10.85 23.72c.4.25.9.25 1.3 0l9.5-5.82c.37-.22.6-.63.6-1.06V2c0-.69-.56-1.25-1.25-1.25H2C1.31.75.75 1.31.75 2v14.84c0 .43.23.84.6 1.06l9.5 5.82Z"/><path fill="currentColor" d="M8.21 17V6.43h6.84v1.6H10.1v2.85h4.68v1.5H10.1v3.03h4.95V17H8.21Z"/></svg>'},
385442:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 25 25" width="25" height="25" fill="none"><path stroke="currentColor" stroke-width="1.5" d="M10.87 1.23c.39-.22.87-.22 1.26 0l9.5 5.52c.38.23.62.64.62 1.08V23c0 .69-.56 1.25-1.25 1.25H2c-.69 0-1.25-.56-1.25-1.25V7.83c0-.44.24-.85.62-1.08l9.5-5.52Z"/><path fill="currentColor" d="M8.21 19V8.43h6.84v1.6H10.1v2.85h4.68v1.5H10.1v3.03h4.95V19H8.21Z"/></svg>'},717090:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 25 25" width="25" height="25" fill="none"><circle stroke="currentColor" stroke-width="1.5" cx="12.5" cy="12.5" r="11.75"/><path fill="currentColor" d="m19.27 13.25.53-.53-.53-.53-3.5-3.5-1.06 1.06 2.22 2.22h-5.38L7.27 7.7 6.2 8.75l4.5 4.5.22.22h6L14.7 15.7l1.06 1.06 3.5-3.5Zm-10.56.44-3 3 1.06 1.06 3-3L8.7 13.7Z"/></svg>'},274469:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 25 25" width="25" height="25" fill="none"><circle stroke="currentColor" stroke-width="1.5" cx="12.5" cy="12.5" r="11.75"/><path fill="currentColor" d="M12.51 18.26a5.5 5.5 0 0 1-2.13-.38c-.6-.25-1.08-.6-1.43-1.06a2.9 2.9 0 0 1-.58-1.59v-.1h1.82l.01.07c.03.3.15.56.35.78.21.22.49.4.84.52a3.56 3.56 0 0 0 2.31-.02c.33-.13.58-.3.77-.54.19-.23.28-.5.28-.8v-.01c0-.38-.15-.7-.45-.93-.3-.25-.79-.44-1.47-.59l-1.14-.23a5.8 5.8 0 0 1-1.76-.64c-.46-.28-.8-.62-1.01-1.02-.22-.4-.32-.86-.32-1.38 0-.64.16-1.19.5-1.66.33-.48.8-.85 1.38-1.11.59-.27 1.27-.4 2.03-.4.78 0 1.45.13 2.03.4.57.25 1.02.6 1.34 1.05.33.45.51.96.55 1.53l.01.1h-1.8l-.02-.1a1.38 1.38 0 0 0-.34-.72 1.85 1.85 0 0 0-.73-.5c-.3-.12-.65-.18-1.06-.18-.38 0-.73.06-1.03.18-.3.12-.54.29-.72.5a1.2 1.2 0 0 0-.25.78c0 .25.06.47.19.66.12.2.32.36.6.5.27.13.63.24 1.07.34l1.13.24c.74.16 1.35.36 1.81.62.46.26.8.58 1.02.97.22.38.33.84.33 1.38 0 .69-.17 1.28-.5 1.78-.34.5-.82.88-1.44 1.15-.61.28-1.34.41-2.19.41Z"/></svg>'}}]);